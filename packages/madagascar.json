{"name":"madagascar","version":"0.1.13","description":"Madagascar wraps a bulk of HTTP requests, collect the responses and sends them back as one.","main":"index.js","scripts":{"test":"make test"},"repository":"https://github.com/Olapic/madagascar","keywords":["restful","api","http","bulk","wrapper"],"licenses":[{"type":"MIT","url":"https://github.com/Olapic/madagascar/LICENSE-MIT"}],"devDependencies":{"mocha":"~1.16.2","chai":"~1.8.1","nock":"~0.41.0","chai-fuzzy":"~1.4.0"},"dependencies":{"URIjs":"~1.13.2","coveralls":"^2.11.1","mocha-lcov-reporter":"0.0.1","underscore-node":"~0.1.2"},"gitHead":"bdfe8685fa9a4d4bc81fea579d07d74a1ac617b2","license":"MIT","homepage":"https://github.com/Olapic/madagascar","versions":[{"number":"0.1.0","date":"2014-07-10T17:17:02.897Z"},{"number":"0.1.1","date":"2014-07-10T19:27:55.694Z"},{"number":"0.1.2","date":"2014-07-10T19:50:44.541Z"},{"number":"0.1.3","date":"2014-07-10T20:01:49.838Z"},{"number":"0.1.5","date":"2014-07-11T22:43:14.459Z"},{"number":"0.1.6","date":"2014-07-11T22:54:12.577Z"},{"number":"0.1.7","date":"2014-07-14T19:25:18.490Z"},{"number":"0.1.8","date":"2014-07-15T15:56:08.854Z"},{"number":"0.1.9","date":"2014-07-15T18:05:12.331Z"},{"number":"0.1.10","date":"2014-07-15T19:48:15.058Z"},{"number":"0.1.11","date":"2014-07-15T19:53:23.886Z"},{"number":"0.1.13","date":"2014-07-16T17:31:33.178Z"}],"readme":"#Madagascar\n\n[![NPM version](https://badge.fury.io/js/madagascar.svg)](http://badge.fury.io/js/madagascar)\n[![Build Status](https://travis-ci.org/Olapic/madagascar.svg?branch=master)](https://travis-ci.org/Olapic/madagascar)\n\nMadagascar wraps a bulk of HTTP requests, collect the responses and sends them back as one.\n\n# Install\n\n```sh\n$ npm install madagascar\n```\n#API\n\n**`madagascar(config)`** in where *`config`* is an object that may contains\n\n- *string* `domains.baseUrl` … base URL respect to which every relative URL will be taken, e.g., *\"https://api.olapic.com/v1\"*\n- *array* `domains.restrictTo` … list of allowed domains. If it's not present, it will be allowed requests to any domain, e.g., *[\"api.olapic.com\"]*\n- *object* `defaultHeaders` … contains a set of default headers to be sent on every request to the upstream API, e.g., *{\"Accept\": \"application/json\", \"Link\": \"&lt;/&gt;\"}*\n- *int* `batchMaxSize` … Specifies the maximum amount of request allowed on a single batch. Its default value is *30*.\n\nand returns an object containing:\n\n- *function* **`send(payload, callback)`**\n\nwhere *`payload`* may have the following members\n\n- *string* `base_url` … acts in the same way as `config.domains.baseUrl` does.\n- *object* `authentication` … authentication object. It will be merged into the query string of every request.\n- *array* `batch` … objects corresponding to a standar HTTP request.\n  - *string* `relative_url` … relative to the *base_url* specified by this payload or by config, e.g., *'/hello'*\n  - *string* `url` … must be fully qualified, e.g., 'https://api.olapic.com/hello?count=2'. It supersedes the *relative_url* parameter.\n  - *string* `method` … HTTP method like *'GET'*.\n  - *object* headers … may contain any valid HTTP header in the form: `{name: value}`, e.g., `{'Content-type': 'application/json'}`\n  - *string* `body` … must be already encoded according to the Content-Type specified on the headers of the request.\n\nand **`callback`** must be a **`function(response)`**, in where\n\n- `response` would be an array of response objects, in the corresponding order to the *batch* received. Each of one should contain\n  - *int* `status` … HTTP status code\n  - *object* `headers` … response headers.\n  - *string* `body` … response body as it comes from the upstream.\n\n# Usage\n\n```js\nvar madagascar = require('madagascar');\n\nvar payload = {\n  base_url: 'https://api.olapic.com',\n  authentication:\n  {\n    access_token: 'abcdef'\n  }\n  batch: [\n    {\n      url: 'https://api.photorank.me/media',\n      method: 'POST',\n      body: 'caption=%23madagascar&link=http%3A%2F%2Finstagram.com%2Fp%2FqMN-RWKc9U',\n    },\n    {\n      relative_url: '/',\n      headers:\n      {\n        'Accept': 'text/html; q=0.8'\n      }\n      method: 'GET',\n    }\n  ]\n};\n\nmadagascar(payload, function(responses){\n  /*\n  response = [\n    {\n      status: 200,\n      headers:\n      {\n        'Content-Type': 'text/javascript; charset=UTF-8'\n      },\n      body: '{\\\"id\\\":\\\"…\\\"}'\n    },\n    {\n      status: 400,\n      headers:\n      {\n        'Content-Type': 'text/javascript; charset=UTF-8'\n      },\n      body:'{\\\"error\\\":\\\"…\\\"}'\n    },\n  ];\n  */\n});\n\n```\n\n#Server example\n\n\n```js\nvar express = require('express'),\n    madagascar = require('madagascar'),\n    bodyParser = require('body-parser'),\n    app = express(),\n    gate;\n\napp.use(bodyParser.json());\n\ngate = madagascar({\n  domains: {\n    baseUrl: 'https://api.olapic.com/'\n  }\n});\n\napp.post('/', function(req, res){\n  gate(req.body, function(responses) {\n    res.send(responses);\n  });\n});\n\napp.listen(3000);\n\n```\n\n```sh\ncurl -d \"`cat payload.json`\" -H \"Content-Type: application/json\" http://localhost:3000/\n[{\"status\":200,\"headers\":{\"server\":\"nginx\"...\n```\n\n# License\n\n##MIT\n\nCopyright (c) 2014 Olapic INC\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\nSoftware is furnished to do so, subject to the following\ncopies of the Software, and to permit persons to whom the\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n","starsCount":1,"created":"2014-07-10T17:17:02.897Z","modified":"2014-07-16T17:31:33.178Z","lastPublisher":{"name":"charlie","email":"awaken.ar@gmail.com"},"owners":[{"name":"charlie","email":"awaken.ar@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"madagascar","_npmUser":{"name":"charlie","email":"awaken.ar@gmail.com"},"_npmVersion":"1.5.0-alpha-1","_rev":"1-fd6312028ec362e4904a8f7a1d7f5ebc","_shasum":"dd15b5f666ab9d9e69069639dcd3e461bd66168b","author":{"name":"Carlos Viglietta","email":"awaken.ar@gmail.com","url":"https://github.com/charly22"},"bugs":{"url":"https://github.com/Olapic/madagascar/issues"},"directories":{"test":"test","lib":"lib"},"dist-tags":{"latest":"0.1.13"},"dist":{"shasum":"dd15b5f666ab9d9e69069639dcd3e461bd66168b","tarball":"http://registry.npmjs.org/madagascar/-/madagascar-0.1.13.tgz"},"maintainers":[{"name":"charlie","email":"awaken.ar@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2014-07-16T17:31:33.178Z","created":"2014-07-10T17:17:02.897Z","0.1.0":"2014-07-10T17:17:02.897Z","0.1.1":"2014-07-10T19:27:55.694Z","0.1.2":"2014-07-10T19:50:44.541Z","0.1.3":"2014-07-10T20:01:49.838Z","0.1.5":"2014-07-11T22:43:14.459Z","0.1.6":"2014-07-11T22:54:12.577Z","0.1.7":"2014-07-14T19:25:18.490Z","0.1.8":"2014-07-15T15:56:08.854Z","0.1.9":"2014-07-15T18:05:12.331Z","0.1.10":"2014-07-15T19:48:15.058Z","0.1.11":"2014-07-15T19:53:23.886Z","0.1.13":"2014-07-16T17:31:33.178Z"},"users":{"charlie":true}}}