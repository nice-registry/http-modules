{"name":"sham-it","version":"2.0.2","description":"Create a Sham (Mocked HTTP server) and mock out endpoints in JS","main":"index.js","scripts":{"precommit":"lint-staged","test":"jest","lint":"eslint .","semantic-release":"semantic-release pre && npm publish && semantic-release post"},"repository":"https://github.com/dos-j/sham-it","license":"MIT","homepage":"https://github.com/dos-j/sham-it#readme","dependencies":{"indent-string":"^3.1.0","jest":"^20.0.0","ms":"^2.0.0","node-fetch":"^1.6.3","pino":"^4.5.2","serialize-error":"^2.1.0","shortid":"^2.2.8"},"devDependencies":{"condition-circle":"^1.5.0","eslint":"^3.18.0","eslint-config-prettier":"^2.1.0","express":"^4.15.2","husky":"^0.13.2","jest-junit-reporter":"^1.1.0","lint-staged":"^3.4.0","nodemon":"^1.11.0","prettier":"^1.3.1","request":"^2.81.0","semantic-release":"^6.3.2","supertest":"^3.0.0"},"lint-staged":{"*.js":["prettier --write","eslint --fix","git add"]},"jest":{"testResultsProcessor":"./node_modules/jest-junit-reporter","collectCoverage":true,"coveragePathIgnorePatterns":["<rootDir>/examples"]},"release":{"verifyConditions":"condition-circle"},"gitHead":"ce31617fb22413fc7f44c02c6cdeaf1f488d2182","versions":[{"number":"1.0.0","date":"2017-03-28T15:38:34.245Z"},{"number":"1.1.0","date":"2017-03-29T11:22:28.992Z"},{"number":"1.2.0","date":"2017-04-02T15:44:55.329Z"},{"number":"2.0.0","date":"2017-05-18T01:52:57.916Z"},{"number":"2.0.1","date":"2017-05-18T14:35:29.422Z"},{"number":"2.0.2","date":"2017-05-25T01:50:11.143Z"}],"readme":"# sham-it\n[![NPM Version](https://img.shields.io/npm/v/sham-it.svg)](https://www.npmjs.com/package/sham-it)\n[![Build Status](https://circleci.com/gh/dos-j/sham-it.svg?style=shield&circle-token=:circle-token)](https://circleci.com/gh/dos-j/sham-it) [![Coverage](https://img.shields.io/codecov/c/github/dos-j/sham-it.svg)](https://codecov.io/gh/dos-j/sham-it) [![semantic-release](https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg)](https://github.com/semantic-release/semantic-release)\n [![dependencies](https://david-dm.org/dos-j/sham-it.svg)](https://david-dm.org/dos-j/sham-it) [![devDependencies](https://david-dm.org/dos-j/sham-it/dev-status.svg)](https://david-dm.org/dos-j/sham-it#info=devDependencies) [![Known Vulnerabilities](https://snyk.io/test/github/dos-j/sham-it/badge.svg)](https://snyk.io/test/github/dos-j/sham-it) [![License](\thttps://img.shields.io/github/license/dos-j/sham-it.svg)](https://github.com/dos-j/sham-it/blob/master/LICENSE)\n\nSham-It allows you to easily create mock web services that you can use within your tests.\n\nWhen you need to test a web service which depends on third party web services you are forced to choose between loading the entire platform, creating complicated stub services or mocking out the parts of your codebase that call external services.\n\nAs the size of your platform gets bigger, trying to load all of it at once will grind your integration tests to a halt. This inevitably forces you to choose between stub services and mocking out huge chucks of the api.\n\nAs the number of tests you write increases, the complexity of your stub services will also have to increase to send your api down the paths you need to test. You will also need to come up with inventive solutions to change your api's responses between tests and check that it was called.\n\nWith mocking classes and functions there are plenty of easy to use options for mocking out individual calls within the tests you are writing and writing expectations that they were cakked. Unfortunately with this approach, you aren't testing how your service behaves across the network and the code you've replace with mocks won't get tested.\n\nWith sham-it you get the best of both worlds. Each sham that you create is a http server which means you only need to point your code at a different uri. Each sham also provides methods for mocking requests and records a list of all the requests so that you can write expectations about the http calls your code is making.\n\nAll of the code to create mock routes and write expectations can be done within your test functions, giving you the convenience and flexibility you get when using mocking libraries as well as the confidence that a network request was made.\n\n## Getting Started\n\nFirst intall the npm module:\n```\nnpm install sham-it\n```\n\nThen in JavaScript follow the steps below to use sham-it to create a sham, mock out an endpoint, call it then check it was called.\n```js\n// Step 1: Import sham-it\nconst shamIt = require(\"sham-it\");\n\n(async function() {\n  // Step 2: Create a new sham using the defaults\n  const sham = await shamIt();\n\n  // or...\n  // create a new sham with all options\n  const shamWithOptions = await shamIt({\n    // port is the Port that the sham can be access on\n    port: 9001, // If not specified then one will be chosen automatically\n\n    // defaultReply is used when a mocked route isn't matched\n    defaultReply: {\n      status: 404, // 404 is the default status of the defaultReply\n\n      headers: { \"Content-Type\": \"text/plain\" }, // \"Content-Type\": \"text/plain\"\n      // is the default header of the defaultReply\n\n      body: \"Not Found\" // \"Not Found\" is the default body of the default reply\n    }\n  });\n\n  // Step 3: Get the uri for the Sham\n  console.log(`The uri is a property on the Sham Client: ${sham.uri}`); // http://localhost:8000\n\n  // Step 4: Mock out an endpoint\n  const matcher = await sham.addMatcher({\n    // when is a function for building a matcher. (Required, will throw an error if not supplied)\n    when: ({ and, equals }) =>\n      and(equals(\"method\", \"GET\"), equals(\"pathname\", \"/a/b/c\")),\n\n    // Mocked response that's returned if the matcher function returns true\n    // (Required, will throw an error if not supplied)\n    respond: {\n      status: 200, // Optional: Defaults to 200\n      headers: { \"Content-Type\": \"application/json\" }, // Optional: Defaults to { \"Content-Type\": \"application/json\" }\n      body: { my: \"data\" } // If an object is supplied it is automatically stringified using JSON.stringify(...)\n    }\n\n    // Optional: You can also pass in a 3rd parameter for the number of times the matcher should match.\n    // After which it will be deleted, if no value is specified then the matcher will match an unlimited number of times.\n  });\n  console.log(matcher); // { id: \"...\", when: {...}, respond: { status: ..., headers: {...}, body: {...} } }\n\n  // Step 5: Send a request to the sham\n  const fetch = require(\"node-fetch\");\n\n  const response = await fetch(`${sham.uri}/a/b/c`);\n\n  console.log(response.status === matcher.respond.status); // true\n  console.log(\n    response.headers.get(\"Content-Type\") ===\n      matcher.respond.headers[\"Content-Type\"]\n  ); // true\n\n  const body = await response.json();\n  console.log(body.my === matcher.respond.body.my); // true\n\n  // You can also now see the call by calling getRequest();\n  console.log(await sham.getRequests()); // [{ request: {...}, matcher: {...}, response: {...} }]\n\n  // Step 6: In your tests you can expect that the sham received the correct request by doing\n  expect(\n    await sham.hasBeenCalledWith(({ and, equals }) =>\n      and(equals(\"method\", \"GET\"), equals(\"pathname\", \"/a/b/c\"))\n    )\n  ).toBe(true);\n  // If the expectation fails you will receive full details about the reason why similar to when\n  // you call expect(jest.fn()).toHaveBeenCalledWith(...)\n\n  // Step 7: Reset the mocked routes and calls\n  await sham.reset();\n  console.log(await sham.getRequests()); // []\n\n  // Step 8: Close the sham to stop it listening\n  await sham.close();\n  await shamWithOptions.close();\n})();\n```\n\n## Examples\n\nThe sham-it repo contains the following testing examples.\n\n### Testing a function which calls an api you want to mock\n\nThe [request-example.js](https://github.com/dos-j/sham-it/tree/master/examples/request-example.js) and [request-example.test.js](https://github.com/dos-j/sham-it/tree/master/examples/request-example.test.js) are examples of testing a function which is using request to send requests to an api.\n\nInstead of mocking out the request library, you could use sham-it to run integration tests and make sure that the right http calls will actually be sent.\n\n### Testing a web service which calls an api you want to mock\n\nThe [supertest-example.js](https://github.com/dos-j/sham-it/tree/master/examples/supertest-example.js) and [supertest-example.test.js](https://github.com/dos-j/sham-it/tree/master/examples/supertest-example.test.js) are examples of testing an express api which (using request) calls an external api to validate the incoming requests.\n\nWhen trying to run integration tests against API's having to mock out calls to external services can be difficult and in doing so undermines the value of the tests. With sham-it you can run integration tests against mock/stub api's, but still get the same convenience and flexibility provided by mocking libraries.\n\n## Roadmap\n\nFor our future plans and roadmap we are using GitHub Projects. You can see our projects [here](https://github.com/dos-j/sham-it/projects)\n\n## Issues\n\nIf you find any problems with sham-it or have any feature requests please [log them here](https://github.com/dos-j/sham-it/issues?state=open).\n\n## Contributing\n\nPull requests are more than welcome!\n\n## Maintainers\n* [Jason Hewison](https://github.com/JasonHewison)\n\n## License\n\nLicensed under [MIT](./LICENSE).\n\n","starsCount":1,"created":"2017-03-28T15:38:34.245Z","modified":"2017-05-25T01:50:11.143Z","lastPublisher":{"name":"jasonhewison","email":"jhewison@gmail.com"},"owners":[{"name":"jasonhewison","email":"jhewison@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"sham-it","_nodeVersion":"7.10.0","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/sham-it-2.0.2.tgz_1495677009666_0.3704545327927917"},"_npmUser":{"name":"jasonhewison","email":"jhewison@gmail.com"},"_npmVersion":"4.2.0","_rev":"7-631862261951e7995d19c68ce8527209","_shasum":"443b2a8ec8da0380bf5f7edea219401903e0285a","author":{"name":"dos-j"},"bugs":{"url":"https://github.com/dos-j/sham-it/issues"},"directories":{},"dist-tags":{"latest":"2.0.2"},"dist":{"shasum":"443b2a8ec8da0380bf5f7edea219401903e0285a","tarball":"https://registry.npmjs.org/sham-it/-/sham-it-2.0.2.tgz"},"maintainers":[{"name":"jasonhewison","email":"jhewison@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-05-25T01:50:11.143Z","created":"2017-03-28T15:38:34.245Z","1.0.0":"2017-03-28T15:38:34.245Z","1.1.0":"2017-03-29T11:22:28.992Z","1.2.0":"2017-04-02T15:44:55.329Z","2.0.0":"2017-05-18T01:52:57.916Z","2.0.1":"2017-05-18T14:35:29.422Z","2.0.2":"2017-05-25T01:50:11.143Z"},"users":{"jasonhewison":true}}}