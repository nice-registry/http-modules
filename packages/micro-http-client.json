{"name":"micro-http-client","version":"0.0.8","description":"Wraps the Fetch API adding straightforward request and response processing","main":"dist/main.js","files":["dist/main.js","src"],"license":"MIT","scripts":{"prepublish":"rollup -c","start":"rollup -c --watch","start-test":"jest --watch","test":"eslint . && jest"},"repository":"https://github.com/remerge/micro-http-client","devDependencies":{"babel-plugin-transform-async-to-generator":"^6.24.1","babel-preset-env":"^1.4.0","babel-preset-es2015-rollup":"^3.0.0","eslint":"^3.19.0","eslint-config-airbnb-base":"^11.2.0","eslint-plugin-import":"^2.2.0","jest":"^20.0.1","rollup":"^0.41.6","rollup-plugin-babel":"^2.7.1","rollup-watch":"^3.2.2"},"module":"src/main.js","versions":[{"number":"0.0.1","date":"2017-05-24T10:51:30.119Z"},{"number":"0.0.2","date":"2017-05-26T10:20:30.871Z"},{"number":"0.0.3","date":"2017-05-26T10:45:24.837Z"},{"number":"0.0.4","date":"2017-05-26T10:59:25.637Z"},{"number":"0.0.5","date":"2017-05-29T12:57:09.455Z"},{"number":"0.0.6","date":"2017-05-29T15:18:49.977Z"},{"number":"0.0.7","date":"2017-05-29T15:47:20.534Z"},{"number":"0.0.8","date":"2017-05-29T15:49:10.781Z"}],"readme":"# micro-http-client\n\nA thin wrapper over [fetch](https://developer.mozilla.org/en/docs/Web/API/Fetch_API), used to specify common request and response processing in a single location.\n\nSpecial thanks to [Remerge](https://www.remerge.io/) for open sourcing this library.\n\n## Motivation\n\nThe Fetch API covers about 90% of the use cases that most existing HTTP client libraries exist to address. However, in practice you often want to handle all of an application's requests the same way, coupled to application state (like authentication credentials). This library exists to solve that problem.\n\nMany of the existing implementations also offer extensive APIs for common scenarios, with fluent interfaces and lots of methods. This library aims to do the opposite, offering the minimum surface area capable of addressing all typical application scenarios.\n\nIn particular this library aims to offer an API whose usage can be verified through static analysis, so the utility functions offered here are all named exports, they never mutate their inputs, and they're stateless. In other words, aim to be unbreakable.\n\n## Usage\n\n```js\nimport { createFetch, prependHost, addHeaders, processBody, rejectIfUnsuccessful } from '@remerge/http-client';\nimport store from 'my-application-state';\n\nconst fetch = createFetch({\n  requestReducers: [\n    prependHost(process.env.API_HOST),\n    addHeaders({\n      Accept: 'application/vnd.api+json',\n      'Content-Type': 'application/json',\n    }),\n    addHeaders(() => store.getAuthorizationHeaders()),\n    processBody(JSON.stringify),\n  ],\n  responseReducers: [\n    rejectIfUnsuccessful,\n    response => response.json(),\n  ],\n});\n\nfetch('/profile');\n```\n\nThis defines a client which will prepend the `process.env.API_HOST` host to incoming request URLs, add default content type headers and authorization headers from the application store and send the request body as a JSON string.\n\nResponses with a non-successful status code will cause the Promise chain to reject, and will otherwise be unwrapped, returning only the parsed JSON body of the Response.\n\n## Installation\n\nAvailable as an NPM exporting a UMD module.\n\n```sh\n# npm install micro-http-client\nyarn add micro-http-client\n```\n\n## Reducers\n\nA reducer is a function which takes a request or response object and returns a new object. Each will be called in turn to set up the request before it's passed to `global.fetch()`, and process the response once it's received.\n\nReducers may return a Promise.\n\n### Request Reducer\n\n```js\nfunction requestReducer(request: Object) => Promise<Object> | Object;\n```\n\nA request reducer is any function that takes a request object and returns a new request object. A simple example of a request reducer might be one that adds headers to the request before it's sent.\n\n#### `request`\n\nThe `request` parameter is always an object matching the second parameter of the [Request constructor](https://developer.mozilla.org/en-US/docs/Web/API/Request/Request), with an additional `url` property assigned the value passed as the first argument to the `fetch()` method.\n\nIt is a plain JavaScript object rather than a `Request` instance because `Request` instances are very difficult to reduce over: you can only mutate the `Headers` object in-place, and the `body` of the `Request` is only accessible as a stream, which is single-use and difficult to clone.\n\nPlain JavaScript objects, on the other hand, are easy to work with, well-understood and many tools exist that can process them.\n\n### Response Reducer\n\n```js\nfunction responseReducer(response: any) => any;\n```\n\nResponse reducers may take and receive anything, the only restriction is that the first response reducer will receive the result of the `fetch()` call directly, so it is guaranteed to be a [`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response) instance.\n\nLike `Request`s, `Response` instances are very difficult to reduce over, but there are many situations where the stream properties of the `Response` might be useful, so this library does not modify the original `Response` object at all.\n\nFor the common case where only the body of the `Response` is desired, it can be trivially converted with a one-line function. Subsequent reducers can then process the result as a plain JavaScript object.\n\n```js\nconst fetch = createFetch({\n  responseReducers: [\n    response => response.json(),\n  ],\n});\n```\n\n## API\n\n### `createFetch({ requestReducers: [], responseReducers: [] })`\n\nTakes as input two arrays, one of request reducers and one of response reducers.\n\nReturns a function identical to the global [`fetch()`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch) method in its two-parameter form.\n\n```js\nfunction fetch(url: String, options: Object) => Promise\n```\n\nNote that it does not accept a `Request` object (as in the one-parameter form of `fetch()`) because these are problematic to reduce over.\n\nWhen called, it will:\n\n1. Construct a copy of the `options` object with an additional `url` property assigned the value of the `url` parameter\n2. Iterate over the `requestReducers` array, invoking the first function with the object from `#1`, and each subsequent reducer function with the return value of the last\n3. Call the global `fetch()` method with the result\n4. Iterate over the `responseReducers` array, invoking the first function with the `Response` from `fetch()`, and each subsequent reducer function with the return value of the last\n5. Return a Promise that resolves with the result\n\n## Standard Reducers\n\nIncluded is a collection of basic reducers to facilitate common application scenarios. Don't like them? Don't use them, they're very small and easy to replace with your own functions.\n\n### `prependHost(string)`\n\nPrepends the given host to all requests. Requests are expected to contain a URL which is an absolute path fragment.\n\nNote that any URL which isn't an absolute path will cause an error, since \"prepend host\" doesn't make sense if a host is already present. We could replace the host, but that's not necessarily predictable behavior.\n\nWorse, by using this reducer the consumer is indicating that they expect all processed requests to be delivered to the same host and it's likely they'll be adding authentication information etc. If we transparently deliver the request to a different host we might accidentally expose that.\n\nMoreover, it's more likely to be an error than not if the consumer has given us a URL with a fully-specified host.\n\n#### Examples\n\n```js\nconst fetch = createFetch({ requestReducers: [\n  prependHost('https://api.remerge.io/'),\n]});\nfetch('/campaigns'); // -> GET \"https://api.remerge.io/campaigns\"\nfetch('https://www.google.com') // throws ReducerError\n```\n\n### `addHeaders(object|function)`\n\nIncludes the given headers in every request. Useful for MIME type and authentication headers.\n\nParameter may be an object or a function returning an object or a Promise resolving to an object.\n\nAny headers specified on the request will override those set using `addHeaders()`.\n\n#### Examples\n\n```js\nconst fetch = createFetch({ requestReducers: [\n  addHeaders({ Accept: 'application/json' }),\n  addHeaders(() => this.getAuthenticationHeaders()),\n]});\nfetch('/campaigns'); // -> { Accept: 'application/json', auth headers... }\nfetch('/campaigns', { headers: { Accept: 'text/csv' } }); // -> { Accept: 'text/csv' }\n```\n\n### `processBody(function)`\n\nApplies the given function to the request or response body, replacing the original. The function may return a promise.\n\nThe function will not be invoked unless the body property is present.\n\nNote that a GET or HEAD request cannot have a body, and no special handling is included for converting the body to URL parameters, although this would be a good candidate for a future reducer.\n\n#### Examples\n\n```js\nconst fetch = createFetch({\n  requestReducers: [ processBody(JSON.stringify) ],\n  responseReducers: [ (response) => response.json(), processBody(JSON.parse) ],\n});\n```\n\n### `rejectIfUnsuccessful`\n\nThrows an error on any non-success HTTP status code.\n\n#### Examples\n\n```js\nconst fetch = createFetch({\n  responseReducers: [ rejectIfUnsuccessful ],\n});\nfetch('/my/profile', { method: 'PUT' })\n  .catch((error) => {\n    if (error.response.status === 422) {\n      // Handle validation failure\n    }\n  })\n```\n","created":"2017-05-24T10:51:30.119Z","modified":"2017-05-29T15:49:10.781Z","lastPublisher":{"name":"wmadden","email":"w.a.madden@gmail.com"},"owners":[{"name":"wmadden","email":"w.a.madden@gmail.com"}],"other":{"_attachments":{},"_id":"micro-http-client","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/micro-http-client-0.0.8.tgz_1496072949734_0.7525792049709707"},"_npmUser":{"name":"wmadden","email":"w.a.madden@gmail.com"},"_rev":"8-ae823411d6a53e9fa1bb49834de40346","directories":{},"dist-tags":{"latest":"0.0.8"},"dist":{"shasum":"c4ff05fd60712b38eaf97c35de581fc75f62b4ab","tarball":"https://registry.npmjs.org/micro-http-client/-/micro-http-client-0.0.8.tgz"},"maintainers":[{"name":"wmadden","email":"w.a.madden@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-05-29T15:49:10.781Z","created":"2017-05-24T10:51:30.119Z","0.0.1":"2017-05-24T10:51:30.119Z","0.0.2":"2017-05-26T10:20:30.871Z","0.0.3":"2017-05-26T10:45:24.837Z","0.0.4":"2017-05-26T10:59:25.637Z","0.0.5":"2017-05-29T12:57:09.455Z","0.0.6":"2017-05-29T15:18:49.977Z","0.0.7":"2017-05-29T15:47:20.534Z","0.0.8":"2017-05-29T15:49:10.781Z"}}}