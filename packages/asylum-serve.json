{"name":"asylum-serve","version":"1.0.6","description":"Async HTTP microservices runtime","repository":"https://github.com/diorahman/asylum-serve","homepage":"https://github.com/diorahman/asylum-serve","dependencies":{"babel-runtime":"6.3.19","commander":"2.9.0","media-typer":"0.3.0","raw-body":"2.1.5"},"files":["build/lib/index","build/bin/asylum-serve"],"main":"./build/lib/index.js","bin":{"asylum-serve":"./build/bin/asylum-serve"},"scripts":{"gulp":"gulp","test":"gulp test"},"devDependencies":{"ava":"0.11.0","babel-eslint":"4.1.7","babel-plugin-module-alias":"1.1.1","babel-plugin-syntax-async-functions":"6.5.0","babel-plugin-transform-async-to-generator":"6.4.6","babel-plugin-transform-runtime":"6.4.3","babel-preset-es2015":"6.3.13","babel-register":"6.5.2","del":"2.2.0","eslint":"1.10.3","eslint-config-standard":"4.4.0","eslint-plugin-standard":"1.3.1","gulp":"3.9.0","gulp-ava":"0.7.0","gulp-babel":"6.1.1","gulp-cached":"1.1.0","gulp-eslint":"1.1.1","gulp-ext":"1.0.0","gulp-task-listing":"1.0.1","request-promise":"2.0.0","then-sleep":"1.0.1"},"ava":{"files":["build/test/*.js"]},"gitHead":"3cf6db3b826b1d5ec214ccde7d53eabd3f8026af","versions":[{"number":"1.0.0","date":"2016-04-16T00:27:50.925Z"},{"number":"1.0.1","date":"2016-04-16T00:29:10.794Z"},{"number":"1.0.2","date":"2016-04-16T00:33:16.754Z"},{"number":"1.0.3","date":"2016-04-16T00:34:40.867Z"},{"number":"1.0.5","date":"2016-04-16T00:39:14.972Z"},{"number":"1.0.6","date":"2016-04-16T00:41:43.079Z"}],"readme":"![](https://cldup.com/JDmmHX3uhF.svg)\n\n_**Micro —** Async HTTP microservices_\n\n[![Build Status](https://travis-ci.org/zeit/micro.svg?branch=master)](https://travis-ci.org/zeit/micro) ![NPM version](https://badge.fury.io/js/micro.svg)\n\n## Features\n\n* **Easy**. Designed for usage with `async` and `await` ([more](https://jakearchibald.com/2014/es7-async-functions/))\n* **Fast**. Ultra-high performance (even JSON parsing is opt-in).\n* **Micro**. The whole project is ~100 lines of code.\n* **Agile**. Super easy deployment and containerization.\n* **Simple**. Oriented for single purpose modules (function).\n* **Explicit**. No middleware. Modules declare all dependencies.\n* **Standard**. Just HTTP!\n\n## Example\n\nThe following example `sleep.js` will wait before responding (without blocking!)\n\n```js\nimport { send } from 'micro';\nimport sleep from 'then-sleep';\nexport default async function (req, res) {\n  await sleep(500);\n  send(res, 200, 'Ready!');\n}\n```\n\nTo run the microservice on port `3000`, use the `micro` command:\n\n```bash\n$ micro -p 3000 sleep.js\n```\n\n## Documentation\n\n### Installation\n\n**Note**: `micro` requires Node `0.12` or later\n\nInstall from NPM:\n\n```js\n$ npm init\n$ npm install micro --save\n```\n\nThen in your `package.json`:\n\n```js\n\"scripts\": {\n  \"start\": \"micro -p 3000 index.js\"\n}\n```\n\nThen write your `index.js` (see above for an example). To run your\napp and make it listen on `http://localhost:3000` run:\n\n```bash\n$ npm start\n```\n\n### CLI\n\n```\n\n  Usage: micro [options] <file>\n\n  Options:\n\n    -h, --help      output usage information\n    -V, --version   output the version number\n    -p, --port      Port to listen on (3000)\n    -n, --no-babel  Skip Babel transformation\n\n```\n\nBy default, `micro` will transpile the target file and its relative dependencies so that ES6 and `async`/`await` an [ES6](http://rauchg.com/2015/ecmascript-6/) work for you.\n\nFor production, we recommend you first transpile and use `--no-babel` to make bootup time much faster. That said, if you don't care about how long it takes to boot, the default flags are perfectly suitable for production.\n\nRead more about [Transpilation](#transpilation) to understand what transformations are recommended.\n\n### API\n\n#### micro\n**`micro(fn, { onError = null })`**\n\n- This function is exposed as the `default` export.\n- Use `import micro from 'micro'` or `require('micro')`.\n- Returns a [`http.Server`](https://nodejs.org/dist/latest-v4.x/docs/api/http.html#http_class_http_server) that uses the provided `fn` as the request handler.\n- The supplied function is run with `await`. It can be `async`!\n- The `onError` function is invoked with `req, res, err` if supplied (see [Error Handling](#error-handling))\n- Example:\n    \n  ```js\n  import micro from 'micro';\n  import sleep from 'then-sleep';\n  const srv = micro(async function (req, res) {\n    await sleep(500);\n    res.writeHead(200);\n    res.end('woot');\n  });\n  srv.listen(3000);\n  ```\n\n#### json \n\n**`json(req, { limit = '1mb' })`**\n\n- Use `import { json } from 'micro'` or `require('micro').json`.\n- Buffers and parses the incoming body and returns it.\n- Exposes an `async` function that can be run with  `await`.\n- `limit` is how much data is aggregated before parsing at max. Otherwise, an `Error` is thrown with `statusCode` set to `413` (see [Error Handling](#error-handling)). It can be a `Number` of bytes or [a string](https://www.npmjs.com/package/bytes) like `'1mb'`.\n- If JSON parsing fails, an `Error` is thrown with `statusCode` set to `400` (see [Error Handling](#error-handling))\n- Example:\n    \n  ```js\n  import { json, send } from 'micro';\n  export default async function (req, res) {\n    const data = await json(req);\n    console.log(data.price);\n    send(res, 200);\n  }\n  ```\n  \n#### send\n\n**`send(res, statusCode, data = null)`**\n\n- Use `import { send } from 'micro'` or `require('micro').send`.\n- `statusCode` is a `Number` with the HTTP error code, and must always be supplied.\n- If `data` is supplied and is an `object`, it's automatically serialized as JSON. `Content-Type` and `Content-Length` are automatically set.\n- If JSON serialization fails (for example, if a cyclical reference is found), a `400` error is thrown (see [Error Handling](#error-handling)).\n- Example\n    \n  ```js\n  import { send } from 'micro';\n  export default async function (req, res) {\n    send(res, 400, { error: 'Please use a valid email' });\n  }\n  ```\n\n#### sendError\n\n**`send(req, res, error)`**\n\n- Use `import { sendError } from 'micro'` or `require('micro').sendError`.\n- Used as the default handler for `onError`.\n- Automatically sets the status code of the response based on `error.statusCode`.\n- Sends the `error.message` as the body.\n- During development (when `NODE_ENV` is set to `'development'`), stacks are printed out with `console.error` and also sent in responses.\n- Usually, you don't need to invoke this method yourself, as you can use the [built-in error handling](error-handling) flow with `throw`.\n\n<a name=\"error-handling\"></a>\n\n### Error handling \n\nMicro allows you to write robust microservices. This is accomplished primarily by bringing sanity back to error handling and avoiding callback soup.\n\nIf an error is thrown and not caught by you, the response will automatically be `500`. **Important:** during development mode (if the env variable `NODE_ENV` is `'development'`), error stacks will be printed as `console.error` and included in the responses.\n\nIf the `Error` object that's thrown contains a `statusCode` property, that's used as the HTTP code to be sent. Let's say you want to write a rate limiting module:\n\n```js\nimport rateLimit from 'my-rate-limit';\nexport default async function (req, res) {\n  await rateLimit(req);\n  // … your code\n}\n```\n\nIf the API endpoint is abused, it can throw an error like so:\n\n```js\nif (tooMany) {\n  const err = new Error('Rate limit exceeded');\n  err.statusCode = 429;\n  throw err;\n}\n```\n\nThe nice thing about this model is that the `statusCode` is merely a suggestion. The user can override it:\n\n```js\ntry {\n  await rateLimit(req);\n} catch (err) {\n  if (429 == err.statusCode) {\n    // perhaps send 500 instead?\n    send(res, 500);\n  }\n}\n```\n\nIf the error is based on another error that **Micro** caught, like a `JSON.parse` exception, then `originalError` will point to it.\n\nIf a generic error is caught, the status will be set to `500`.\n\nIn order to set up your own error handling mechanism, you can pass a custom `onError` function to micro:\n\n```js\nconst myErrorHandler = async (req, res, err) => {\n  // your own logging here\n  res.writeHead(500);\n  res.end('error!');\n};\nmicro(handler, { onError: myErrorHandler });\n```\n\n### Testing\n\nMicro makes tests compact and a pleasure to read and write.\nWe recommend [ava](https://github.com/sindresorhus/ava), a highly parallel micro test framework with built-in support for async tests:\n\n```js\nimport test from 'ava';\nimport listen from './listen';\nimport { send } from 'micro';\nimport request from 'request-promise';\n\ntest('my endpoint', async t => {\n  const fn = async function (req, res) {\n    send(res, 200, { test: 'woot' });\n  };\n  const url = await listen(fn);\n  const body = await request(url);\n  t.same(body.test, 'woot');\n});\n```\n\nLook at the `test/_listen` helper for a function that returns a URL with an ephemeral port every time it's called.\n\n### Transpilation\n\nThe [Babel](https://babeljs.io/) configuration `micro` uses is:\n\n```json\n{\n  \"presets\": [\"es2015\"],\n  \"plugins\": [\n    \"transform-runtime\",\n    \"syntax-async-functions\",\n    \"transform-async-to-generator\"\n  ]\n}\n```\n\nThese requires the following NPM modules (versions might vary)\n\n```json\n{\n    \"babel-plugin-syntax-async-functions\": \"6.3.13\",\n    \"babel-plugin-transform-async-to-generator\": \"6.4.6\",\n    \"babel-plugin-transform-runtime\": \"6.4.3\",\n    \"babel-preset-es2015\": \"6.3.13\"\n}\n```\n\n### Deployment\n\nYou can use the `micro` CLI for `npm start`:\n\n```json\n{\n  \"name\": \"my-microservice\",\n  \"dependencies\": {\n    \"micro\": \"x.y.z\"\n  },\n  \"scripts\": {\n    \"start\": \"micro -p 3000 microservice.js\"\n  }\n}\n```\n\nThen your `Dockerfile` can look like this:\n\n```\nFROM node:argon\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\nCOPY package.json /usr/src/app/\nRUN npm install\nCOPY . /usr/src/app\nEXPOSE 3000\nCMD [ \"npm\", \"start\" ]\n```\n\n### Contributing\n\n- Run `gulp help`  to see available tasks.\n- Before submitting a PR, please run `gulp lint` and `gulp test`.\n- We use [`standard`](https://github.com/feross/standard) + semicolons.\n- Please [be welcoming](http://contributor-covenant.org/).\n\n## Credits\n\n- Thanks Tom Yandell and Richard Hodgson for donating the  `micro` npm name.\n- Copyright © 2016 Zeit, Inc and project authors.\n- Licensed under MIT.\n- ▲\n","created":"2016-04-16T00:27:50.925Z","modified":"2016-04-16T00:41:43.079Z","lastPublisher":{"name":"diorahman","email":"dio@hooq.tv"},"owners":[{"name":"diorahman","email":"dio@hooq.tv"}],"other":{"_attachments":{},"_from":".","_id":"asylum-serve","_nodeVersion":"4.4.0","_npmOperationalInternal":{"host":"packages-16-east.internal.npmjs.com","tmp":"tmp/asylum-serve-1.0.6.tgz_1460767300754_0.02242718287743628"},"_npmUser":{"name":"diorahman","email":"dio@hooq.tv"},"_npmVersion":"3.8.1","_rev":"1-2485d6046f1f7f04ca02af4dffb627b8","_shasum":"7d891eac8038b90bc7da8767724d4c55d123ac81","author":{"name":"Dhi Aurrahman","email":"dio@hooq.tv"},"bugs":{"url":"https://github.com/diorahman/asylum-serve/issues"},"directories":{},"dist-tags":{"latest":"1.0.6"},"dist":{"shasum":"7d891eac8038b90bc7da8767724d4c55d123ac81","tarball":"http://registry.npmjs.org/asylum-serve/-/asylum-serve-1.0.6.tgz"},"maintainers":[{"name":"diorahman","email":"dio@hooq.tv"}],"readmeFilename":"Readme.md","time":{"modified":"2016-04-16T00:41:43.079Z","created":"2016-04-16T00:27:50.925Z","1.0.0":"2016-04-16T00:27:50.925Z","1.0.1":"2016-04-16T00:29:10.794Z","1.0.2":"2016-04-16T00:33:16.754Z","1.0.3":"2016-04-16T00:34:40.867Z","1.0.5":"2016-04-16T00:39:14.972Z","1.0.6":"2016-04-16T00:41:43.079Z"}}}