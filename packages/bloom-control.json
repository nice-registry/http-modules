{"name":"bloom-control","description":"Bloom Control integration for Node. Used in pair with Bloom, the HTTP REST API caching middleware.","version":"1.0.0-alpha.2","homepage":"https://github.com/valeriansaliou/node-bloom-control","license":"MIT","repository":"https://github.com/valeriansaliou/node-bloom-control","licenses":[{"type":"MIT","url":"https://github.com/valeriansaliou/node-bloom-control/blob/master/LICENSE"}],"main":"lib/bloom_control","engines":{"node":">= 4.0.0"},"scripts":{"test":"check-build && istanbul cover _mocha","coveralls":"istanbul cover _mocha --report lcovonly && cat ./coverage/lcov.info | coveralls"},"devDependencies":{"check-build":"2.8.2","mocha":"3.4.2","mocha-lcov-reporter":"1.3.0","istanbul":"0.4.5","coveralls":"2.13.1"},"keywords":["bloom","cache","rest","api","integration"],"gitHead":"32f950bc5b505a9edde27df40597185a99e10a81","versions":[{"number":"1.0.0-alpha.0","date":"2017-06-21T12:21:35.624Z"},{"number":"1.0.0-alpha.1","date":"2017-06-21T12:25:58.976Z"},{"number":"1.0.0-alpha.2","date":"2017-06-21T14:34:19.899Z"}],"readme":"# node-bloom-control\n\n[![Build Status](https://img.shields.io/travis/valeriansaliou/node-bloom-control/master.svg)](https://travis-ci.org/valeriansaliou/node-bloom-control) [![Test Coverage](https://img.shields.io/coveralls/valeriansaliou/node-bloom-control/master.svg)](https://coveralls.io/github/valeriansaliou/node-bloom-control?branch=master) [![NPM](https://img.shields.io/npm/v/bloom-control.svg)](https://www.npmjs.com/package/bloom-control) [![Downloads](https://img.shields.io/npm/dt/bloom-control.svg)](https://www.npmjs.com/package/bloom-control)\n\n**Bloom Control integration for Node. Used in pair with Bloom, the HTTP REST API caching middleware.**\n\nBloom Control lets you control your Bloom cache, from your NodeJS code. Purge API cache on-demand, whenever your API worker updates a database model or performs some action that require cached data to be invalidated.\n\n## Who uses it?\n\n<table>\n<tr>\n<td align=\"center\"><a href=\"https://crisp.im/\"><img src=\"https://valeriansaliou.github.io/node-bloom-control/images/crisp.png\" height=\"64\" /></a></td>\n</tr>\n<tr>\n<td align=\"center\">Crisp</td>\n</tr>\n</table>\n\n_üëã You use bloom-control and you want to be listed there? [Contact me](https://valeriansaliou.name/)._\n\n## How to install?\n\nInclude `bloom-control` in your `package.json` dependencies.\n\nAlternatively, you can run `npm install bloom-control --save`.\n\n## How to use?\n\n### 1. Create the connection\n\n`node-bloom-control` can be instanciated as such:\n\n**‚û°Ô∏è Your Bloom instance is listening on a TCP socket:**\n\n```javascript\nvar BloomControl = require(\"bloom-control\").BloomControl;\n\nvar bloomControl = new BloomControl({\n  host  : \"::1\",  // Or '127.0.0.1' if you are still using IPv4\n  port  : 811,    // Default port is '811'\n  shard : 0       // Specify the Bloom shard to use, as \\\n                  //   a Bloom instance can host multiple cache shards, eg. for different API workers\n});\n```\n\n**‚û°Ô∏è Your Bloom instance is listening on an UNIX socket:**\n\n```javascript\nvar BloomControl = require(\"bloom-control\").BloomControl;\n\nvar bloomControl = new BloomControl({\n  socket : \"/tmp/bloom.sock\",  // Path to local UNIX socket (NodeJS user must have permission to write + read socket file)\n  shard  : 0                   // Specify the Bloom shard to use, as \\\n                               //   a Bloom instance can host multiple cache shards, eg. for different API workers\n});\n```\n\n### 2. Purge cache collections\n\nUse the same `bloomControl` instance to purge cache collections:\n\n```javascript\n// Notice: all methods return 'true' if executed immediately, 'false' if deferred (ie. TCP socket disconnected)\n\n// Purge cache for a given bucket (all authenticated users)\nbloomControl.purge.bucket(`cache_bucket_id`)\n\n// Purge cache for a multiple buckets at once (all authenticated users)\nbloomControl.purge.bucket([\n  `cache_bucket_id_1`,\n  `cache_bucket_id_2`\n])\n\n// Purge all cache for a given authenticated user\n// Notice: identifier and token can usually be found in your Basic Auth headers\nbloomControl.purge.user(`user_identifier`, `user_token`)\n\n// Purge all cache for multiple authenticated users at once\nbloomControl.purge.user([\n  [`user_identifier`, `user_token`],\n  [`user_identifier`, `user_token`]\n])\n```\n\n### 3. Teardown connection\n\nIf you need to teardown an ongoing connection to Bloom, use:\n\n```javascript\nbloomControl.close();  // Returns: true if closed, false if already closed\n\n// Notice: cache purge calls will now throw an error as the connection is now closed.\n```\n\n## What is Bloom?\n\n‚ÑπÔ∏è **Wondering what Bloom is?** Check out **[valeriansaliou/bloom](https://github.com/valeriansaliou/bloom)**.\n\n## How is it linked to Bloom?\n\n`node-bloom-control` maintains a persistent TCP connection to the Bloom Control interface that's listening on your running Bloom instance. In case `node-bloom-control` gets disconnected from Bloom, it will retry to connect once the connection is established again. Pending cache purge requests that could not be transmitted to Bloom are stacked, up to a certain limit where further cache purge requests will be dropped and not stacked. Once the connection to Bloom Control is established again, stacked cache purge requests are transmitted to Bloom for processing.\n\nYou can configure the connection details of your Bloom instance when initializing `node-bloom-control` from your code; via the Bloom host and port, or UNIX socket.\n","created":"2017-06-21T12:21:35.624Z","modified":"2017-06-21T14:34:19.899Z","lastPublisher":{"name":"valerian.saliou","email":"valerian@valeriansaliou.name"},"owners":[{"name":"valerian.saliou","email":"valerian@valeriansaliou.name"}],"other":{"_attachments":{},"_from":".","_id":"bloom-control","_nodeVersion":"6.9.1","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/bloom-control-1.0.0-alpha.2.tgz_1498055658917_0.5170489337760955"},"_npmUser":{"name":"valerian.saliou","email":"valerian@valeriansaliou.name"},"_npmVersion":"4.6.1","_rev":"3-22e41ecefb970419f713117643fde69c","_shasum":"ce7b6180cc64546b9d2aa2a80d51bc563a102d8f","author":{"name":"Valerian Saliou","email":"valerian@valeriansaliou.name","url":"https://valeriansaliou.name/"},"bugs":{"url":"https://github.com/valeriansaliou/node-bloom-control/issues"},"directories":{},"dist-tags":{"latest":"1.0.0-alpha.2"},"dist":{"shasum":"ce7b6180cc64546b9d2aa2a80d51bc563a102d8f","tarball":"https://registry.npmjs.org/bloom-control/-/bloom-control-1.0.0-alpha.2.tgz"},"maintainers":[{"name":"valerian.saliou","email":"valerian@valeriansaliou.name"}],"readmeFilename":"README.md","time":{"modified":"2017-06-21T14:34:19.899Z","created":"2017-06-21T12:21:35.624Z","1.0.0-alpha.0":"2017-06-21T12:21:35.624Z","1.0.0-alpha.1":"2017-06-21T12:25:58.976Z","1.0.0-alpha.2":"2017-06-21T14:34:19.899Z"}}}