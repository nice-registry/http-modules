{"name":"animus","version":"0.1.8","description":"Http framework with full offline capabilities","main":"dist/index.js","typings":"typings/index.d.ts","scripts":{"test":"karma start --single-run","test:watch":"karma start"},"repository":"https://github.com/zhakhalov/animus","keywords":["typescript","angular2","offline","ionic2","cordova","react","http","rest","resource","axios"],"license":"MIT","homepage":"https://github.com/zhakhalov/animus#readme","dependencies":{"axios":"^0.16.1","localforage":"^1.4.3","lodash":"^4.17.2","qs":"^6.3.0","url-pattern":"^1.0.3"},"devDependencies":{"@types/chai":"^3.4.35","@types/es6-shim":"^0.31.32","@types/mocha":"^2.2.40","@types/node":"^7.0.12","@types/qs":"^6.2.30","@types/sinon":"^2.1.2","awesome-typescript-loader":"^3.0.0-beta.17","chai":"^3.5.0","clean-webpack-plugin":"^0.1.14","coveralls":"^2.13.0","gulp":"^3.9.1","gulp-clean":"^0.3.2","gulp-tslint":"^7.0.1","gulp-typescript":"^3.1.3","gulp-typings":"^2.0.4","gulp-util":"^3.0.7","gulp-webpack":"^1.5.0","karma":"^1.6.0","karma-chai":"^0.1.0","karma-chrome-launcher":"^2.0.0","karma-mocha":"^1.3.0","karma-phantomjs-launcher":"^1.0.4","karma-sinon":"^1.0.5","karma-typescript":"^3.0.0","mocha":"^3.2.0","run-sequence":"^1.2.2","sinon":"^2.1.0","tslint":"^4.1.1","typescript":"^2.2.2","webpack":"^2.4.1","webpack-node-externals":"^1.5.4","webpack-stream":"^3.2.0"},"gitHead":"1325ba5369f29c26141653bcee733527d2745ebf","versions":[{"number":"0.1.0","date":"2017-01-04T22:33:13.383Z"},{"number":"0.1.1","date":"2017-01-04T22:36:48.626Z"},{"number":"0.1.2","date":"2017-01-09T15:01:55.061Z"},{"number":"0.1.3","date":"2017-04-26T20:07:12.879Z"},{"number":"0.1.4","date":"2017-05-29T21:47:53.183Z"},{"number":"0.1.5","date":"2017-05-29T21:59:06.513Z"},{"number":"0.1.6","date":"2017-05-30T09:12:10.104Z"},{"number":"0.1.7","date":"2017-06-05T08:24:19.596Z"},{"number":"0.1.8","date":"2017-06-11T22:08:38.905Z"}],"readme":"# Animus\n\n### Features\n\n- Brings to the application ability to build full offline experience.\n- Shows stored results before getting response from the server.\n- Stores results of the http requests on the browser side by using flexible [localForage](https://github.com/localForage/localForage) for future usage even after application was reloaded.\n- Provides TypeScript friendly interface based on decorators\n- Independent from any frameworks. Can be used with Angular, React, Vue etc.\n- Sending date with POST, PUT or DELETE methods in case if service is unreachable to queue for future invocation event if application is reloaded.\n\nCreation of this package was inspired by AngularJS [$resource](https://docs.angularjs.org/api/ngResource/service/$resource) and [$cachedResource](https://github.com/goodeggs/angular-cached-resource) libraries.\n\n[![Build Status](https://travis-ci.org/zhakhalov/animus.svg?branch=master)](https://travis-ci.org/zhakhalov/animus) [![Coverage Status](https://coveralls.io/repos/github/zhakhalov/animus/badge.svg?branch=master)](https://coveralls.io/github/zhakhalov/animus?branch=master)\n\n## Few Samples\n\nDefine resource using decorators.\n\n```typescript\nimport { Action, Resource, ResourceArray, ResourceInstance } from 'animus';\n\n/**\n * Single instance of the resource\n */\nexport interface Comment extends ResourceInstance {\n  id?: number;\n  comment: string;\n}\n\n/**\n * Array of the resources\n */\nexport interface Comments extends Array<Comment>, ResourceArray { }\n\n@Resource({\n  name: 'Comments.db', // The name of the localForage collection\n  url: '/api/articles/:articleId/comments(/:id)', // The url pattern '/:id' is an optional segment\n  params: { articleId: '@articleId', id: '@id' } // Parameters pattern for passing fields from the resource to the url.\n})\nexport class CommentsResource {\n  // Threat response as an array. Pick from cache array by given params.\n  @Action({ method: 'get', isArray: true })\n  public readonly findAllByArticle: (params: { articleId: number }) => Comments;\n\n  @Action({ method: 'get' })\n  public readonly findOne: (params: { articleId: number, id: number }) => Comment;\n\n  @Action({ method: 'get', localOnly: true })\n  public readonly findOneCached: (params: { articleId: number, id: number }) => Comments;\n\n  @Action({ method: 'post' })\n  public readonly create: (params: { articleId: number }, comment: Comment) => Comment;\n\n  @Action({ method: 'put' })\n  public readonly update: (params: { }, comment: Comment) => Comment;\n\n  @Action({ method: 'delete' })\n  public readonly remove: (params: { }, comment: Comment) => Comment;\n}\n\nconst commentsResource = new CommentsResource();\n```\n\nSince this package does not depend onto any certain framework there are no difficulties to use it as, for example, Angular provider\n\n```typescript\nimport { Injectable, Component, ... } from '@angular/core';\nimport { Resource, ... } from 'animus';\n\n@Injectable()\n@Resource({\n  /// ...\n})\nclass CommentsResource {\n  /// ...\n}\n\n@Component(...)\nclass CommentsComponent {\n\n  public comments: Comments;\n\n  constructor(\n    private commentsResource: CommentsResource\n  ) {\n    this.comments = this.commentsResource.findAllByArticle({ articleId: 1 });\n  }\n}\n```\n\n## Decorators\n\n### @Resource(metadata: ResourceMetadata)\nClass decorator. Declares new resource over the decorated class based on the given [ResourceMetadata](#resourcemetadata).\n\n```typescript\n@Resource({\n  name: 'Comments.db', // The name of the localForage collection\n  url: '/api/articles/:articleId/comments(/:id)', // The url pattern '/:id' is an optional segment\n  params: { articleId: '@articleId', id: '@id' } // Parameters pattern for passing fields from the resource to the url.\n})\nclass CommentsResource { ... }\n```\n\n#### Common configurations\n`Resource.common` - default resource configuration\n\n```typescript\nResource.common.networkStateAdapter = new CustomNetworkStateAdapter();\nResource.common.driver = CustomLocalForage._driver;\n```\n\n\n### @Action(metadata: ActionMetadata)\nProperty decorator. Declares resource action over the decorated method based on a given [ActionMetadata](#actionmetadata).\n\n```typescript\nclass CommentsResource {\n  @Action({ method: 'get' })\n  public readonly findOne: (params: { articleId: number, id: number }) => Comment;\n}\n```\n\n## Metadata\n\n### ResourceMetadata\nThis metadata contains configuration information for the resource.\n\n* `ResourceMetadata#url: String`\n  Url patters for the http. Action params will be passed to the url according to this pattern.\n  Segments prefixed with `:`(colon) will be replaced with action params, other will be passed to the query string params.\n\n  Example\n\n  ```typescript\n  url: `/api/library/:libraryId/books(/:bookId)`\n  ```\n  Param `bookId` in this example is optional.\n\n  See [url-pattern](https://www.npmjs.com/package/url-pattern) for extra information.\n\n\n* `ResourceMetadata#params: Object`\n  Bounding params pattern.\n  This params used to map resource instance to url params and also as a key in the local data storage.\n  Params prefixed with `@`(at) will be picked from resource instance according to names.\n\n  ```typescript\n  // Book resource with following structure:\n  {\n    id:1,\n    libraryId: 1\n  }\n\n  // Using params pattern:\n  {\n    bookId: '@id',\n    libraryId: '@libraryId'\n  }\n\n  // Will be mapped to the action params:\n  {\n    bookId: 1,\n    libraryId: 1\n  }\n  ```\n\n* `ResourceMetadata#http: AxiosInstance`\n  Axios instance used as http framework.\n  Can be easily replaced with custom instance of the axios. For example to mock http in testing purposes.\n\n  ```typescript\n  @Resource({\n    ...\n    http: new MockAdapter(axios.create())\n    ...\n  })\n  class CommentsResource {...}\n  ```\n\n* `ResourceMetadata#httpOnly: Boolean`\n   Do not perform any actions over storage.\n   Note: if true `httpOnly` and `localOnly` field on action decorators will be ignored.\n   Default is false\n\n* `ResourceMetadata#name: String`\n  Name of the LocalForage database. If name is not specified class name will be used.\n\n* `ResourceMetadata#driver: String | LocalForageDriver | LocalForageDriver[]`\n  LocalForage driver.\n\n  Default is `localforage.LOCALSTORAGE`\n\n* `ResourceMetadata#bootstrap: Promise`\n  Defer initialization of resource.\n  ```typescript\n\n  Resource.common.bootstrap = new Promise(resolve => $(document).ready(() => resolve()));\n\n  ```\n\n* `ResourceMetadata#autoCompact: Boolean`\n\n  Whether to perform auto compaction after each array response is handled.\n  Process is similar to garbage collection.\n\n  It is not recommended to use auto compaction if it is expected to have large amount of array responses cached, e.g pagination.\n  Use Resource defined `$compact` function on the instance of the decorated class to perform compaction manually e.g. on application start.\n\n  ```typescript\n  class ArticlesResource {\n    public readonly $compact() => Promise<void>;\n  }\n\n  await new ArticlesResource().$compact()\n  ```\n  Default is `true`.\n\n* `ResourceMetadata#networkState: NetworkStateAdapter`\n\n  Network state adapter.\n  Used to determine network availability state of the application.\n  Also notify resource about application is getting online/offline\n\n  Default is `BrowserNetworkStateAdapter`. Uses `navigator.online` property and 'online'/'offline' events on the window.\n\n* `ResourceMetadata#reattemptInterval: number`\n  How often to attempt to perform actions over http if server is unavailable (receives 5** codes)\n\n  Default `60000` - every minute\n\n### ActionMetadata\nThis metadata contains configuration information for the resource action.\n\n* `ActionMetadata#method: 'get' | 'post' | 'put' | 'delete'`\n  Action method.\n\n  `Post` and `put` methods also create temporary instances so those instances will be added to the array.\n  `Delete` method also removes instance from the local array.\n\n* `ActionMetadata#isArray: Boolean`\n  Threat response as array.\n\n* `ActionMetadata#url: String`\n  Override resource url.\n\n* `ActionMetadata#params: Object`\n  Overrides resource bounding params.\n\n* `ActionMetadata#localOnly: Boolean`\n  Do not perform any actions over http.\n\n  Default is `false`\n\n* `ActionMetadata#httpOnly: Boolean`\n  Do not perform any actions over the local data storage.\n\n  Default is `false`\n\n* `ActionMetadata#config`\n  Additional http action config\n\n  ```typescript\n  @Action({\n    method: 'get',\n    config: {\n      headers: {\n        'X-My-Custom-Header': 'MyCustomValue'\n      }\n    }\n  })\n  ```\n\n## Interfaces\n\n### ResourceInstance\nResource instance and indicators to determine whether it was resolved either by http or from cache.\nExtend your instance model interfaces from this abstraction.\n\n#### Example\n```typescript\ninterface Comment extends ResourceInstance {\n  id: number;\n  content: string;\n}\n```\n\n* `ResourceInstance#$new: Boolean`\n\n  Whether the resource is newly created and not submitted to the server yet.\n  Once resource is submitted this field will be deleted from the object.\n\n* `ResourceInstance#$removed: Boolean`\n\n  Whether the resource is removed or waiting for its removal due to server is unavailable.\n\n* `ResourceInstance#$storagePromise: Promise<this>`\n\n  Resolution of performing operations over the local data storage.\n  Once resolved this field will be deleted from the object.\n\n* `ResourceInstance#$httpPromise: Promise<this>`\n\n  Resolution of performing operations over the http.\n  Once resolved this field will be deleted from the object.\n\n* `ResourceInstance#$formCache: Boolean`\n\n  Whether the resource is from the local data storage.\n  Once resolved over the http this field will be set to `true`.\n\n* `ResourceInstance#toJSON() => Object`\n  Produces regular JavaScript object from the resource.\n\n### ResourceArray\n  Represents an array of the resources and indicators to determine whether elements were resolved either by http or from cache.\n  Extend your arrays model interfaces from this abstraction.\n\n#### Example\n```typescript\ninterface Comments extends Array<Comment> ResourceArray {\n  id: number;\n}\n```\n\n* `ResourceInstance#$storagePromise: Promise<this>`\n\n  Resolution of performing operations over the local data storage.\n\n* `ResourceInstance#$httpPromise: Promise<this>`\n\n  Resolution of performing operations over the http.\n\n* `ResourceInstance#$formCache: Boolean`\n\n  Whether the resource is from the local data storage.\n\n* `ResourceInstance#toJSON() => Object`\n\n  Produces regular JavaScript array from the resource.\n\n\n### NetworkStateAdapter\nUsed to determine network availability state.\n\n* `isOnline: boolean`\n\n  Indicates whether internet connection is available.\n\n* `setOnlineHandler(handler: () => void) => void`\n\n  Set handler to be called once application get online.\n\n* `setOfflineHandler(handler: () => void) => void`\n\n  Set handler to be called once application get offline.\n\n## Resource object resolution\nNote that resource instances combines with results of the http requests by `Object.assign(...)` like mechanism.\nAll the fields from response will be assigned to the resource instance due to server authority principle,\nbut fields which was already in the resource will not be removed from it.\n\n## Local fields\nResource has *\"local only\"* fields. All the fields prefixed with `$`(dollar) or `__`(double underscore) will not be sent over http.\nSuch fields will be saved on the client side until they removed manually.\nThees fields are useful to store some kind of meta information such as references to another resource or timestamps of performed actions.\n\n## Clearing the cache\nUse Resource defined `$clear` function on the instance of the decorated class to perform clearing the resource data.\n\n```typescript\n\nclass ArticlesResource {\n  public readonly $clear() => Promise<void>;\n}\n\nawait new ArticlesResource().$clear()\n```\n\n## Reserved fields\nResource instances and resource arrays use some fields for internal purposes.\n\n**Please do not override or delete or set them to avoid unexpected behavior.**\n\n* `$fromCache` - Indicates whether array or instance is currently fetched from local data storage.\n* `$new` - Indicates whether the resource instance is newly created.\n* `$removed` - Indicates whether the resource instance is removed.\n* `$query` - Reference to itself in local data storage. Used to keep tracking of new object.\n* `$storagePromise` - Resolution of performing operations over the http.\n* `$httpPromise` - Resolution of performing operations over the http.\n\n\n## License\n\nThe MIT License (MIT)\n\nCopyright (c) <year> <copyright holders>\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n","starsCount":1,"created":"2017-01-04T22:33:13.383Z","modified":"2017-06-18T07:39:32.930Z","lastPublisher":{"name":"zhakhalov","email":"zhakhalov@gmail.com"},"owners":[{"name":"zhakhalov","email":"zhakhalov@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"animus","_nodeVersion":"7.10.0","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/animus-0.1.8.tgz_1497218917502_0.7783629142213613"},"_npmUser":{"name":"zhakhalov","email":"zhakhalov@gmail.com"},"_npmVersion":"4.2.0","_rev":"10-c50b5ac4f37159f9ebf031ddb59fd3e2","_shasum":"cfdd4e1e8b3873349dc85bd276cba3dec074888c","author":{"name":"Viktor Zhakhalov","email":"zhakhalov@gmail.com"},"bugs":{"url":"https://github.com/zhakhalov/animus/issues"},"directories":{},"dist-tags":{"latest":"0.1.8"},"dist":{"shasum":"cfdd4e1e8b3873349dc85bd276cba3dec074888c","tarball":"https://registry.npmjs.org/animus/-/animus-0.1.8.tgz"},"maintainers":[{"name":"zhakhalov","email":"zhakhalov@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-06-18T07:39:32.930Z","created":"2017-01-04T22:33:13.383Z","0.1.0":"2017-01-04T22:33:13.383Z","0.1.1":"2017-01-04T22:36:48.626Z","0.1.2":"2017-01-09T15:01:55.061Z","0.1.3":"2017-04-26T20:07:12.879Z","0.1.4":"2017-05-29T21:47:53.183Z","0.1.5":"2017-05-29T21:59:06.513Z","0.1.6":"2017-05-30T09:12:10.104Z","0.1.7":"2017-06-05T08:24:19.596Z","0.1.8":"2017-06-11T22:08:38.905Z"},"users":{"usex":true}}}