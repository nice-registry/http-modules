{"name":"koa-json-logger","version":"1.0.2","description":"KoaJS HTTP Request/Response/Error JSON format logger","repository":"https://github.com/rudijs/koa-json-logger","main":"./lib/koa-json-logger.js","scripts":{"test":"node --harmony node_modules/istanbul-harmony/lib/cli.js cover node_modules/mocha/bin/_mocha --root lib/ --dir test/coverage  -- -u exports -R spec","coveralls":"node --harmony node_modules/istanbul-harmony/lib/cli.js cover node_modules/mocha/bin/_mocha --root lib/ --dir test/coverage  -- -u exports -R spec && cat ./test/coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","lint":"jshint lib/ && jshint test/*.js"},"keywords":["koa","koajs","logger","json","logstash","elk"],"license":"MIT","engines":{"node":">=0.11.16","iojs":">= 1.0.0"},"devDependencies":{"chai":"^3.4.1","coveralls":"^2.11.6","istanbul-harmony":"^0.3.16","jshint":"^2.9.1","koa":"^1.1.2","mocha":"^2.3.4","sinon":"^1.17.2","supertest":"^0.15.0"},"dependencies":{"bunyan":"^1.5.1","lodash":"^4.0.0","uuid":"^2.0.1"},"gitHead":"f7a7e380b8762ce3f28054d4902f329231eb7b45","homepage":"https://github.com/rudijs/koa-json-logger#readme","versions":[{"number":"0.0.1","date":"2014-08-01T06:45:50.298Z"},{"number":"0.0.2","date":"2014-08-02T04:10:12.363Z"},{"number":"0.0.3","date":"2014-08-04T14:44:39.820Z"},{"number":"0.0.4","date":"2014-08-04T14:49:40.293Z"},{"number":"0.0.5","date":"2014-08-06T09:16:35.670Z"},{"number":"0.0.6","date":"2014-08-06T10:22:33.002Z"},{"number":"0.0.7","date":"2014-08-10T12:51:28.912Z"},{"number":"0.0.8","date":"2014-08-21T17:27:29.113Z"},{"number":"0.0.9","date":"2014-08-22T05:16:09.172Z"},{"number":"0.0.10","date":"2014-08-22T05:27:01.600Z"},{"number":"0.0.11","date":"2014-08-22T05:46:59.422Z"},{"number":"0.0.12","date":"2014-08-22T06:29:50.007Z"},{"number":"0.0.13","date":"2014-08-22T06:58:40.370Z"},{"number":"0.0.14","date":"2014-08-23T09:45:38.713Z"},{"number":"0.0.16","date":"2014-09-13T03:59:56.539Z"},{"number":"0.0.17","date":"2014-10-26T07:01:07.204Z"},{"number":"0.0.18","date":"2014-11-06T15:18:33.675Z"},{"number":"0.0.19","date":"2015-03-03T05:40:39.425Z"},{"number":"0.0.20","date":"2015-06-10T06:58:34.482Z"},{"number":"0.0.22","date":"2015-07-28T07:53:45.396Z"},{"number":"1.0.0","date":"2015-08-26T05:24:51.827Z"},{"number":"1.0.1","date":"2015-10-20T05:21:27.518Z"},{"number":"1.0.2","date":"2016-01-22T15:36:05.589Z"}],"readme":"koa-json-logger\n===============\n\nKoaJS HTTP Request/Response/Error JSON format logger.\n\n[![Build Status](https://travis-ci.org/rudijs/koa-json-logger.svg?branch=master)](https://travis-ci.org/rudijs/koa-json-logger)\n[![Coverage Status](https://coveralls.io/repos/rudijs/koa-json-logger/badge.png?branch=master)](https://coveralls.io/r/rudijs/koa-json-logger?branch=master)\n[![NPM version](https://badge.fury.io/js/koa-json-logger.svg)](http://badge.fury.io/js/koa-json-logger)\n[![Dependency Status](https://gemnasium.com/rudijs/koa-json-logger.svg)](https://gemnasium.com/rudijs/koa-json-logger)\n\nThe actual logging is done with [node-bunyan](https://github.com/trentm/node-bunyan)\n\nCredits and inspired by:\n\n* [KoaJS](https://github.com/koajs)\n* [express-winston](https://github.com/heapsource/express-winston)\n* [node-bunyan](https://github.com/trentm/node-bunyan)\n* [koa-bunyan](https://github.com/ivpusic/koa-bunyan)\n* [KoaJS Logger](https://github.com/koajs/logger)\n\n\nCode review, suggestions and pull requests very much welcome - thanks!\n\n## Overview\n\nThe basic goal of this module is to create log entries in JSON format for each HTTP request.\n\nSuccess (<400) log entries will contain Request and Response details.\n\nError (>=400) log entries will contain Request, Response and Error details.\n\nSuccess and Error logs will have their own file (two files).\n\nIn NODE_ENV development errors will also be output to the console.\n\n500 error responses are logged in full detail but the HTTP user response will always be only 'Internal Server Error'.\n\nLess than 500 and greater than 500 error responses are logged and passed through as is to the user in the HTTP response.\n\nHigher level goals are:\n\n- Create uniform success and error log entries in JSON format for centralized logging\n- In particular tested and used with the ELK stack (Logstash, Elasticsearch and Kibana)\n- A unique ID (RFC4122 uuid v4) is also created for each log entry.\n- This uid can be used in other application logs, which end up in ELK, so you can correlate the request or error with other application log entries.\n- Support [JSON API](http://jsonapi.org/) response type\n\nBelow will be some sample log entries in pretty print and also some screen shots of how they look in Kibana.\n\n## Install\n\n`npm install koa-json-logger`\n\n## Usage\n\n`var koaJsonLogger = require('koa-json-logger');`\n\n`app.use(koaJsonLogger());`\n\nI suggest it's best to use this middleware high in the middleware stack so any and all downstream errors are logged.\n\nLogs will go into a `log/` directory relative to file that instruments the Koa app, so you'll need to create this folder.\n\nDefault use will create two log files:\n\n`log/app.log` will contain req/res log entries.\n\n`log/app_error.log` will contain error log entries.\n\nLog files are not auto rotated, recommend using system file rotation facility such as `logrotate` on Linux or `logadm` on SmartOS/Illumos.\n\nCurrent config options are:\n\n- `name` (String default: 'app') configures the log file name and name property of the log entry.\n\n- `path` (String default: 'log') configures the log directory (relative) to use.\n\n- `jsonapi` (Boolean default: false) will set the response Content-type to application/vnd.api+json and ensure 500 responses are in JSON API format\n\nExample:\n\n      app.use(koaJsonLogger({\n        name: 'myCoolApp',\n        path: 'logs',\n        jsonapi: true\n      }));\n\nWhen you throw an application error it's best to always use [throw](https://github.com/koajs/koa/blob/master/docs/api/context.md#ctxthrowmsg-status-properties)\n\nExample:\n\n    `this.throw(403, 'Access Denied');`\n\nSee the docs for [throw](https://github.com/koajs/koa/blob/master/docs/api/context.md#ctxthrowmsg-status-properties) details.\n\nYou can return errors this way (no throw) but without throwing this will end up in the standard log file - *not* the error log file.\n\nSo best *not* to do it this way (the error message in the body will *not* be logged):\n\n    // Not a good way to an return error\n    this.status = 401;\n    this.body = 'Access Denied';\n\nIf using [JSON API](http://jsonapi.org/) set `jsonapi: true` - response Content-type header will be set to application/vnd.api+json\n\nYou can then throw errors like this for example:\n\n    this.throw(401, {\n      message: {\n        status: 401,\n        title: 'Unauthorized',\n        detail: 'No Authorization header found'\n      }\n    }\n\nThe unique ID (uid) set for each request and can be accessed/used with `this.uuid`\n\nFor example using Bunyan elsewhere in your application for logging you could use the uid like so:\n\n`logger.info({uid: this.uuid}, 'Application log message here');`\n\nThen you can correlate http request/response/error log entries with you application log entries based on the uid.\n\nPlease review the test suite for further details.\n\n## Tests with code coverage report in `test/coverage`\n\nNote: Requires nodes at least v0.11.13 (earlier v0.11 versions may work, have not checked for this).\n\ngit clone the full repo: `git clone git@github.com:rudijs/koa-json-logger.git`\n\n`cd koa-json-logger`\n\n`npm install`\n\n`npm test`\n\n\n## Code Linting\n\n`npm run lint`\n\n\n## Sample Success Log Entry (pretty print)\n\n\t{\n\t   \"name\":\"rsm-api\",\n\t   \"hostname\":\"dev\",\n\t   \"pid\":30213,\n\t   \"level\":30,\n\t   \"uid\":\"37154307-aed2-4e10-b702-97ed9e7d4a3b\",\n\t   \"req\":{\n\t      \"url\":\"/users/539d77e8cd4e834b710a103a\",\n\t      \"headers\":{\n\t\t \"host\":\"127.0.0.1:3000\",\n\t\t \"connection\":\"keep-alive\",\n\t\t \"cache-control\":\"no-cache\",\n\t\t \"user-agent\":\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36\",\n\t\t \"content-type\":\"application/vnd.api+json\",\n\t\t \"accept\":\"*/*\",\n\t\t \"accept-encoding\":\"gzip,deflate,sdch\",\n\t\t \"accept-language\":\"en-US,en;q=0.8\"\n\t      },\n\t      \"method\":\"GET\",\n\t      \"ip\":\"::ffff:127.0.0.1\",\n\t      \"protocol\":\"http\",\n\t      \"originalUrl\":\"/users/539d77e8cd4e834b710a103a\",\n\t      \"query\":{}\n\t   },\n\t   \"res\":{\n\t      \"statusCode\":200,\n\t      \"responseTime\":15,\n\t      \"headers\":{\n\t\t \"cache-control\":\"no-store, no-cache\",\n\t\t \"x-content-type-options\":\"nosniff\",\n\t\t \"x-download-options\":\"noopen\",\n\t\t \"x-xss-protection\":\"1; mode=block\",\n\t\t \"x-frame-options\":\"DENY\",\n\t\t \"vary\":\"Accept-Encoding\",\n\t\t \"content-type\":\"application/json; charset=utf-8\",\n\t\t \"content-length\":\"66\"\n\t      }\n\t   },\n\t   \"msg\":\"\",\n\t   \"time\":\"2014-08-21T16:24:24.118Z\",\n\t   \"v\":0\n\t}\n\n## Sample Error Log Entry (pretty print)\n\n\t{\n\t   \"name\":\"rsm-api\",\n\t   \"hostname\":\"dev\",\n\t   \"pid\":30213,\n\t   \"level\":50,\n\t   \"uid\":\"ec874d07-dd94-4298-a4c3-8181a6803d4a\",\n\t   \"req\":{\n\t      \"url\":\"/users/539d77e8cd4e834b710a103a\",\n\t      \"headers\":{\n\t\t \"host\":\"127.0.0.1:3000\",\n\t\t \"connection\":\"keep-alive\",\n\t\t \"cache-control\":\"no-cache\",\n\t\t \"user-agent\":\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36\",\n\t\t \"content-type\":\"application/vnd.api+json\",\n\t\t \"accept\":\"*/*\",\n\t\t \"accept-encoding\":\"gzip,deflate,sdch\",\n\t\t \"accept-language\":\"en-US,en;q=0.8\"\n\t      },\n\t      \"method\":\"GET\",\n\t      \"ip\":\"::ffff:127.0.0.1\",\n\t      \"protocol\":\"http\",\n\t      \"originalUrl\":\"/users/539d77e8cd4e834b710a103a\",\n\t      \"query\":{}\n\t   },\n\t   \"res\":{\n\t      \"statusCode\":401,\n\t      \"responseTime\":3,\n\t      \"headers\":{\n\t\t \"cache-control\":\"no-store, no-cache\",\n\t\t \"x-content-type-options\":\"nosniff\",\n\t\t \"x-download-options\":\"noopen\",\n\t\t \"x-xss-protection\":\"1; mode=block\",\n\t\t \"x-frame-options\":\"DENY\",\n\t\t \"vary\":\"Accept-Encoding\"\n\t      }\n\t   },\n\t   \"err\":{\n\t      \"message\":{\n\t\t \"status\":401,\n\t\t \"title\":\"Unauthorized\",\n\t\t \"detail\":\"Please sign in to complete this request.\"\n\t      },\n\t      \"name\":\"Error\",\n\t      \"stack\":\"Error: Unauthorized\\n    at Object.module.exports [as throw] (/media/crypt2/projects/ride-share-market-api/node_modules/koa/lib/context.js:84:48)\\n    at Object.authorization (/media/crypt2/projects/ride-share-market-api/app/middlewares/authorization.js:49:19)\\n    at GeneratorFunctionPrototype.next (native)\\n    at Object.<anonymous> (/media/crypt2/projects/ride-share-market-api/node_modules/koa-router/node_modules/koa-compose/index.js:29:12)\\n    at GeneratorFunctionPrototype.next (native)\\n    at next (/media/crypt2/projects/ride-share-market-api/node_modules/koa/node_modules/co/index.js:74:21)\\n    at Object.<anonymous> (/media/crypt2/projects/ride-share-market-api/node_modules/koa/node_modules/co/index.js:45:5)\\n    at next (/media/crypt2/projects/ride-share-market-api/node_modules/koa/node_modules/co/index.js:90:21)\\n    at Object.<anonymous> (/media/crypt2/projects/ride-share-market-api/node_modules/koa/node_modules/co/index.js:45:5)\\n    at next (/media/crypt2/projects/ride-share-market-api/node_modules/koa/node_modules/co/index.js:90:21)\"\n\t   },\n\t   \"msg\":\"\",\n\t   \"time\":\"2014-08-21T16:26:52.338Z\",\n\t   \"v\":0\n\t}\n\n## Kibana Success Screenshot example:\n\n\n![Kibana Success Screenshot](examples/kibana_success_log_entry.png)\n\n\n## Kibana Error Screenshot example:\n\n\n![Kibana Error Screenshot](examples/kibana_error_log_entry.png)\n\n","created":"2014-08-01T06:45:50.298Z","modified":"2016-01-22T15:36:05.589Z","lastPublisher":{"name":"rudijs","email":"ooly.me@gmail.com"},"owners":[{"name":"rudijs","email":"ooly.me@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"koa-json-logger","_nodeVersion":"5.4.1","_npmUser":{"name":"rudijs","email":"ooly.me@gmail.com"},"_npmVersion":"3.3.12","_rev":"1-051eaed5e8066fbb8c8787ad7daeb550","_shasum":"e352fb825f5e018574972577b3ae1cff62f216ce","author":{"name":"Rudi Starcevic","email":"ooly.me@gmail.com"},"bugs":{"url":"https://github.com/rudijs/koa-json-logger/issues"},"contributors":[{"name":"Jordan Sexton","email":"jordan@jordansexton.com"}],"directories":{},"dist-tags":{"latest":"1.0.2"},"dist":{"shasum":"e352fb825f5e018574972577b3ae1cff62f216ce","tarball":"http://registry.npmjs.org/koa-json-logger/-/koa-json-logger-1.0.2.tgz"},"maintainers":[{"name":"rudijs","email":"ooly.me@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2016-01-22T15:36:05.589Z","created":"2014-08-01T06:45:50.298Z","0.0.1":"2014-08-01T06:45:50.298Z","0.0.2":"2014-08-02T04:10:12.363Z","0.0.3":"2014-08-04T14:44:39.820Z","0.0.4":"2014-08-04T14:49:40.293Z","0.0.5":"2014-08-06T09:16:35.670Z","0.0.6":"2014-08-06T10:22:33.002Z","0.0.7":"2014-08-10T12:51:28.912Z","0.0.8":"2014-08-21T17:27:29.113Z","0.0.9":"2014-08-22T05:16:09.172Z","0.0.10":"2014-08-22T05:27:01.600Z","0.0.11":"2014-08-22T05:46:59.422Z","0.0.12":"2014-08-22T06:29:50.007Z","0.0.13":"2014-08-22T06:58:40.370Z","0.0.14":"2014-08-23T09:45:38.713Z","0.0.16":"2014-09-13T03:59:56.539Z","0.0.17":"2014-10-26T07:01:07.204Z","0.0.18":"2014-11-06T15:18:33.675Z","0.0.19":"2015-03-03T05:40:39.425Z","0.0.20":"2015-06-10T06:58:34.482Z","0.0.22":"2015-07-28T07:53:45.396Z","1.0.0":"2015-08-26T05:24:51.827Z","1.0.1":"2015-10-20T05:21:27.518Z","1.0.2":"2016-01-22T15:36:05.589Z"}}}