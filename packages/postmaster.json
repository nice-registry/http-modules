{"name":"postmaster","description":"A tiny SMTP server that stores and exposes your emails in an HTTP API for testing","version":"0.1.0","homepage":"https://github.com/jamierumbelow/postmaster","repository":"https://github.com/jamierumbelow/postmaster","main":"./lib/postmaster.js","scripts":{"test":"cake test"},"bin":{"postmaster":"./bin/postmaster"},"dependencies":{"coffee-script":"1.3.1","commander":"0.6.0","mimelib":"0.1.15"},"devDependencies":{"nodeunit":"*"},"optionalDependencies":{},"engines":{"node":"*"},"_engineSupported":true,"_defaultsLoaded":true,"versions":[{"number":"0.1.0","date":"2012-04-28T17:25:22.588Z"}],"readme":"# Postmaster\n\n[![Build Status](https://secure.travis-ci.org/jamierumbelow/postmaster.png?branch=master)](http://travis-ci.org/jamierumbelow/postmaster)\n\nPostmaster is a tiny SMTP server that stores all messages in memory and exposes an HTTP API to retrieve them later. This makes it really easy to test the headers and the content of your emails.\n\n## Installation\n\nInstall Postmaster with [npm](http://npmjs.org/):\n\n    $ npm install -g postmaster\n\nYou can then run Postmaster with the `postmaster` command, which should be in your path:\n\n    $ postmaster\n    Postmaster reporting for duty on localhost:5666 (HTTP - localhost:5667)\n\nChange the bound hostname and port with the `-l` and `-p` flags, respectively:\n\n    $ postmaster -p 4432 -l 127.0.0.1\n    Postmaster reporting for duty on 127.0.0.1:4432 (HTTP - 127.0.0.1:4433)\n\n## HTTP API\n\nThe HTTP API will open up on the next port from the Postmaster port. Sending an `HTTP GET` request to `/emails` will return a JSON array of the parsed email and associated headers.\n\n    $ curl http://localhost:5667/emails\n    {\"1\":{\"headers\":{\"User-Agent\":\"CodeIgniter\",\"Date\":\"Sat, 28 Apr 2012 17:49:55 +0100\",\"From\":\"<test@example.com>\",\"Return-Path\":\"<test@example.com>\",\"To\":\"another@example.com\",\"Subject\":\"=?utf-8?Q?Some_random_email?=\",\"Reply-To\":\"\\\"test@example.com\\\" <test@example.com>\",\"X-Sender\":\"test@example.com\",\"X-Mailer\":\"CodeIgniter\",\"X-Priority\":\"3 (Normal)\",\"Message-ID\":\"<4f9c1fb3d6878@example.com>\",\"Mime-Version\":\"1.0\",\"Content-Type\":\"text/plain; charset=utf-8\",\"Content-Transfer-Encoding\":\"8bit\"},\"body\":\"Oh yeah\",\"html\":false,\"subject\":\"Some random email\",\"from\":\"test@example.com\",\"to\":[\"another@example.com\"]}}\n\nPiped through a JSON prettifier, the output looks like this:\n\n    $ curl -s http://localhost:5667/emails | python -mjson.tool\n    {\n        \"1\": {\n            \"body\": \"Oh yeah\", \n            \"from\": \"test@example.com\", \n            \"headers\": {\n                \"Content-Transfer-Encoding\": \"8bit\", \n                \"Content-Type\": \"text/plain; charset=utf-8\", \n                \"Date\": \"Sat, 28 Apr 2012 17:49:55 +0100\", \n                \"From\": \"<test@example.com>\", \n                \"Message-ID\": \"<4f9c1fb3d6878@example.com>\", \n                \"Mime-Version\": \"1.0\", \n                \"Reply-To\": \"\\\"test@example.com\\\" <test@example.com>\", \n                \"Return-Path\": \"<test@example.com>\", \n                \"Subject\": \"=?utf-8?Q?Some_random_email?=\", \n                \"To\": \"jamie@jamierumbelow.net\", \n                \"User-Agent\": \"CodeIgniter\", \n                \"X-Mailer\": \"CodeIgniter\", \n                \"X-Priority\": \"3 (Normal)\", \n                \"X-Sender\": \"test@example.com\"\n            }, \n            \"html\": false, \n            \"subject\": \"Some random email\", \n            \"to\": [\n                \"jamie@jamierumbelow.net\"\n            ]\n        }\n    }\n\nThe email's original headers and body are stored and returned, alongside the parsed subject, whether or not the email is HTML, and the from/to address(es).\n\n## PHP Example\n\nAssuming we've got an application sending out an email when the user is registered, and we want to test it, we can boot up Postmaster, run the register method and check the HTTP API very easily:\n\n    <?php\n\n    class Register_Test extends PHPUnit_Framework_TestCase\n    {\n        function testRegistration()\n        {\n            // Fork out the Postmaster binary and wait until it's ready\n            $postmaster = popen('postmaster', 'r');\n            $output = fread($postmaster);\n\n            // Register our user\n            $model = new User_model();\n            $model->register('test_email@domain.com', 'test_password');\n\n            // Grab our emails\n            $curl = curl_init('http://localhost:5667/emails');\n            curl_setopt($curl, CURLOPT_RETURNTRANSFER, TRUE);\n\n            $json = curl_exec($curl);\n            curl_close();\n\n            $emails = (array)json_decode($json);\n\n            // Check that the email is what it's supposed to be!\n            $this->assertEqual($emails['1']->from, 'hello@myapp.com');\n            $this->assertEqual($emails['1']->to, 'test_email@domain.com');\n            $this->assertEqual($emails['1']->subject, 'MyApp - Welcome to MyApp!');\n\n            // Kill the process\n            pclose($postmaster);\n        }\n    }\n\n## Development / Tests\n\nGrab the most recent copy of the codebase from GitHub:\n\n    $ git clone git://github.com/jamierumbelow/postmaster.git postmaster\n\nInstall yer modules:\n\n    $ npm install\n\nAnd run the test suite with cake!\n\n    $ cake test\n\nIf you're developing locally and would like an easy way to rebuild the source, run `cake build`:\n\n    $ cake build && ./bin/postmaster","created":"2012-04-28T17:25:20.723Z","modified":"2012-04-28T17:25:22.588Z","lastPublisher":{"name":"jamierumbelow","email":"jamie@jamierumbelow.net"},"owners":[{"name":"jamierumbelow","email":"jamie@jamierumbelow.net"}],"other":{"_attachments":{},"_id":"postmaster","_nodeVersion":"v0.6.14","_npmUser":{"name":"jamierumbelow","email":"jamie@jamierumbelow.net"},"_npmVersion":"1.1.18","_rev":"1-19e3a9712d803a413ddd66c33e3b16bb","author":{"name":"Jamie Rumbelow","email":"jamie@jamierumbelow.net","url":"http://jamierumbelow.net"},"directories":{},"dist-tags":{"latest":"0.1.0"},"dist":{"shasum":"25c7548fa44dee11fe44fe943a85081e365b71ab","tarball":"http://registry.npmjs.org/postmaster/-/postmaster-0.1.0.tgz"},"maintainers":[{"name":"jamierumbelow","email":"jamie@jamierumbelow.net"}],"time":{"modified":"2012-04-28T17:25:22.588Z","created":"2012-04-28T17:25:20.723Z","0.1.0":"2012-04-28T17:25:22.588Z"}}}