{"name":"resilient","description":"Fault-tolerant, reactive, middleware-oriented, full featured HTTP client for node.js and browsers","version":"0.3.4","license":"MIT","repository":"https://github.com/resilient-http/resilient.js","main":"./lib","keywords":["fault","tolerant","balance","ajax","http","https","xhr","request","client","agent","distributed","resilience","reactive","hydra","balancer","rest","fallback","consul"],"bin":{"resilient":"./bin/resilient"},"engines":{"node":">= 0.10.0"},"scripts":{"test":"make test"},"dependencies":{"lil-event":"^0.1.3","lil-http":"^0.1.16","midware":"^0.1.7","request":"^2.67.0","yargs":"^1.3.2"},"devDependencies":{"browserify":"^6.3.3","chai":"^1.9.1","cucumber":"^0.4.4","fw":"^0.1.2","karma":"^0.12.23","karma-chrome-launcher":"^0.1.4","karma-firefox-launcher":"^0.1.3","karma-mocha":"^0.1.9","karma-opera-launcher":"^0.1.0","karma-phantomjs-launcher":"^0.1.4","karma-safari-launcher":"^0.1.1","karma-sauce-launcher":"^0.2.10","lodash":"^2.4.1","mocha":"^1.21.3","mocha-phantomjs":"^3.4.1","nock":"^0.48.0","resilient-consul":"^0.1.1","sinon":"^1.10.3","standard":"^5.4.1","stubby":"^0.3.0","uglify-js":"^2.4.15"},"gitHead":"2b0dc5ae71d1fcd0641b792b554709776b588e63","homepage":"https://github.com/resilient-http/resilient.js#readme","versions":[{"number":"0.1.0-beta.0","date":"2014-10-05T22:53:28.042Z"},{"number":"0.1.0-beta.1","date":"2014-10-06T07:06:57.706Z"},{"number":"0.1.0-beta.2","date":"2014-10-06T07:33:15.059Z"},{"number":"0.1.0-beta.3","date":"2014-10-06T21:17:38.318Z"},{"number":"0.1.0-beta.4","date":"2014-10-07T00:52:38.330Z"},{"number":"0.1.0","date":"2014-10-07T23:43:18.075Z"},{"number":"0.1.1","date":"2014-10-08T20:21:30.411Z"},{"number":"0.1.2","date":"2014-10-09T20:44:25.588Z"},{"number":"0.1.3","date":"2014-10-09T21:13:49.891Z"},{"number":"0.1.4","date":"2014-10-09T22:45:49.042Z"},{"number":"0.1.5","date":"2014-10-14T20:21:33.895Z"},{"number":"0.1.6","date":"2014-10-16T21:39:43.535Z"},{"number":"0.1.7","date":"2014-10-24T09:01:30.484Z"},{"number":"0.1.8","date":"2014-10-27T22:53:35.177Z"},{"number":"0.1.9","date":"2014-10-28T08:19:35.482Z"},{"number":"0.1.10","date":"2014-10-28T16:06:21.454Z"},{"number":"0.1.11","date":"2014-10-28T16:46:55.202Z"},{"number":"0.1.12","date":"2014-10-31T13:31:29.205Z"},{"number":"0.2.0","date":"2014-11-09T23:03:38.340Z"},{"number":"0.2.1","date":"2014-11-09T23:49:06.037Z"},{"number":"0.2.2","date":"2014-11-10T10:53:46.999Z"},{"number":"0.2.3","date":"2014-11-10T11:52:33.966Z"},{"number":"0.2.4","date":"2014-11-10T19:06:23.395Z"},{"number":"0.2.5","date":"2014-11-11T20:52:24.668Z"},{"number":"0.2.6","date":"2014-11-12T18:44:28.159Z"},{"number":"0.2.7","date":"2014-11-12T22:01:32.674Z"},{"number":"0.2.8","date":"2014-11-13T15:54:02.520Z"},{"number":"0.2.9","date":"2014-11-18T15:56:50.249Z"},{"number":"0.2.10","date":"2014-11-18T23:01:40.089Z"},{"number":"0.2.11","date":"2014-11-19T13:57:11.150Z"},{"number":"0.2.12","date":"2014-11-19T17:41:31.789Z"},{"number":"0.2.13","date":"2014-11-21T15:19:01.193Z"},{"number":"0.2.14","date":"2014-11-22T13:54:34.358Z"},{"number":"0.2.15","date":"2014-11-27T08:21:38.101Z"},{"number":"0.2.16","date":"2014-11-27T23:22:47.641Z"},{"number":"0.2.17","date":"2014-11-28T14:50:33.827Z"},{"number":"0.2.18","date":"2014-11-29T13:26:19.611Z"},{"number":"0.2.19","date":"2014-11-29T19:41:24.381Z"},{"number":"0.2.20","date":"2014-12-02T17:57:13.751Z"},{"number":"0.2.21","date":"2014-12-05T10:31:37.727Z"},{"number":"0.2.22","date":"2014-12-09T23:41:20.870Z"},{"number":"0.2.23","date":"2014-12-12T08:56:05.665Z"},{"number":"0.2.24","date":"2015-01-01T19:26:22.745Z"},{"number":"0.2.25","date":"2015-01-10T15:43:19.568Z"},{"number":"0.2.26","date":"2015-01-26T10:23:43.981Z"},{"number":"0.2.27","date":"2015-02-02T18:41:30.174Z"},{"number":"0.2.28","date":"2015-02-12T18:52:06.559Z"},{"number":"0.3.0-rc.0","date":"2015-05-03T01:12:52.627Z"},{"number":"0.3.0","date":"2015-05-03T14:59:33.330Z"},{"number":"0.3.1","date":"2015-09-04T19:44:35.746Z"},{"number":"0.3.2","date":"2015-12-07T16:07:24.305Z"},{"number":"0.3.3","date":"2016-01-21T17:01:36.825Z"},{"number":"0.3.4","date":"2016-08-07T16:04:31.209Z"}],"readme":"# resilient.js [![Build Status](https://api.travis-ci.org/resilient-http/resilient.js.svg?branch=master&style=flat)][travis] [![Code Climate](https://codeclimate.com/github/resilient-http/resilient.js/badges/gpa.svg)](https://codeclimate.com/github/resilient-http/resilient.js) [![NPM](https://img.shields.io/npm/v/resilient.svg)](https://www.npmjs.org/package/resilient) ![Downloads](https://img.shields.io/npm/dt/resilient.svg) [![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com)\n\n<img align=\"right\" height=\"150\" src=\"https://raw.githubusercontent.com/resilient-http/resilient-http.github.io/master/images/logo.png\" />\n\nA [reactive](http://www.reactivemanifesto.org/) **HTTP client** for **[node.js](http://nodejs.org)** and **browsers** designed for **distributed systems**, providing **fault tolerance** capabilities with transparent **server fallback**, dynamic **server discovery** (e.g: using Consul), **request retry**/**backoff** logic, optional **client-side balancing** based on empirical server latency and [more](#features)...\n\nProvides a simple [middleware-oriented](#middleware-layer) [programmatic API](#api) and featured [command-line interface](#command-line-interface). It has been designed to be lightweight (just ~2K SLOC. 9KB gzipped) and dependency free.\n\nTo get started, take a look to [how does it work](#how-does-it-work), [basic usage](#basic-usage), [examples](https://github.com/resilient-http/resilient.js/tree/master/examples) and [API](#api) docs.\n\nResilient is conceptually similar to [Ribbon](https://github.com/Netflix/ribbon), a Netflix's project.\n\n## Contents\n\n- [Features](#features)\n- [Installation](#installation)\n- [Environments](#environments)\n- [Middleware layer](#middleware)\n- [Framework-specific adapters](#framework-specific-adapters)\n- [Related projects](#related-projects)\n- [How does it work?](#how-does-it-work)\n- [Basic usage](#basic-usage)\n  - [Static servers](#static-servers)\n  - [Dynamic servers lookup](#dynamic-servers-lookup)\n- [Middleware Layer](#middleware-layer)\n  - [Types of middleware](#types-of-middleware)\n  - [Middleware API](#middleware-api)\n- [Command-line interface](#command-line-interface)\n- [API](#api)\n  - [Client](#resilient-options-)\n  - [Options](#options)\n    - [Service](#service)\n    - [Balancer](#balancer)\n    - [Discovery](#discovery)\n  - [Built-in errors](#built-in-error-codes)\n  - [Events](#events)\n- [FAQ](#faq)\n- [Contributing](#contributing)\n- [License](#license)\n\n## Features\n\n- Reliable failover and error handling with transparent server fallback\n- Smart network error handling covering multiple failure scenarios\n- Smart balancer logic based on empirical server score (network latency, errors and succesfull requests)\n- Transparent request retry cycle attempts on failure (configurable)\n- Discern best servers based on scoring per read and write operations when balancing\n- In/out traffic extensible middleware layer\n- Configurable balancer policy by weight\n- Configurable timeouts, retry loop, cache TTL, fallback behavior...)\n- Avoid fallback/retry cycles per custom HTTP responses codes or verbs\n- Define custom timeouts per HTTP method (e.g permissive for POST/PUT/DELETE, aggressive for GET)\n- Parallel servers discovering for faster availability\n- Built-in support for request/response interceptors (via middleware)\n- Built-in support for servers caching to improve reliability when fallback\n- Configurable external HTTP client to use as forward request proxy (instead of using the embedded one)\n- Dynamic servers auto discovering (based on the resilient [specification](https://github.com/resilient-http/spec) or via middleware)\n- Able to plug in custom failure strategies to determine if a request was failed or not.\n- Supports promiscuous errors (handles 400-499 codes as fallback errors)\n- Supports pre/post request hooks via event bus API\n- Supports mock/stub working mode via middleware (useful for testing)\n- Reliable HTTP client (it uses internally [request](https://github.com/mikeal/request) and [lil-http](https://github.com/lil-js/http) for the browser)\n- Round robin scheduling algorithm for traffic distribution (experimental)\n- Featured cURL-inspired command-line interface\n- Lightweight library (just ~2K SLOC, 9KB gzipped)\n- Dependency free in browser environments\n- Cross engine. ES5 compliant\n\n## Installation\n\nVia [npm](https://npmjs.org)\n```bash\nnpm install resilient\n```\n\nVia [Bower](http://bower.io)\n```bash\nbower install resilient\n```\n\nVia [Component](https://github.com/componentjs/component)\n```bash\ncomponent install resilient-http/resilient.js\n```\n\nOr loading the script remotely\n```html\n<script src=\"//cdn.rawgit.com/resilient-http/resilient.js/0.3.4/resilient.js\"></script>\n```\n\n## Environments\n\nRuns in any [ES5 compliant](http://kangax.github.io/mcompat-table/es5/) engine.\n\n![Node.js](https://cdn0.iconfinder.com/data/icons/long-shadow-web-icons/512/nodejs-48.png) | ![Chrome](https://raw.github.com/alrra/browser-logos/master/chrome/chrome_48x48.png) | ![Firefox](https://raw.github.com/alrra/browser-logos/master/firefox/firefox_48x48.png) | ![IE](https://raw.github.com/alrra/browser-logos/master/internet-explorer/internet-explorer_48x48.png) | ![Opera](https://raw.github.com/alrra/browser-logos/master/opera/opera_48x48.png) | ![Safari](https://raw.github.com/alrra/browser-logos/master/safari/safari_48x48.png)\n---  | --- | --- | --- | --- | --- |\n+0.10 | +5 | +3.5 | +9 | +10 | +5 |\n\n## Middleware\n\n- [Consul](https://github.com/h2non/resilient-consul) - [Example](https://github.com/resilient-http/resilient.js/blob/master/examples/consul.js)\n\n## Framework-specific adapters\n\n- [angular-resilient](https://github.com/h2non/angular-resilient) - Turn $http into a resilient and fault tolerant client\n\n## Related projects\n\n- [resilient-server](https://github.com/h2non/resilient-server) - node.js powered dummy HTTP lookup server for testing/development\n\n## How to use?\n\nSee the [basic usage](#basic-usage) and [examples](https://github.com/resilient-http/resilient.js/tree/master/examples) for detailed use cases\n\n## How does it work?\n\nThe following graph represents from a high-level point of view the internal logic encapsulated in Resilient HTTP client.\n\n<img src=\"http://rawgit.com/resilient-http/resilient-http.github.io/master/images/algorithm.svg\" />\n\n## Basic usage\n\nIf `require` is available, you must use it to fetch the module.\nOtherwise it will be available as global exposed as `resilient`\n\n```js\nvar Resilient = require('resilient')\n```\n\n#### Static servers\n\nDefine your service servers pool\n```js\nvar servers = [\n  'http://api1.server.com',\n  'http://api2.server.com',\n  'http://api3.server.com'\n]\n```\n\nCreate a new client and set the servers to balance\n```js\nvar client = Resilient({ service: { basePath: '/api/1.0' }})\nclient.setServers(servers)\n```\n\nPerform a request (the best available server will be used automatically)\n```js\nclient.get('/users', function (err, res) {\n  if (res.status === 200) {\n    console.log('Success:', res.data)\n  }\n})\n```\n\n#### Dynamic servers lookup\n\nDefine the lookup servers pool\n```js\nvar servers = [\n  'http://discover1.server.com',\n  'http://discover2.server.com',\n  'http://discover3.server.com'\n]\n```\n\nCreate a new client and set the discovering servers\n```js\nvar client = Resilient({ service: { basePath: '/api/1.0' }})\nclient.discoveryServers(servers)\n```\n\nFinally, perform the request (and that's all, Resilient will take care about everything to reach the best server)\n```js\nclient.get('/users', function (err, res) {\n  if (res.status === 200) {\n    console.log('Success:', res.data)\n  }\n})\n```\n\n**Note**: you could use [Consul](https://github.com/h2non/resilient-consul) or other [HTTP server](https://github.com/h2non/resilient-server) using a custom middleware as discovery server. For more information about the Resilient discovery interface, take a look at the [documentation](https://github.com/resilient-http/specification#discovery-server-api)\n\nFor more usage cases take a look to the [examples](https://github.com/resilient-http/resilient.js/tree/master/examples)\n\n## Middleware Layer\n\nFrom version `0.3.x` Resilient introduces support for duplex middleware.\nIt essentially provides an interceptor like layer to use external components to augment a specific functionality.\n\nFrom a high-level point of view it's conceptually similar to an evented API approach, which is commonly used in a event-driven environment with JavaScript,\nbut in this case it's slightly different in terms of flow control nature and relies more in data mutation compared to events.\n\nThe significant feature in Resilient middleware layer is that it provides bidirectional control flow for both incoming and outgoing HTTP traffic.\nThis allows you to perform multiple actions before and after a request of a specific type is made by Resilient. This might be considered also as a sort hooks in aspect-oriented programming.\n\n### Types of middleware\n\nSince Resilient is divided in two communication live cycle layers, one for the `discovery` servers and the other one for the `service` end servers, middleware can be created for both layers:\n\n- **service** - Default. Use this type in middleware which are oriented for final servers communication, such as request transformers, autorization...\n- **discovery** - Use this type in middleware which are oriented only for lookup communication, for instance used as adapter for a lookup server which is not compatible with the Resilient [lookup protocol](https://github.com/resilient-http/spectification).\n\n**Note**: the middleware type should be defined a static member of the middleware returned function, using the `type` property.\n\n### Middleware API\n\nRequired interface for middleware:\n```\nFunction([ params ])\n  -> Function(options, resilient)\n    -> Object{ in: Function(err, res, next), out: Function(option, next) }\n```\n\nFor non-duplex middleware you can use the following interface as well:\n```\nFunction([ params ])\n  -> Function(options, resilient)\n    -> Function(err, res, next)\n```\n\nAn example of a simple middleware implementation:\n```js\nfunction testMiddleware(params) {\n  // Middleware-specific params\n  params = params || {}\n\n  // Do whatever you need here with the params\n\n  // Resilient will pass the Options\n  function middleware(options, resilient) {\n    // Do whatever you need here with Resilient client options\n    // such as defining servers\n\n    return {\n      'in': function (err, res, next) {\n        // Do something here with the err/response\n\n        next() // Don't forget to call next\n      },\n      'out': function (options, next) {\n        // Do something here with the out HTTP request options\n\n        next() // Don't forget to call next\n      }\n    }\n  }\n\n  middleware.type = 'discovery' // Default to: service\n\n  return middleware\n}\n```\n\nAn example of middleware usage:\n```js\nvar client = Resilient({\n  discovery: {\n    servers: ['http://server1', 'http://server2']\n  }\n})\n\nclient.use(testMiddleware({\n  custom: 'options',\n  key: 'api-key',\n  timeout: 3000\n}))\n\nclient.get('/', function (err, res) {\n  // mad science here\n})\n```\n\n## Command-line interface\n\nFor better approach you should install `Resilient` as global package: `npm install -g resilient`\n\n```bash\nResilient command-line HTTP client\nUsage: resilient [url] [options]\n\nExamples:\n  resilient http://httpbin.org/user-agent\n  resilient --status http://httpbin.org/status/201\n  resilient --info http://httpbin.org/status/204\n  resilient http://httpbin.org/post -x POST \\\n            -d '{\"hello\":\"world\"}' -h \"Content-Type: application/json\"\n  resilient /api/users -s http://server1.net,http://server2.net\n  resilient /api/users -z http://discover1.net,http://discover2.net\n  resilient --discover -z http://discover1.net,http://discover2.net --discovery-timeout 500\n\nOptions:\n  --version, -v            Show the Resilient client version\n  --path, -p               Request path\n  --servers, -s            Define the service servers (comma separated)\n  --method, -x             HTTP method\n  --header, -h             Define custom request header\n  --data, -d               Value data to send as HTTP request body\n  --file, -f               File path to send as HTTP request body\n  --retry, -r              Request retry attempts                                       [default: 0]\n  --timeout, -t            Request timeout in miliseconds\n  --discover, -k           Get an updated list of servers asking for discovery servers\n  --discovery-servers, -z  Define the discovery service servers (comma separated)\n  --discovery-retry, -R    Discovery servers retry attempts                             [default: 0]\n  --discovery-timeout, -T  Discovery servers request maximum timeout in miliseconds\n  --info, -i               Show response headers and info\n  --info-headers, -I       Show only the response status and headers\n  --status, -c             Print the response status code\n  --debug, -D              Enable debug mode\n  --help, -H               Show help\n```\n\n## API\n\n### resilient([ options ])\n\nCreates a new `resilient` client with custom config\n\n### Options\n\nThe options `object` supports three different configuration levels\n\n```js\nResilient({\n  service: { ... },\n  balancer: { ... },\n  discovery: { ... }\n})\n```\n\n#### Service\n\nSpecific configuration options for the end service servers pool of the Resilient client.\n\n- **servers** `array<string>` - A list of valid servers URIs to reach for the given service. Default `null`. It's recommended to use discovery servers instead of static service servers\n- **retry** `number` - Number of times to retry if all requests failed. Use `Infinity` for infinitive attemps. Default `0`\n- **waitBeforeRetry** `number` - Number of milisenconds to wait before start the request retry cycle. Default to `50`\n- **discoverBeforeRetry** `boolean` - Force to refresh service servers list asking to the discovery servers on each retry attempt. You must define the discovery servers in order to use this feature. Default `true`\n- **promiscuousErrors** `boolean` - Enable promiscuous error handling mode. Client HTTP status errors (400-499) will be treated as failed request, retrying it until it has a valid status (when `retry` option is enabled). Default `false`\n- **omitRetryWhen** `array<object>` - A collection of rules per method and status code to match in order to omit a request retry cycle. See the usage [example](https://github.com/resilient-http/resilient.js/blob/master/examples/omit-fallback-options.js). Default `null`\n- **omitFallbackWhen** `array<object>` - A collection of rules per method and status code to match in order to omit a request server fallback. See usage [example](https://github.com/resilient-http/resilient.js/blob/master/examples/omit-fallback-options.js). Default `null`\n- **omitRetryOnMethods** `array<string>` - Omit a retry cycle attempt if the request method is on the given array. Default `null`\n- **omitFallbackOnMethods** `array<string>` - Omit fallback to the next best available server if current HTTP method is on the given array. If you use this option, retry cycles will be disabled as well for the given methods. Default `null`\n- **omitRetryOnErrorCodes** `array<number>` - Omit a retry cycle attempt if the latest request response status code is one of the given array. Default `null`\n- **omitFallbackOnErrorCodes** `array<number>` - Omit fallback to the next best available server if the latest request response status code is one of the given array. Default `null`\n- **timeouts** `object` - Define custom request timeout values in miliseconds per HTTP method, useful to differ read/write requests. This option has priority over the `timeout` option. Default: `null`\n\nSpecific shared configuration options for the HTTP client for final service requests\n\n- **path** `string` - Server request path as part of the final URL\n- **basePath** `string` - Server resource base path to share between all requests\n- **method** `string` - Request HTTP method. Default to `GET`\n- **data** `mixed` - Payload data to send as body request\n- **headers** `object` - Map of strings representing HTTP headers to send to the server\n- **params** `object` - Map of strings representing the query params\n- **timeout** `number` - Request maximum timeout in miliseconds before to abort it. Default to `10` seconds\n- **auth** `object` - Authentication credentials to the server. Object must have both `user` and `password` properties\n\n**Browser specific options**\n\n- **withCredentials** `boolean` - Whether to set the withCredentials flag on the XHR object. See [MDN][withcredentials] for more information\n- **responseType** `string` - Define how to handle the response data. Allowed values are: `text`, `arraybuffer`, `blob` or `document`\n\n**Node.js specific options**\n\nSee all HTTP options supported for `node.js` [here](https://github.com/mikeal/request#requestoptions-callback)\n\n#### Balancer\n\n- **enable** `boolean` - Enable/disable the smart client balancer. Default to `true`.\n- **random** `boolean` - Use random balance strategy using `Math.random()`. Default to `false`.\n- **balanceStrategy** `function` - Custom balance strategy function. Interface to be implemented: `function (servers []Server) => []Server`. Default to `null`.\n- **disableWeight** `boolean` - Disable emphirical built-in weight calculus based on server stats for balancing (latency, errors, success).\n- **roundRobin** `boolean` - Enable RobinRobin schedule algorithm (experimental). Default: `false`.\n- **roundRobinSize** `number` - Round robin round size. Useful to increase requests distribution across different servers. Default to `3` servers.\n- **weight** `object` - Balacer calculus percentage weight used for best available server scoring policy:\n  - **success** `number` - Percentage weight for success request. Default to `15`.\n  - **error** `number` - Percentage weight for failed request. Default to `50`.\n  - **latency** `number` - Percentage weight for request average latency. Default to `35`.\n\n#### Discovery\n\nSpecific configuration for discovery servers requests, behavior and logic\n\n- **servers** `array<string>` - A list of valid server URIs to use as discovery servers\n- **cacheEnabled** `boolean` - Enable/disable discovery servers cache in case of global fallback. Useful to improve client reliability. Default `true`\n- **cacheExpiration** `number` - Maximum cache time to live. Default to `10` minutes\n- **retry** `number` - Number of times to retry if all requests failed. Use `Infinity` for infinitive attemps. Default `3`\n- **waitBeforeRetry** `number` - Number of milisenconds to wait before start the request retry cycle. Default to `1000`\n- **parallel** `boolean` - Discover servers in parallel. This will improve service availability and decrement server lookup delays. Default `true`\n- **refreshInterval** `number` - Servers list time to live in miliseconds. Default to `2` minutes\n- **enableRefreshServers** `boolean` - Enable/disable discovery servers auto refresh. This option requires `refreshServers` or `enableSelfRefresh` has been defined. Default `true`\n- **refreshServers** `array` - Servers list of refresh servers. This will enable automatically update discovery servers list asking for them selves to the following list of servers on each interval. Default `null`\n- **refreshServersInterval** `number` - Discovery servers list time to live in miliseconds. Default to `5` minutes\n- **enableSelfRefresh** `boolean` - Enable/disable self-discovery using the discovery servers pools. This requires the `refreshPath` option has been defined. Default `false`\n- **forceRefreshFirst** `boolean` - Enable/disable forcing to refresh the server on the first request. This requires the `refreshPath` and `enableRefreshServers` options has been defined. Default `true`\n- **refreshPath** `string` - Discovery refresh servers lookup path. Example: `/app/name`. This options requires you define `enableSelfRefresh` to `true`. Default `null`\n- **refreshOptions** `object` - Custom HTTP options for discovery servers refresh. By default inherits from discovery options\n- **promiscuousErrors** `boolean` - Enable promiscuous error handling mode. Client HTTP status errors (400-499) will be treated as failed request, retrying it until it has a valid status (when `retry` option is enabled). Default `false`\n- **omitRetryWhen** `array<object>` - A collection of rules per method and status code to match in order to omit a request retry cycle. See the usage [example](https://github.com/resilient-http/resilient.js/blob/master/examples/omit-fallback-options.js). Default `null`\n- **omitFallbackWhen** `array<object>` - A collection of rules per method and status code to match in order to omit a request server fallback. See usage [example](https://github.com/resilient-http/resilient.js/blob/master/examples/omit-fallback-options.js). Default `null`\n- **omitRetryOnMethods** `array<string>` - Omit a retry cycle attempt if the request HTTP method is on the given array. Default `null`\n- **omitFallbackOnMethods** `array<string>` - Omit fallback to the next best available server if the HTTP method is on the given array. If you use this option, retry cycles will be disabled as well for the given methods. Default `null`\n- **omitRetryOnErrorCodes** `array<number>` - Omit a retry cycle attempt if the latest request response status code is one of the given array. Default `null`\n- **omitFallbackOnErrorCodes** `array<number>` - Omit fallback to the next best available server if the latest request response status code is one of the given array. Default `null`\n- **timeouts** `object` - Define custom request timeout values in miliseconds per HTTP method, useful to differ read/write requests. This option has priority over the `timeout` option. Default: `null`\n\nSpecific shared configuration options for the HTTP client for discovering processes\n\n- **path** `string` - Server request path as part of the final URL\n- **basePath** `string` - Server resource base path to share between all requests\n- **timeout** `number` - Server discovery network timeout in miliseconds. Default `2` seconds\n- **auth** `object` - Authentication credentials required for the discovery server. Object must have both `user` and `password` properties\n- **params** `object` - Map of strings representing the query params\n- **headers** `object` - Map of strings representing HTTP headers to send to the discovery server\n- **method** `string` - Request HTTP method. Default to `GET`\n- **data** `mixed` - Optional data to send as payload to discovery servers. Default `null`\n\nFor `node.js`, see all HTTP options supported [here](https://github.com/mikeal/request#requestoptions-callback)\n\n### Request callback arguments\n\n- **error** [Error|ResilientError](#error) - Response error, if happends. Otherwise `null`\n- **response** [Object](#response)|[http.IncomingMessage][httpMessage] - Response object\n\n#### Response\n\n##### Browser\n\n- **data** `mixed` - Body response. If the MIME type is `JSON-compatible`, it will be transparently parsed\n- **status** `number` - HTTP response status code\n- **headers** `object` - Response headers\n- **xhr** `object` - Original XHR instance\n- **error** `mixed` - Error info, usually an `Error` instance (in case that an error happens)\n\n##### Node.js\n\nSee [http.IncomingMessage][httpMessage]\n\n#### Error\n\nIt could be an `Error` or plain `Object` instance with the following members\n\n- **message** `string` - Human readable error message description\n- **status** `number` - Internal error code or server HTTP response status\n- **code** `number` - Optional error code (node.js only)\n- **stack** `string` - Optional stack error trace\n- **request** `object` - Original response object in case that a custom Resilient error happends. Optional\n- **error** `Error` - Original throwed Error instance (node.js only). Optional\n- **xhr** `XMLHttpRequest` - XHR native instance (browser only)\n\n##### Built-in error codes\n\n- **1000** - All requests failed. No servers available\n- **1001** - Cannot update discovery servers. Empty or invalid response body\n- **1002** - Missing discovery servers. Cannot resolve the server\n- **1003** - Cannot resolve servers. Missing data\n- **1004** - Discovery server response is invalid or empty\n- **1005** - Missing servers during retry process\n- **1006** - Internal state error (usually caused by an unexpected exception)\n- **1007** - Error injected via middleware\n\n#### Events\n\nResilient client has a built-in support for internal states event dispacher and notifier to the public interface\n\nThis could be really useful while using an interceptor pattern in order to detect different states and data changes.\nYou can intercept and change any both request and response `objects` subscribing to the pre/post request hooks.\nNote that mutation is required, you should modify the `object` by reference and do not lose it\n\n```js\n// subscribe to every outgoing request before be dropped to the network\nresilientClient.on('request:start', function handler(options, resilient) {\n  // mutate the options, adding an aditional header\n  options.headers['API-Token'] = 'awesome!'\n  // unsubscribe example\n  resilientClient.off('request:start', handler)\n})\n```\n\n##### request:start\nArguments: `options<Object>`, `resilient<Resilient>`\n\nFired before a request is created\n\nYou can intercept and modify the request options on the fly, but you must mutate the options `object`\n\n##### request:outgoing\nArguments: `options<Object>`, `resilient<Resilient>`\n\nFired every time before a HTTP request is sent via network\n\nYou can intercept and modify the request options on the fly, but you must mutate the options `object`\n\n##### request:incoming\nArguments: `error<Error>`, `response<Object|http.IncomingMessage>`, `options<Object>`, `resilient<Resilient>`\n\nFired every time a HTTP response is received from a server\n\n##### request:finish\nArguments: `error<Error>`, `response<Object|http.IncomingMessage>`, `resilient<Resilient>`\n\nFired after a request was completed\n\nYou can intercept and modify the error/response on the fly, but you must mutate the `object`\n\n##### request:retry\nArguments: `options<Object>`, `servers<Servers>`\n\nFired when a request performs a retry attempt cycle, that means all the previous requests has failed\n\n##### request:fallback\nArguments: `options<Object>`, `response<Object>`\n\nFired when any request (service or discovery) to a given server fails and therefore tries to perform the next server fallback\n\n##### servers:refresh\nArguments: `servers<Array>`, `resilient<Resilient>`\n\nFired every time that service servers list is updated from discovery servers\n\n##### servers:cache\nArguments: `servers<Array>`, `resilient<Resilient>`\n\nFired every time that servers cache is updated\n\n##### discovery:refresh\nArguments: `servers<Array>`, `resilient<Resilient>`\n\nFired every time that discovery servers are updated form refresh servers\n\n## Methods\n\n### resilient#send(path, options, callback)\n\nPerforms a custom request with the given options.\nIt's recommended using as generic interface to make multi verb requests\n\n### resilient#get(path, options, callback)\nReturn `Client`\n\nCreates a GET request with optional custom options\n\n### resilient#post(path, options, callback)\nReturn `Client`\n\nCreates a POST request with optional custom options\nReturn `Client`\n\n### resilient#put(path, options, callback)\nReturn `Client`\n\nCreates a PUT request with optional custom options\n\n### resilient#delete(path, options, callback)\nAlias: `del` | Return `Client`\n\nCreates a DELETE request with optional custom options\n\n### resilient#patch(path, options, callback)\nReturn `Client`\n\nCreates a PATCH request with optional custom options\n\n### resilient#head(path, options, callback)\nReturn `Client`\n\nCreates a HEAD request with optional custom options\n\n### resilient#options([ type|options, options ])\n\nGetter/setter accessor for resilient options, optionally per type. See [supported options](#options)\n\n### resilient#serviceOptions([ options ])\n\nGetter/setter accessor for [service-level config options](#service)\n\n### resilient#discoveryOptions([ options ])\n\nGetter/setter accessor for [discovery-level config options](#discovery)\n\n### resilient#balancer([ options ])\nReturn: `object`\n\nGetter/Setter accessor for [balancer-level config options](#balancer)\n\n### resilient#httpOptions(type)\nReturn: `object`\n\nGet a map of HTTP specific options\n\n### resilient#addFailStrategy(strategy)\nAlias: `failStrategy`\n\nAdd a custom failure evaluator `function` strategy in order to determine if Resilient should handle the request as failed or success status, retrying it accordingly if required.\n\nStrategies should return a `boolean` value indicating if the request failed (`true`) or not (`false`).\n\nUse example:\n```js\nvar resilient = require('resilient')\n\nvar client = resilient()\n\nclient.addFailStrategy(function limitReached(err, res) {\n  return !err\n    && +res.headers['x-ratelimit-remaining'] === 0\n})\n```\n\n### resilient#areServersUpdated()\nReturn: `boolean`\n\nReturns `true` if servers are up-to-date. Otherwise `false`\n\n### resilient#servers([ type = 'service' ])\nReturn: `Servers`\n\nReturn a `Servers` instance with the current used servers per type. Allowed types are: `service` and `discovery`\n\n### resilient#serversURL([ type = 'service' ])\nReturn: `array<string>`\n\nReturn an `array` of server URLs for the given type. Allowed types are: `service` and `discovery`\n\n### resilient#resetScore([ type = 'service' ])\nReturn: `Resilient` Alias: `resetStats`\n\nReset servers stats score based on network latency and percentage of success and failed requests\n\nThis score is the average calculus of the total amount of sent requests from the client to each server.\nThis score is used in the scheduling algorithm in order\nto determinate the best available server (in the case that the `balance` option is enabled)\n\nAllowed types are: `service` and `discovery`\n\n### resilient#discoveryServers([ servers ])\nReturn: `Servers`\n\nSetter/Getter for discovery servers list\n\n### resilient#discoverServers([ options, ] cb)\nReturn: `Resilient`\n\nPass to the callback an up-to-date list of servers asking to discovery servers\n\nPassed arguments to the callback are:\n- **error** `object` - Error, if it happend\n- **servers** `array` - Array of `string` with the current service servers URL\n\n### resilient#latestServers([ options, ] cb)\nReturn: `Resilient` Alias: `getUpdatedServers`\n\nPass to the callback an up-to-date list of servers, with or without discovery servers configured\n\nPassed arguments to the callback are:\n- **error** `object` - Error, if it happend\n- **servers** `array` - Array of `string` with the current service servers URL\n\n### resilient#updateServers([ options, ] cb)\n\nForce to update the servers list from discovery servers, if they are defined,\noptionally passing a callback to handle the result\n\nPassed arguments to the callback are:\n- **error** `object` - Error, if it happend\n- **servers** `array` - Array of `string` with the current service servers URL\n\n### resilient#use(middleware)\n\nRegister a new middleware. See the middleware [documentation](#middleware-layer) or [examples](#middleware) for more information\n\n### resilient#useHttpClient(fn)\n\nUse a custom HTTP client as proxy instead of the embedded `resilient` native HTTP client.\n\nUseful to define use proxy for custom frameworks or libraries in your existent project when you need to deal with some complex HTTP pre/post hooks logic and exploit custom HTTP client features\n\nIf defined, all the outgoing requests through Resilient client will be proxied to it.\n\nArguments passed to the client function:\n- **options** `object` - Resilient HTTP [service options](#service)\n- **callback** `function` - Request status handler. Expected arguments are: `error`, `response`\n\nNote: `error` and `response` objects must be compatible with the [current interface](#request-callback-arguments)\n\n### resilient#restoreHttpClient()\n\nRestore the native `resilient` HTTP client\n\n### resilient#mock(mockFn)\n\nDefine a mock/fake HTTP client error/response `object` for all outgoing requests\n\n```js\nresilient.mock(function (options, cb) {\n  if (options.url === 'http://discovery.server.me') {\n    // fake response\n    cb(null, { status: 200, data: ['http://server.net'] })\n  } else {\n    // fake unavailable status\n    cb(null, { status: 503 })\n  }\n})\n```\n\nSee also the `useHttpClient()` method for custom request proxy forward, also useful for testing with stubs/fakes\n\n### resilient#unmock()\n\nDisable the mock/fake mode\n\n### resilient#on(event, handler)\n\nSubscribe to an event. See [supported events](#events)\n\n### resilient#off(event, handler)\n\nUnsubscribe a given event and its handler. See [supported events](#events)\n\n### resilient#once(event, handler)\n\nSubscribe to an event with a given handler just once time.\nAfter fired, the handler will be removed\n\nSee [supported events](#events)\n\n### resilient#cache.flush()\n\nForce to flush servers cache\n\n### resilient#client()\nReturn: `Client` Alias: `http`\n\nReturns an HTTP client-only interface.\nUseful to provide encapsulation from public usage and\navoid resilient-specific configuration methods to be called from the public API.\n\nThis is a restricted API useful to provide for high-level developers\n\n### resilient.VERSION\nType: `string`\n\nCurrent semver library version\n\n### resilient.CLIENT_VERSION\nType: `string`\n\nCurrent semver HTTP client library version\n\nIt uses [request](https://github.com/request/request) in node.js and [lil-http](https://github.com/lil-js/http) in the browser\n\n### resilient.defaults\nType: `object`\n\nDefault config options\n\n### resilient.Options(options)\n\nCreate a new options store\n\n### resilient.Client(resilient)\n\nCreates a new resilient HTTP client with public API\n\nUseful to provide encapsulation to the resilient API and expose only the HTTP client (the common interface the developers want to consum)\n\n### resilient.request(options [, cb])\n\nUse the plain HTTP client ([request](https://github.com/request/request) in node.js and [lil-http](https://github.com/lil-js/http) in the browser)\n\n## FAQ\n\n#### It's required to have discovery servers in my infraestructure in order to use Resilient?\n\nDefinitely not. Discovery servers only will be used in the case that you configure them in your Resilient client.\nIn that case Resilient will simply use the the static service servers to communicate with your backend\n\n#### Can I use Resilient as a simple HTTP client without balancing?\n\nYes. If your perform a request with a full URI schema, Resilient will treat it as plain request without applying any internal logic:\n\n```js\nvar client = Resilient({\n  service: {\n    servers: ['http://server1.me', 'http://server2.me']\n  }\n})\n\n// direct plain request (no balancing, no discovery, no fallback...)\nclient.get('http//custom.server/hello', function (err, res) {\n  // ...\n})\n\n// resilient powered request (with balancing, fallback, discovery server, cache...)\nclient.get('/hello', function (err, res) {\n  // ...\n})\n```\n\n#### Can I use a custom HTTP client instead of the embedded one?\n\nOf course you can do it. In browser environments this is a common premise, for example you need to use the custom HTTP client of the framework you are using in your application, or a custom library like zepto or jQuery that provides a simple AJAX interface\n\nYou can do that defining a function middleware to act as proxy pattern to intercept and wrap all the HTTP traffic via the Resilient client\n\n```js\nvar client = Resilient({})\n// example using Zepto.js AJAX interface\nclient.useHttpClient(function httpProxy(options, cb) {\n  options.success = function (data, status, xhr) {\n    cb(null, { status: xhr.status, data: data, xhr: xhr })\n  }\n  options.error = function (xhr) {\n    cb({ status: xhr.status, xhr: xhr })\n  }\n  $.ajax(options)\n})\n```\n\nFor more information, see the [API method documentation](#resilientusehttpclientfn)\n\n#### Can I use streams?\n\nNot yet. There are plans to support it in future versions.\n\n#### Can I use Resilient in production projects?\n\nResilient was used in both web and node.js production applications.\n\nThe library is, indeed, relatively young and it will evolve with new features in future versions (in fact a full core and logic redesign is required), but the API consistency in not compromised between patch minor releases.\n\n#### How can I create custom middleware?\n\nYou can see the middleware documentation or see an [example](https://github.com/h2non/resilient-consul)\n\n## Contributing\n\nWanna help? Cool! It will be appreciated :)\n\nYou must add new test cases for any new feature or refactor you do,\nalways following the same design/code patterns that already exist\n\n### Development\n\nOnly [node.js](http://nodejs.org) is required for development\n\nClone the repository\n```bash\n$ git clone https://github.com/resilient-http/resilient.js.git && cd resilient.js\n```\n\nInstall development dependencies\n```bash\n$ npm install\n```\n\nInstall browser dependencies\n```bash\n$ bower install\n```\n\nGenerate browser bundle source\n```bash\n$ make browser\n```\n\nRun tests (in both node.js and headless browser)\n```bash\n$ make test\n```\n\nRun tests in real browsers\n```bash\n$ make test-browser\n```\n\n## License\n\n[MIT](http://opensource.org/licenses/MIT) © Tomas Aparicio and contributors\n\n[travis]: http://travis-ci.org/resilient-http/resilient.js\n[httpMessage]: http://nodejs.org/api/http.html#http_http_incomingmessage\n[withcredentials]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Requests_with_credentials\n","starsCount":2,"created":"2014-10-05T22:53:28.042Z","modified":"2016-08-07T16:04:31.209Z","lastPublisher":{"name":"h2non","email":"tomas@aparicio.me"},"owners":[{"name":"h2non","email":"tomas@aparicio.me"}],"other":{"_attachments":{},"_from":".","_id":"resilient","_nodeVersion":"6.3.0","_npmOperationalInternal":{"host":"packages-12-west.internal.npmjs.com","tmp":"tmp/resilient-0.3.4.tgz_1470585869121_0.22716582473367453"},"_npmUser":{"name":"h2non","email":"tomas@aparicio.me"},"_npmVersion":"3.10.3","_rev":"1-a11b864305c250d7ea7db13b0980ea19","_shasum":"e808ee51c5ec9ca9b10d203adbf0db4ba6ca61f1","author":{"name":"Tomas Aparicio"},"bugs":{"url":"https://github.com/resilient-http/resilient.js/issues"},"directories":{"lib":"./lib"},"dist-tags":{"latest":"0.3.4"},"dist":{"shasum":"e808ee51c5ec9ca9b10d203adbf0db4ba6ca61f1","tarball":"http://registry.npmjs.org/resilient/-/resilient-0.3.4.tgz"},"maintainers":[{"name":"h2non","email":"tomas@aparicio.me"}],"readmeFilename":"README.md","time":{"modified":"2016-08-07T16:04:31.209Z","created":"2014-10-05T22:53:28.042Z","0.1.0-beta.0":"2014-10-05T22:53:28.042Z","0.1.0-beta.1":"2014-10-06T07:06:57.706Z","0.1.0-beta.2":"2014-10-06T07:33:15.059Z","0.1.0-beta.3":"2014-10-06T21:17:38.318Z","0.1.0-beta.4":"2014-10-07T00:52:38.330Z","0.1.0":"2014-10-07T23:43:18.075Z","0.1.1":"2014-10-08T20:21:30.411Z","0.1.2":"2014-10-09T20:44:25.588Z","0.1.3":"2014-10-09T21:13:49.891Z","0.1.4":"2014-10-09T22:45:49.042Z","0.1.5":"2014-10-14T20:21:33.895Z","0.1.6":"2014-10-16T21:39:43.535Z","0.1.7":"2014-10-24T09:01:30.484Z","0.1.8":"2014-10-27T22:53:35.177Z","0.1.9":"2014-10-28T08:19:35.482Z","0.1.10":"2014-10-28T16:06:21.454Z","0.1.11":"2014-10-28T16:46:55.202Z","0.1.12":"2014-10-31T13:31:29.205Z","0.2.0":"2014-11-09T23:03:38.340Z","0.2.1":"2014-11-09T23:49:06.037Z","0.2.2":"2014-11-10T10:53:46.999Z","0.2.3":"2014-11-10T11:52:33.966Z","0.2.4":"2014-11-10T19:06:23.395Z","0.2.5":"2014-11-11T20:52:24.668Z","0.2.6":"2014-11-12T18:44:28.159Z","0.2.7":"2014-11-12T22:01:32.674Z","0.2.8":"2014-11-13T15:54:02.520Z","0.2.9":"2014-11-18T15:56:50.249Z","0.2.10":"2014-11-18T23:01:40.089Z","0.2.11":"2014-11-19T13:57:11.150Z","0.2.12":"2014-11-19T17:41:31.789Z","0.2.13":"2014-11-21T15:19:01.193Z","0.2.14":"2014-11-22T13:54:34.358Z","0.2.15":"2014-11-27T08:21:38.101Z","0.2.16":"2014-11-27T23:22:47.641Z","0.2.17":"2014-11-28T14:50:33.827Z","0.2.18":"2014-11-29T13:26:19.611Z","0.2.19":"2014-11-29T19:41:24.381Z","0.2.20":"2014-12-02T17:57:13.751Z","0.2.21":"2014-12-05T10:31:37.727Z","0.2.22":"2014-12-09T23:41:20.870Z","0.2.23":"2014-12-12T08:56:05.665Z","0.2.24":"2015-01-01T19:26:22.745Z","0.2.25":"2015-01-10T15:43:19.568Z","0.2.26":"2015-01-26T10:23:43.981Z","0.2.27":"2015-02-02T18:41:30.174Z","0.2.28":"2015-02-12T18:52:06.559Z","0.3.0-rc.0":"2015-05-03T01:12:52.627Z","0.3.0":"2015-05-03T14:59:33.330Z","0.3.1":"2015-09-04T19:44:35.746Z","0.3.2":"2015-12-07T16:07:24.305Z","0.3.3":"2016-01-21T17:01:36.825Z","0.3.4":"2016-08-07T16:04:31.209Z"},"users":{"brandonpapworth":true,"mshmelev":true}}}