{"name":"couchdb-auth-proxy","version":"1.1.3","description":"An HTTP reverse proxy library for quick and dirty Couchdb proxy authentication","repository":"https://github.com/tyler-johnson/couchdb-auth-proxy","main":"index.js","scripts":{"lint":"eslint src/ test/","build":"make clean && make","test":"make test.js && node test.js","prepublish":"npm run build","autorelease":"autorelease pre && npm publish && autorelease post"},"dependencies":{"http-proxy":"^1.14.0","transformer-proxy":"^0.3.3"},"devDependencies":{"autorelease":"^1.7.1","autorelease-github":"^1.2.0","autorelease-travis":"^1.2.1","babel-eslint":"^6.1.2","babel-plugin-external-helpers":"^6.8.0","babel-plugin-transform-async-to-generator":"^6.8.0","babel-plugin-transform-es2015-destructuring":"^6.9.0","babel-plugin-transform-es2015-parameters":"^6.11.4","babel-plugin-transform-object-rest-spread":"^6.8.0","eslint":"^3.2.2","express":"^4.15.2","rollup":"^0.34.3","rollup-plugin-babel":"^2.6.1","rollup-plugin-json":"^2.0.1","supertest":"^3.0.0","tape":"^4.6.3","tape-promise":"^2.0.1"},"keywords":[],"license":"MIT","files":["index.js"],"gitHead":"94a4607eea12f51bae7af36e3deec6bf81085eee","homepage":"https://github.com/tyler-johnson/couchdb-auth-proxy#readme","versions":[{"number":"1.0.0","date":"2016-08-03T23:37:37.135Z"},{"number":"1.1.0","date":"2016-08-28T02:16:27.285Z"},{"number":"1.1.1","date":"2016-09-07T23:59:44.158Z"},{"number":"1.1.2","date":"2016-09-15T01:08:58.429Z"},{"number":"1.1.3","date":"2017-05-16T23:09:45.478Z"}],"readme":"# CouchDB Auth Proxy\n\n[![npm](https://img.shields.io/npm/v/couchdb-auth-proxy.svg)](https://www.npmjs.com/package/couchdb-auth-proxy) [![Build Status](https://travis-ci.org/tyler-johnson/couchdb-auth-proxy.svg?branch=master)](https://travis-ci.org/tyler-johnson/couchdb-auth-proxy)\n\nA Node.js HTTP reverse proxy library for quick and dirty CouchDB proxy authentication.\n\n## Install\n\nInstall from NPM\n\n```bash\nnpm install couchdb-auth-proxy -S\n```\n\nAnd import into your project\n\n```js\nimport couchdbProxy from \"couchdb-auth-proxy\";\n```\n\n```js\nconst couchdbProxy = require(\"couchdb-auth-proxy\");\n```\n\n## Usage\n\n> Note: Ensure proxy authentication is enabled on your CouchDB server. This is as simple as adding `{couch_httpd_auth, proxy_authentication_handler}` to the list of active authentication handlers in your configuration. See the [CouchDB Docs](http://docs.couchdb.org/en/1.6.1/api/server/authn.html#proxy-authentication) for more info.\n\nThis library generates an HTTP server request function from two arguments: a user context method and some options. This method will work with Express/Connect apps as well as the plain Node.js HTTP server.\n\nHere is an example proxy that authenticates every request as a super admin:\n\n```js\nconst server = http.createServer(couchdbProxy(function(req) {\n  // admin party!\n  return {\n    name: null,\n    roles: [ \"_admin\" ]\n  };\n}));\n```\n\nIn CouchDB, users are represented with a user context object. These are objects with `name` and `roles` fields. Usually this information comes from a document in the `_users` database, however we can also generate it from other means.\n\nYour proxy can complete asynchronous tasks, great for authenticating against other databases or services. You can return a promise, or provide a third argument for a callback.\n\n```js\nconst server = http.createServer(couchdbProxy(function(req, res, next) {\n  const token = req.get(\"Authorization\");\n\n  db.authenticateToken(token, (err, user) => {\n    if (err) return next(err);\n\n    next(null, {\n      name: user.name,\n      roles: []\n    });\n  });\n}));\n```\n\n## API\n\n#### `couchdbProxy( userCtxFn [, options ] ) â†’ Middleware`\n\n- `userCtxFn` (Function, *required*) - Method called on every request, with the request `req` and response `res` as arguments. This method should return a plain object with `name` and `roles` fields, representing the authenticated user. To run an async task, return a promise or pass a third argument `next` for a callback.\n- `options` (Object) - Options to configure the proxy.\n  - `options.target` (String) - The URL of the CouchDB server to proxy to. This server must have [proxy authentication enabled](http://docs.couchdb.org/en/1.6.1/api/server/authn.html#proxy-authentication). Defaults to `http://localhost:5984`.\n  - `options.secret` (String) - The [CouchDB secret](http://docs.couchdb.org/en/1.6.1/config/auth.html#couch_httpd_auth/secret) used to sign proxy tokens and cookies. This is only required if `couch_httpd_auth/proxy_use_secret` is enabled on CouchDB (which is recommended).\n  - `options.via` (String) - The name of the proxy to add to the `Via` header. This is so consumers of the HTTP API can tell that the request was directed through a proxy. This is optional and the `Via` header will be excluded when not provided.\n  - `options.headerFields` (Object) - A map of custom header fields to use for the proxy. This should match what is declared in CouchDB `couch_httpd_auth` configuration, under `x_auth_roles`, `x_auth_token`, and `x_auth_username`. This is the default map:\n  ```json\n  {\n    \"username\": \"X-Auth-CouchDB-UserName\",\n    \"roles\": \"X-Auth-CouchDB-Roles\",\n    \"token\": \"X-Auth-CouchDB-Token\"\n  }\n  ```\n  - `options.info` (Object) - Some JSON serializable value that will be injected into the CouchDB's root info document response.\n","created":"2016-08-03T23:37:37.135Z","modified":"2017-05-16T23:09:45.478Z","lastPublisher":{"name":"mrgalaxy","email":"tyler@tylerjohnson.me"},"owners":[{"name":"mrgalaxy","email":"tyler@tylerjohnson.me"}],"other":{"_attachments":{},"_from":".","_id":"couchdb-auth-proxy","_nodeVersion":"6.10.3","_npmOperationalInternal":{"host":"packages-12-west.internal.npmjs.com","tmp":"tmp/couchdb-auth-proxy-1.1.3.tgz_1494976183727_0.6006185738369823"},"_npmUser":{"name":"mrgalaxy","email":"tyler@tylerjohnson.me"},"_npmVersion":"3.10.10","_rev":"2-fc9ba6b68514738f3787a0818d5d8c31","_shasum":"366bee607f56ba8c07a4b44f53ad632626386298","author":{"name":"Tyler Johnson","email":"tyler@tylerjohnson.me"},"bugs":{"url":"https://github.com/tyler-johnson/couchdb-auth-proxy/issues"},"directories":{},"dist-tags":{"latest":"1.1.3"},"dist":{"shasum":"366bee607f56ba8c07a4b44f53ad632626386298","tarball":"https://registry.npmjs.org/couchdb-auth-proxy/-/couchdb-auth-proxy-1.1.3.tgz"},"maintainers":[{"name":"mrgalaxy","email":"tyler@tylerjohnson.me"}],"readmeFilename":"README.md","time":{"modified":"2017-05-16T23:09:45.478Z","created":"2016-08-03T23:37:37.135Z","1.0.0":"2016-08-03T23:37:37.135Z","1.1.0":"2016-08-28T02:16:27.285Z","1.1.1":"2016-09-07T23:59:44.158Z","1.1.2":"2016-09-15T01:08:58.429Z","1.1.3":"2017-05-16T23:09:45.478Z"}}}