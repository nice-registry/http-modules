{"name":"negotiate","version":"1.0.1","description":"A JavaScript implementation of proper HTTP content negotiation.","homepage":"http://github.com/garycourt/negotiate-js","licenses":[{"type":"FreeBSD","url":"http://github.com/garycourt/negotiate-js/raw/master/negotiate.js"}],"repository":"https://github.com/RubenVerborgh/negotiate-js","dependencies":{},"main":"negotiate.js","keywords":["http","content","negotiation","variants","node","accept"],"gitHead":"5f9490076026a88a5b5420f69862f238f983531e","scripts":{},"versions":[{"number":"1.0.0","date":"2014-10-02T15:34:19.410Z"},{"number":"1.0.1","date":"2014-10-02T18:59:38.557Z"}],"readme":"# Negotiate.js - HTTP Content Negotiation in JavaScript\n\nNegotiate.js is a JavaScript implementation of proper HTTP content negotiation, and is designed to be compatible with Node.js's HTTP Request API.\n\n## Content Negotiation?\n\nContent negotiation is an optional feature of the HTTP protocol that allows for the automatic selection of the appropriate content representation of the requested resource based upon the attributes of the request and variants.\n\nStill confused? More information about what is content negotiation and how it works can be found on Wikipedia at: [http://en.wikipedia.org/wiki/Content_negotiation](http://en.wikipedia.org/wiki/Content_negotiation)\n\nNegotiate.js uses the preemptive negotiation algorithm defined in the original [HTTP 1.1 draft spec](http://cidr-report.org/ietf/all-ids/draft-ietf-http-v11-spec-00.txt). \n\n## Example\n\nLet's say you have a blog, and you can get a list of the latest blog entries on your site using the path `/blog/`. Now, let's say you have two different forms of representing this same data: as a HTML document or a Atom feed.\n\nIn Negotiate.js, these different forms are called variants, and can be represented in JavaScript like so:\n\n\tvar variants = [\n\t\t{\n\t\t\t\"method\" : \"GET\",                //responds only to GET requests\n\t\t\t\"type\" : \"text/html\",            //is an HTML document\n\t\t\t\"language\" : \"en-ca\",            //is written in Canadian English\n\t\t\t\"charset\" : \"iso-8859-1\",        //uses this charset\n\t\t\t\"encoding\" : null,               //is not encoded\n\t\t\t\"quality\" : 1.0,                 //is the best representation of this resource\n\t\t\t\"length\" : 36741,                //is this many bytes long\n\t\t\t\"filename\" : \"blog.html\"         //used by this example only, for locating the variant's file\n\t\t},\n\t\t{\n\t\t\t\"method\" : \"GET\",                //responds only to GET requests\n\t\t\t\"type\" : \"application/atom+xml\", //is an Atom feed\n\t\t\t\"language\" : \"en\",               //is written in generic English\n\t\t\t\"charset\" : \"utf-8\",             //uses the utf-8 charset\n\t\t\t\"encoding\" : \"gzip\",             //is compressed with gzip\n\t\t\t\"quality\" : 0.8,                 //is not as good quality as the HTML version\n\t\t\t\"length\" : 12987,                //is smaller then the HTML version\n\t\t\t\"filename\" : \"blog.atom.gzip\"    //used by this example only, for locating the variant's file\n\t\t}\n\t];\n\nAll of the above variant properties are optional, but you should at least specify the mime type as it tends to be the most important. Also, Negotiate.js will tend to put more weight on variants that have more known properties specified.\n\nWith the available variants for this resource (URL) defined, you can now use Negotiate.js to select the appropriate representation for an incoming HTTP request. \n\n\tvar request = {\n\t\turl : \"/blog\",\n\t\tmethod : \"GET\",\n\t\theaders : {\n\t\t\t\"accept\" : \"application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\",\n\t\t\t\"accept-language\" : \"en-US,en;q=0.8\",\n\t\t\t\"accept-encoding\" : \"gzip,deflate,sdch\",\n\t\t\t\"accept-charset\" : \"ISO-8859-1,utf-8;q=0.7,*;q=0.3\"\n\t\t}\n\t};\n\t\n\tvar responses = Negotiate.choose(variants, request);\n\nWith Node.js, this can be done with the following:\n\n\tvar fs = require(\"fs\");\n\tvar negotiate = require(\"./negotiate\");\n\tvar http = require(\"http\");\n\tvar server = http.createServer(function (request, response) {\n\t\tif (request.url === \"/blog\") {\n\t\t\tvar responses = negotiate.choose(variants, request);\n\t\t\tvar best = responses[0];\n\t\t\t\n\t\t\tif (best.q > 0) {\n\t\t\t\tfs.readFile(best.filename, function (err, data) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tresponse.writeHead(500, \"Internal Server Error\");\n\t\t\t\t\t\tresponse.end();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar headers = {};\n\t\t\t\t\t\tif (best.type) headers[\"Content-Type\"] = best.type + (best.charset ? \";charset=\" + best.charset : '');\n\t\t\t\t\t\tif (best.length) headers[\"Content-Length\"] = best.length;\n\t\t\t\t\t\tif (best.language) headers[\"Content-Language\"] = best.language;\n\t\t\t\t\t\tif (best.encoding) headers[\"Content-Encoding\"] = best.encoding;\n\t\t\t\t\t\t\n\t\t\t\t\t\tresponse.writeHead(200, headers);\n\t\t\t\t\t\tresponse.write(data, best.charset || \"ASCII\");\n\t\t\t\t\t\tresponse.end();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresponse.writeHead(406, \"None Acceptable\");\n\t\t\t\tresponse.end();\n\t\t\t}\n\t\t}\n\t\t\n\t\t// ...other url handling...\n\t});\n\tserver.listen(8080);\n\n## API\n\n### Negotiate.choose(variants, request)\n#### Parameters\n* `variants` An array of variant objects of the requested resource.\n* `request` A request object with the HTTP request details.\n#### Returns\nA clone of the variants array, with a `q` (quality) property attached to each variant. The quality property is a number from 0 to 1 (percentage) that indicates how good of a choice that variant is for the requester. This array is sorted in order of how suitable the variant is for the requester, with the best choice as the first item.\n\n## License\n\nNegotiate.js is licensed under the FreeBSD License. ","created":"2014-10-02T15:34:19.410Z","modified":"2014-10-02T18:59:38.557Z","lastPublisher":{"name":"rubenverborgh","email":"ruben.verborgh@gmail.com"},"owners":[{"name":"rubenverborgh","email":"ruben.verborgh@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"negotiate","_npmUser":{"name":"rubenverborgh","email":"ruben.verborgh@gmail.com"},"_npmVersion":"1.4.20","_rev":"1-233edeec4ad73feac7b446f11042731e","_shasum":"35ac8b5672f7b05faa10bf0261342eb1120370fd","author":{"name":"Gary Court","email":"gary.court@gmail.com"},"bugs":{"url":"http://github.com/garycourt/negotiate-js/issues"},"directories":{},"dist-tags":{"latest":"1.0.1"},"dist":{"shasum":"35ac8b5672f7b05faa10bf0261342eb1120370fd","tarball":"http://registry.npmjs.org/negotiate/-/negotiate-1.0.1.tgz"},"maintainers":[{"name":"rubenverborgh","email":"ruben.verborgh@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2014-10-02T18:59:38.557Z","created":"2014-10-02T15:34:19.410Z","1.0.0":"2014-10-02T15:34:19.410Z","1.0.1":"2014-10-02T18:59:38.557Z"}}}