{"name":"contentful-webhook-tunnel","version":"1.5.4","description":"An HTTP server for listening to Contentful API Webhooks with secure tunnels to localhost.","main":"index.js","scripts":{"test":"eslint \"**/*.js\""},"repository":"https://github.com/keithws/contentful-webhook-tunnel","keywords":["contentful","webhook","tunnel","contentful-webhook","webhook-tunnel","webhooks","ngrok","tunnels","localhost"],"license":"MIT","homepage":"https://github.com/keithws/contentful-webhook-tunnel#readme","devDependencies":{"eslint":"^3.9.1"},"dependencies":{"contentful-management":"^1.2.1","contentful-webhook-listener":"^1.0.1","https-proxy-agent":"^1.0.0","ngrok":"^2.2.6"},"gitHead":"aa1861b47f46a88bc3a1f98e3be4ff0e64d42120","versions":[{"number":"1.0.0","date":"2016-11-04T19:31:08.405Z"},{"number":"1.1.0","date":"2016-11-04T23:29:17.726Z"},{"number":"1.2.0","date":"2017-02-01T03:49:44.689Z"},{"number":"1.3.0","date":"2017-02-08T07:09:14.646Z"},{"number":"1.4.0","date":"2017-03-17T00:00:08.625Z"},{"number":"1.5.0","date":"2017-03-18T02:18:28.062Z"},{"number":"1.5.1","date":"2017-06-12T19:48:08.897Z"},{"number":"1.5.3","date":"2017-06-13T20:24:09.829Z"},{"number":"1.5.4","date":"2017-06-13T22:10:15.855Z"}],"readme":"# contentful-webhook-tunnel\n\n[![Build Status](https://travis-ci.org/keithws/contentful-webhook-tunnel.svg?branch=master)](https://travis-ci.org/keithws/contentful-webhook-tunnel) [![NPM Dependency Status](https://david-dm.org/keithws/contentful-webhook-tunnel.svg)](https://david-dm.org/keithws/contentful-webhook-tunnel) [![NPM Verion](https://img.shields.io/npm/v/contentful-webhook-tunnel.svg)](https://www.npmjs.com/package/contentful-webhook-tunnel)\n\nA simple HTTP server for listening to Contentful API Webhooks with secure tunnels to localhost by ngrok.\n\nThis module extends [contentful-webhook-listener.js][2] to automatically start up ngrok with a tunnel to the same port and registers a webhook for the ngrok URL with Contentful.\n\nThis is very useful for local development and/or servers behind firewalls to create a script with custom callbacks for any or all actions that occur in Contentful.\n\n## Install\n\n```bash\nnpm install contentful-webhook-tunnel\n```\n\n## Usage\n\nRequire this module and then create a new server. The `createServer` function expects the first argument to be an object with the `spaces` key and an array of space IDs to register the webhook with.\n\nThen listen for one or more of Contentful webhook events, `create`, `save`, `autoSave`, `archive`, `unarchive`, `delete`, `publish` or `unpublish` on the server object and setup a custom callback. See [contentful-webhook-listener.js][2] for details on the payload for each event.\n\nLastly, instruct the server to start listening.\n\n```node\nvar tunnel = require(\"contentful-webhook-tunnel\");\n\nvar server = tunnel.createServer({\n    \"spaces\": [ \"cfexampleapi\" ]\n});\n\nserver.on(\"publish\", function (payload) {\n\n    console.log(\"Received webhook for Publish event in Contentful\");\n    \n    // see payload for details\n    console.log(payload);\n\n});\n\nserver.listen();\n```\n\nTo register the webhooks via the Contentful Content Management API requires an access token. Vist the [Contentful Developer Center][3] to acquire an access token for a local script. Then, save that token to an environment variable named `CONTENTFUL_MANAGEMENT_ACCESS_TOKEN`.\n\nNgrok defaults to using tunnel servers in the US. To use a tunnel server outside the US then set the `NGORK_REGION` environment variable to another region. See the [ngrok documentation][4] for the list of supported regions.\n\nTo have your tunnel protected with HTTP Basic Auth, you must create an account with [ngrok][ngrok], get your access token, and set the `NGROK_AUTH_TOKEN` environment variable. If that environment variable is present, then a random username and a random password will be created and registered with Contentful each and every time the script is run.\n\n## How it Works\n\nNode.js is used to create a HTTP server that listens for requests and processes them as requests from Contentful Webhooks. When this server starts listening, then ngrok is started up and connected to the same port as the server and requires the same authentication, if any. Once ngork is connected and provides an ngrok URL, then the ngrok URL is registered with Contentful via the Contentful Content Management API. If the server is interrupted or terminated, then the registered webhook will be removed from Contentful.\n\nDeploying and running this server on a publicly accessible system does not require ngrok and, therefore, should use the [contentful-webhook-listener.js][2] server, that this is based on, instead.\n\n## Advanced Usage\n\nIn addition to the Contentful webhook events, this server also emits the following events.\n\n### Event: 'error'\n\n* <Error> The error that occurred.\n\nEmitted when an error occurs. The server will be closed directly following this event.\n\n### Event: 'ngrokConnect'\n\n* <String> the public URL of your tunnel\n* <String> the URL to your local ngork web interface\n* <Number> the local port number that is forwarded\n\nEmitted after ngork connects.\n\n### Event: 'ngrokDisconnet'\n\nEmitted after ngrok disconnects.\n\n### Event: 'webhookCreated'\n\n* <[Webhook][webhook]> the webhook definition from Contentful\n\nEmitted after a webhook record is created via the Contentful Content Management API.\n\n### Event: 'webhookDeleted'\n\nEmitted after a webhook record is deleted via the Contentful Content Management API.\n\n## Usage with a Proxy\n\nTo proxy HTTP(S) requests, then set the appropriate npm config variables.\n\n```shell\nnpm config set https-proxy http://proxy.example.com:3128/\nnpm config set proxy http://proxy.example.com:3128/\n```\n\nIf the npm config variables are not found, then these environment variables will be used.\n\n```shell\nHTTPS_PROXY=http://proxy.example.com:3128/\nHTTP_PROXY=http://proxy.example.com:3128/\n```\n\n## Todo\n\n* accept a single space or an array of spaces or an options object as the first argument to createServer()\n\n## Change Log\n\n_1.5.4 — June 13, 2017_\n\n* fixed bug that prevented authentication from being setup\n\n_1.5.3 — June 13, 2017_\n\n* fixed bug that caused multiple tunnels to use the same options\n* fixed bug that caused multiple tunnels to register with all spaces\n* optimized tunnel creation\n\t* multiple spaces no longer require multiple tunnels\n\t* one tunnel is created and registered in each space\n* improved readability of code in constructor\n* refactored the process of finding and removing existing webhooks with the same name before re-connecting to make better use of promises\n\n_1.5.2 — June 12, 2017_\n\n* ngrok options can now be passed to createServer()\n\n_1.5.1 — June 12, 2017_\n\n* only binds tls for https\n\n_1.5.0 — March 17, 2017_\n\n* port number no longer defaults to 5678\n* if port number is not specified, then the OS will chose a random port number\n\n_1.4.0 — March 16, 2017_\n\n* added HTTP proxy support with https-proxy-agent\n* proxy settings are read from the npm config or from the environment variables\n\n_1.3.0 — February 7, 2017_\n\n* made HTTP Basic Auth optional since it requires an ngork account\n* options that require an ngork account are now only used if the `NGROK_ACCESS_TOKEN` is found in the process environment\n\n_1.2.0 — January 31, 2017_\n\n* automatically removes orphaned tunnels from the same host upon reconnection\n* returns the URL to the ngrok UI and the local port number that is forwarded as arguments to the `ngrokConnect` event in addition to the public ngork URL\n* requires ngrok 2.2.6 or greater to get the ngrok UI URL, otherwise that argument will be undefined\n\n_1.1.0 — November 4, 2016_\n\n* random username and password are used if none are provided\n* port number defaults to 5678 if none is provided\n\n_1.0.0 — November 3, 2016_\n\n* initial version\n\n## License\n\ncontentful-webhook-tunnel is available under the [MIT License][1].\n\n[1]: https://github.com/keithws/contentful-webhook-tunnel/blob/master/LICENSE\n[2]: https://github.com/keithws/contentful-webhook-listener.js\n[3]: https://www.contentful.com/developers/docs/references/authentication/#the-content-management-api\n[4]: https://ngrok.com/docs/2#global\n[webhook]: https://www.contentful.com/developers/docs/references/content-management-api/#/reference/webhooks/webhooks-collection/create-a-webhook\n[ngrok]: https://ngrok.com\n","created":"2016-11-04T19:31:08.405Z","modified":"2017-06-13T22:10:15.855Z","lastPublisher":{"name":"keithws","email":"keith.w.shaw@gmail.com"},"owners":[{"name":"keithws","email":"keith.w.shaw@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"contentful-webhook-tunnel","_nodeVersion":"6.9.5","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/contentful-webhook-tunnel-1.5.4.tgz_1497391815659_0.6806179622653872"},"_npmUser":{"name":"keithws","email":"keith.w.shaw@gmail.com"},"_npmVersion":"3.10.10","_rev":"9-bf3a04448ac0350d642efa4e0af23220","_shasum":"d34749e124781a71de3522e6cffb0af824af3a8f","author":{"name":"Keith W. Shaw","email":"keith.w.shaw@gmail.com"},"bugs":{"url":"https://github.com/keithws/contentful-webhook-tunnel/issues"},"directories":{},"dist-tags":{"latest":"1.5.4"},"dist":{"shasum":"d34749e124781a71de3522e6cffb0af824af3a8f","tarball":"https://registry.npmjs.org/contentful-webhook-tunnel/-/contentful-webhook-tunnel-1.5.4.tgz"},"maintainers":[{"name":"keithws","email":"keith.w.shaw@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-06-13T22:10:15.855Z","created":"2016-11-04T19:31:08.405Z","1.0.0":"2016-11-04T19:31:08.405Z","1.1.0":"2016-11-04T23:29:17.726Z","1.2.0":"2017-02-01T03:49:44.689Z","1.3.0":"2017-02-08T07:09:14.646Z","1.4.0":"2017-03-17T00:00:08.625Z","1.5.0":"2017-03-18T02:18:28.062Z","1.5.1":"2017-06-12T19:48:08.897Z","1.5.3":"2017-06-13T20:24:09.829Z","1.5.4":"2017-06-13T22:10:15.855Z"}}}