{"name":"frugal-couch","version":"0.1.0","description":"Allows minimization of the number of HTTP requests to CouchDb/Cloudant. Built on top of nano","main":"frugal.js","scripts":{"test":"NODE_ENV=test ./node_modules/.bin/mocha -R spec --compilers coffee:coffee-script/register --require 'coffee-script/register' tests/*.tests.*coffee"},"repository":"https://github.com/SoftwareMarbles/frugal-couch","keywords":["CouchDb","Cloudant"],"license":"MIT","homepage":"https://github.com/SoftwareMarbles/frugal-couch","dependencies":{"lodash":"~2.4.1","debug":"~1.0.2"},"devDependencies":{"coffee-script":"~1.7.1","mocha":"~1.20.1","chai":"~1.9.1","nock":"~0.36.2","nano":"~5.10.0","async":"~0.9.0"},"versions":[{"number":"0.1.0","date":"2014-06-23T04:38:46.303Z"}],"readme":"[ ![Codeship Status for SoftwareMarbles/frugal-couch](https://www.codeship.io/projects/42664c00-dcbd-0131-867d-7e56761d162f/status)](https://www.codeship.io/projects/24565)\n\nfrugal-couch\n============\n\nA node module that allows minimization of the number of HTTP requests to CouchDb/Cloudant. `frugal-couch` is build on top of [`nano`](https://github.com/dscape/nano).\n\nIt offers three functions:\n\n### `overwriteBulk`\n\n`overwriteBulk` is a function designed to perform bulk updating of given documents even when their revision values are out of date.\n\nBulk updating documents have two significant advantages over updating them one by one:\n\n1.It's much faster as it requires only two trips to CouchDb for all the docs vs. two trips for each doc (one trip to try to update and if that fails then a new trip with corrected revision value)\n2.It's much cheaper if used on DaaS like Cloudant which charge the same for bulk requests and non-bulk requests (so if you have 10,000 docs that you need to update you'll be charged for 2 requests and not for 20,000 requests)\n\nBulk updating shouldn't be used always unless you are absolutely certain that nothing else is updating your database. It can be very useful even in multi-client databases as some types of documents may considered to be stable and depending only on external values (e.g. importing Facebook Graph data)\n\nThis function accepts three parameters:\n\n1.`database`: [`nano`](https://github.com/dscape/nano) database object (or an object with equivalent semantics) used to access the database\n\n2.`docs`: an array of documents that need to be bulk-updated\n\n3.`callback`: function with `(err, result)` signature. `result` is an object containing `inserted`, `updated`, `resurected` arrays and `revs` and `errors` objects. The three arrays hold the ids of inserted, updated and resurected documents (previously deleted and now re-inserted) while the two objects have properties matching document ids and their latest revisions or CouchDb generated errors respectively. `callback` is always invoked asynchronously\n\n#### Example\n\n```js\ndocs = [\n    { _id: '1' },\n    { _id: '2' },\n    { _id: '3' },\n    { _id: '4' }\n]\n\nfrugal.overwriteBulk(database, docs, function(err, result) {\n    //  get the IDs of the inserted, updated and resurected docs from `result`'s arrays\n    //  also get the doc revisions (e.g. `result.revs['1']`) and document\n    //  related errors (e.g. `result.error['1']`)\n});\n```\n\n### `partialUpdateBulk`\n\n`partialUpdateBulk` function performs partial updates of the documents with the given IDs.\n\nCouchDb allows partial server-side modification of documents through its update handler feature. However, this feature doesn't work for arrays of documents and is thus too slow for massive document updates.\n\nThe alternative is to retrieve all the documents, apply the modification function to them and then bulk upload them. This is what `partialUpdateBulk` does.\n\nThis function accepts the following parameters:\n\n1.`database`    -   `nano` database object or an object with equivalent semantics\n\n2.`docIds`      -   the array of IDs of the documents to update\n\n3.`partialUpdater`  -   the function accepting a single parameter (`doc` representing a database document) that does the document update and which will be invoked for each retrieved document\n\n4.`callback`    -   function accepting `err` and `result` parameters:\n\n - `err`      -   error value in case of any error, falsy otherwise\n - `result`   -   object with `revs` and `errors` object properties. `revs` maps the document IDs to their post-operation revision while errors maps any CouchDb errors to document ID related to it\n\n#### Example\n\n```js\nfrugal.partialUpdateBulk(database, ['1', '3'], function(doc) {\n    //  update `doc`'s state\n}, function(err, result) {\n    //  get revisions from `result.revs` (e.g. `result.revs['1']`)\n    //  get errors from `result.errors` (e.g. `result.errors['1']`)\n});\n```\n\n### `iterateViewBulk`\n\n`iterateViewBulk` function is used to iterate over CouchDb views.\n\nThis function accepts the following parameters:\n\n1.`database`    -   `nano` database object or an object with equivalent semantics\n\n2.`designDoc`   -   the name of the design document in which the view is to be found.\n\n3.`viewName`    -   the name of the view which will be queried.\n\n4.`options`     -   standard CouchDb options like `startkey` and `endkey`. It also holds the number of documents in each desired iteration in its `limit` property. If it doesn't then the default batch size is 1,000 documents (completely arbitrary number). One property that this function ignores is `skip` as it's needed to perform correct and optimal iterations.\n\n5.`iterator`    -   function accepting `err`, `docs` and `next` parameters:\n\n - `err`      -   error value in case of any error, falsy otherwise\n - `rows`     -   the array of view entries in the current iteration\n - `next`     -   the function to be invoked when the next iteration should be performed\n\n#### Example\n\n```js\nfrugal.iterateViewBulk(database, 'some', 'view', { limit: 15, include_docs: true }, function(err, rows, next) {\n    //  unless there is an error iterate over `rows` and then invoke `next`\n    //  if `rows` is empty or `next` is not defined, stop invoking `next`\n});\n```\n\n## License\n\nThe MIT License (MIT)\n\nCopyright (c) 2014 Software Marbles SpA\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n","created":"2014-06-23T04:38:46.303Z","modified":"2014-06-23T04:38:46.303Z","lastPublisher":{"name":"ierceg","email":"ivan@softwaremarbles.com"},"owners":[{"name":"ierceg","email":"ivan@softwaremarbles.com"}],"other":{"_attachments":{},"_from":".","_id":"frugal-couch","_npmUser":{"name":"ierceg","email":"ivan@softwaremarbles.com"},"_npmVersion":"1.4.3","_rev":"1-06e72847524ed786c878ed5ada7c60a3","author":{"name":"Ivan Erceg"},"bugs":{"url":"https://github.com/SoftwareMarbles/frugal-couch/issues"},"directories":{},"dist-tags":{"latest":"0.1.0"},"dist":{"shasum":"e1a66fdfdc4315aa771a5f7ea66290dbfdf5f171","tarball":"http://registry.npmjs.org/frugal-couch/-/frugal-couch-0.1.0.tgz"},"maintainers":[{"name":"ierceg","email":"ivan@softwaremarbles.com"}],"readmeFilename":"README.md","time":{"modified":"2014-06-23T04:38:46.303Z","created":"2014-06-23T04:38:46.303Z","0.1.0":"2014-06-23T04:38:46.303Z"}}}