{"name":"restify-prom-bundle","version":"1.0.1","description":"Restify prometheus middleware to expose HTTP metrics","main":"./built/js/index.js","types":"./built/definitions/index.d.ts","scripts":{"test":"gulp test","preversion":"gulp build && gulp test","start":"echo 'Cannot start a library' && exit 1"},"engines":{"node":">=0.12"},"repository":"https://github.com/etf1/restify-prom-bundle","keywords":["typescript","node","prometheus","stats"],"license":"MIT","devDependencies":{"@types/bluebird":"^3.0.37","@types/chai":"^3.4.34","@types/chai-as-promised":"^0.0.29","@types/debug":"^0.0.29","@types/mocha":"^2.2.36","@types/on-finished":"^2.2.29","@types/request-promise":"^4.1.33","@types/restify":"^2.0.36","bluebird":"^3.4.7","chai":"^3.5.0","chai-as-promised":"^6.0.0","gulp":"^3.9.1","gulp-clean":"0.3.2","gulp-clone":"^1.0.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^3.0.1","gulp-sourcemaps":"^2.3.0","gulp-sync":"^0.1.4","gulp-tslint":"^6.1.2","gulp-typescript":"^3.0.2","gulp-util":"^3.0.8","istanbul":"^0.4.5","merge2":"^1.0.2","mocha":"^3.2.0","portfinder":"^1.0.10","remap-istanbul":"^0.8.4","request":"2.34","request-promise":"^4.1.1","restify":"^4.0.0","tslint":"^3.15.1","tslint-microsoft-contrib":"^2.0.13","typescript":"^2.1.1"},"dependencies":{"debug":"^2.6.0","object-assign":"^4.1.1","on-finished":"^2.3.0","prom-client":"^7.0.1"},"peerDependencies":{"restify":"^4 || ^5.0.0-beta"},"gitHead":"81554fb5af064747a8264123b5a4054ec142c1f3","homepage":"https://github.com/etf1/restify-prom-bundle#readme","versions":[{"number":"1.0.0","date":"2017-02-10T23:57:24.464Z"},{"number":"1.0.1","date":"2017-04-27T14:11:02.913Z"}],"readme":"# Restify middleware to export standard http prometheus metrics.\n\n[![dependencies Status](https://david-dm.org/etf1/restify-prom-bundle/status.svg)](https://david-dm.org/etf1/restify-prom-bundle) [![Build Status](https://travis-ci.org/etf1/restify-prom-bundle.svg?branch=master)](https://travis-ci.org/etf1/restify-prom-bundle) [![codecov](https://codecov.io/gh/etf1/restify-prom-bundle/branch/master/graph/badge.svg)](https://codecov.io/gh/etf1/restify-prom-bundle) [![Known Vulnerabilities](https://snyk.io/test/github/etf1/restify-prom-bundle/badge.svg)](https://snyk.io/test/github/etf1/restify-prom-bundle)\n\n## Usage\n\n```js\nconst promBundle = require('restify-prom-bundle');\nconst restify = require('restify');\n\nconst server = restify.createServer({ /* options */ });\n\nserver.pre(promBundle.preMiddleware(server, { /* options */ }));\n\nserver.get('/api', (req, res) => {\n  // Custom metrics can be added by using the client.\n  const counter = new promBundle.client.Gauge(\n    'my_custom_counter',\n    'My custom counter'\n  );\n\n  counter.inc();\n  res.end('OK');\n});\n\nserver.listen(8000);\n\n// The /metrics route is now available with metrics.\n```\n\nSince prom-client is a singleton, it can be accessed from everywhere by just require'ing / import the module, aggregated metrics will be exposed on the route.\n\n## API\n\n\n### preMiddleware(server[, options]) => `Restify.Handler`\n\nCreates the restify pre-middleware to\n\n- Creates the expose route used by prometheus server to index metrics\n- Setup default metrics you want to measure\n\nOptions :\n\n| Name               | Type        | Default      | Description |\n| ---------          | ---------   | ---------    | --------- |\n| route              | `string`    | `'/metrics'` | Exposed route (as GET) for metrics. If `false` no route will be exposed. |\n| defaults           | `string[] ` | All metrics  | Name of default metrics (see table below) to add for each routes. |\n| exclude            | `string` <br/> `string[]`  <br/> `RegExp`  <br/> `Function` | `undefined` | URI(s), uri that match regular expression or uri that passed to function returns true that will be excluded from default metrics. |\n| promBlacklist      | `string[] ` | `undefined`  | `process`/`node` [default metrics](https://github.com/siimon/prom-client#default-metrics) to blacklist |\n| promDefaultDelay   | `number `   | 10000        | How often (ms) should prom-client fire default probes |\n| maxPathsToCount    | `number `   | 100          | How many paths at max should we measure calls on (restify_path_count), use 0 for unlimited (See [below](#paths-limitation). |\n\nDefault metrics :\n\n| Name          | Metric Name           | Type        | Description |\n| ---------     | ---------             | ---------   | ---------   |\n| status        | restify_status_codes  | [Counter](https://github.com/siimon/prom-client#counter)      | Number of response for each HTTP status code with `status_code` as label. |\n| pathDuration  | restify_path_duration | [Histogram](https://github.com/siimon/prom-client#histogram)  | Duration (seconds) by percentiles taken by each restify-defined path to generate the response with the `path`, `status_code` and the `method` as labels.  |\n| pathCount     | restify_path_count    | [Counter](https://github.com/siimon/prom-client#counter)      | Number of calls to each path with the `path`, `status_code` and the `method` as labels. |\n\n`duration` metrics precision will depends on the pre-middleware registering order, the sooner you register (first `server.pre()` call), the better it will be.\n\n### `prom-client`: client\n\nSingleton instance of [prom-client](https://github.com/siimon/prom-client) to set custom metrics.\n\n## Paths limitation\n\nIf a huge number of different non-routed requests (404) are sent to the server, the process will have to keep a `restify_path_count` label for each one and the process memory will increase undefinitively.\nIn addition, the prometheus (and grafana) service that uses this probes will be flooded.\nTo prevent this situation, number of measured paths are limited to `maxPathsToCount`.\n\nThis does not affect `restify_path_duration` as it only measures the restify-defined paths, nor `restify_status_codes` as it's limited to HTTP status codes.\n\nOnce `maxPathsToMeasure` paths are measured, every new paths will be ignored for `restify_path_duration` and `restify_path_count`.\n\n## Grafana dashboard\n\nA sample grafana dashboard can be found [here](https://grafana.net/dashboards/1485) .\n","created":"2017-02-10T23:57:24.464Z","modified":"2017-04-27T14:11:02.913Z","lastPublisher":{"name":"c2c","email":"contact@juliencrouzet.fr"},"owners":[{"name":"c2c","email":"contact@juliencrouzet.fr"}],"other":{"_attachments":{},"_from":".","_id":"restify-prom-bundle","_nodeVersion":"7.7.4","_npmOperationalInternal":{"host":"packages-18-east.internal.npmjs.com","tmp":"tmp/restify-prom-bundle-1.0.1.tgz_1493302260643_0.47931439708918333"},"_npmUser":{"name":"c2c","email":"contact@juliencrouzet.fr"},"_npmVersion":"4.1.2","_rev":"2-b81bafed5a72fed61c03151d2fdcd01b","_shasum":"050cc43ba65b50bd6dad2310eeb1ec3d42ae45b5","author":{"name":"eTF1"},"bugs":{"url":"https://github.com/etf1/restify-prom-bundle/issues"},"directories":{},"dist-tags":{"latest":"1.0.1"},"dist":{"shasum":"050cc43ba65b50bd6dad2310eeb1ec3d42ae45b5","tarball":"https://registry.npmjs.org/restify-prom-bundle/-/restify-prom-bundle-1.0.1.tgz"},"maintainers":[{"name":"c2c","email":"contact@juliencrouzet.fr"}],"readmeFilename":"README.md","time":{"modified":"2017-04-27T14:11:02.913Z","created":"2017-02-10T23:57:24.464Z","1.0.0":"2017-02-10T23:57:24.464Z","1.0.1":"2017-04-27T14:11:02.913Z"}}}