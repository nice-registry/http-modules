{"name":"ava-playback","version":"0.0.12","description":"Record and playback http requests with nock, integrated into ava","main":"dist/index.js","repository":"https://github.com/dempfi/ava-playback","license":"Apache-2.0","scripts":{"build":"rm -rf ./dist && tsc","watch":"rm -rf ./dist && tsc -w --pretty"},"files":["dist","*.js"],"keywords":["ava","http","mock","nock","playback","requests","test","testing","vcr","record"],"dependencies":{"json-stable-stringify":"^1.0.1","lodash.escaperegexp":"^4.1.2","lodash.isarray":"^4.0.0","lodash.isequalwith":"^4.4.0","lodash.isplainobject":"^4.0.6","lodash.mapvalues":"^4.6.0","nock":"^9.0.13","pkg-conf":"^2.0.0","shorthash":"^0.0.2"},"devDependencies":{"@types/json-stable-stringify":"^1.0.31","@types/lodash.escaperegexp":"^4.1.2","@types/lodash.isarray":"^4.0.2","@types/lodash.isequalwith":"^4.4.2","@types/lodash.isplainobject":"^4.0.2","@types/lodash.mapvalues":"^4.6.2","@types/nock":"^8.2.1","@types/node":"^7.0.18"},"gitHead":"5b11b9cb69c3620ee62153cd044003b8dbb286af","homepage":"https://github.com/dempfi/ava-playback#readme","versions":[{"number":"0.0.1","date":"2017-05-06T08:29:49.707Z"},{"number":"0.0.2","date":"2017-05-06T08:32:47.270Z"},{"number":"0.0.3","date":"2017-05-06T08:36:05.984Z"},{"number":"0.0.4","date":"2017-05-06T11:07:51.261Z"},{"number":"0.0.5","date":"2017-05-07T02:39:17.913Z"},{"number":"0.0.6","date":"2017-05-08T05:05:57.755Z"},{"number":"0.0.7","date":"2017-05-08T05:07:19.911Z"},{"number":"0.0.8","date":"2017-05-08T09:44:39.999Z"},{"number":"0.0.9","date":"2017-05-09T07:00:06.661Z"},{"number":"0.0.10","date":"2017-05-09T07:35:35.530Z"},{"number":"0.0.11","date":"2017-05-19T15:08:36.328Z"},{"number":"0.0.12","date":"2017-05-29T05:31:30.574Z"}],"readme":"<p align=\"center\"><img src=\"http://i.imgur.com/1vrCZff.png\" width=\"360\"/></p>\n\n___\n\nDealing with HTTP requests in the tests can be painful and what is more important error prone, since we have to stub everything by hand. There are few libraries to help with this situation, like [node-nock](https://github.com/node-nock/nock). But their setup is something complicated (I didn't manage to setup [node-nock](https://github.com/node-nock/nock) to record requests and play them back) and they require a lot of manual steps to write single test.\n\nüìº **`ava-playback`** is here to help. In `record` mode, when you write your test, you just allow your app to call real APIs and when you ready, you just switch from `record` to playback mode and it's done üéâ. In background `ava-playback` will record new requests and use already existing playbacks for the rest.\n\n\n### Installation\nFirst things first\n\n```\nyarn add ava-playback\n```\n\nor\n\n```\nnpm i ava-playback --save\n```\n\nThen in you `package.json` where you store your ava config just add a requirement of `ava-playback`.\n\n```json\n  // ...\n  \"ava\": {\n    \"require\": [\n      \"ava-playback\"\n    ]\n  }\n  // ...\n```\n\nüéâ that's it.\n\n### Playbacks location\n\nBy default playbacks will be stored in the root of your project in `/playbacks` folder, if you want to change the location just add `playbacks` settings in your `package.json`.\n\n```json\n  // ...\n  \"ava\": {\n    \"require\": [\n      \"ava-playback\"\n    ],\n    \"playbacks\": \"tests/fixtures\"\n  },\n  // ...\n```\n\n### Modes\n`ava-playback` uses env variable `AVA_PLAYBACK` to get information how it should run. If `AVA_PLAYBACK` isn't set, `ava-playback` will not do anything.\n\n- `AVA_PLAYBACK=record` record all new outgoing requests from your tests\n- `AVA_PLAYBACK=play` turn off HTTP/HTTPS connection and use playbacks to reply to the outgoing requests from the tests\n\n### Usage\n\nWith `ava-playback` the flow of writing actual test can look like this.\n\n1. You write a new test and don't activate `ava-playback` in any mode.\n2. When the test is ready you run it one more time with `AVA_PLAYBACK=record` env variable. `ava-playback` will record only missing playbacks to playbacks location.\n3. You edit new playbacks according to your needs ([wildcard](#wildcards-and-security) auth tokens in the body or in the queries).\n4. Check all tests with `AVA_PLAYBACK=play` mode to verify they pass.\n5. Done üöÄ\n\nTo illustrate the flow take a look at this example\n\n```sh\n# Write new test file\nNODE_ENV=test ava --watch 'new-test-file.js'\n\n# Record all playbacks required for 'new-test-file.js'\nNODE_ENV=test AVA_PLAYBACK=record ava 'new-test-file.js'\n\n# Check all tests together\nNODE_ENV=test AVA_PLAYBACK=play ava\n```\n\n### Wildcards and security\n\nBy default `ava-playback` stores and plays back your requests by taking into account all queries and body. However, you can change this option to hide security information, like tokens in queries.\n\nFor example, Slack API allows tokens to be in query params, like `slack.com/api/users.list?token=xoxb-XXXXXXXXXX-Z7RKNoLIKOXLPKqtxUy5IhJ5`. It's totally fine unless you don't want this token to be stored in git or be available in Travis-ci. For those cases, you can use wildcards feature of `ava-playback`.\n\nAfter recording the playback, in you playbacks folder you can find the file matching that request and edit a `path` entry from\n\n```\n\"/api/users.list?token=xoxb-XXXXXXXXXX-Z7RKNoLIKOXLPKqtxUy5IhJ5\"\n```\n\nto\n\n```\n\"/api/users.list?token=*\"\n```\n\nso the file will look like this\n```json\n{\n  \"body\": \"\",\n  \"method\": \"POST\",\n  \"path\": \"/api/users.list?token=*\",\n  \"scope\": \"https://slack.com:443\",\n  \"status\": 200,\n}\n```\n\nand all future requests to slack API with anything in place of the actual token will be caught by `ava-playback`.\n\n<details>\n  <summary><strong>Wildcard substitution rules</strong></summary>\n  <p>\n\n`ava-playback` support wildcards only for queries, however, this may change over. Wildcards can only catch whole strings as values or as part of an array like in the examples below.\n\nWhole word match\n```js\n\"/api/users.list?token=*\"\n```\nwill match these paths\n```\n\"/api/users.list?token=34\"\n\"/api/users.list?token=xoxb-XXXXXXXXXX-Z7RKNoLIKOXLPKqtxUy5IhJ5\"\n```\n\nIn array match\n```js\n\"/api/users.list?tokens=78&tokens=*&tokens=some-token\"\n```\nwill match anything in the same position, like\n```js\n\"/api/users.list?tokens=78&tokens=anything-here&tokens=some-token\"\n```\n</p></details>\n\n\n<div align=\"right\"><sup>\n  made with ‚ù§Ô∏è by <a href=\"https://github.com/dempfi\">@dempfi</a>\n</sup></div>\n","created":"2017-05-06T08:29:49.707Z","modified":"2017-05-29T05:31:30.574Z","lastPublisher":{"name":"dempfi","email":"dempfi@yahoo.com"},"owners":[{"name":"dempfi","email":"dempfi@yahoo.com"}],"other":{"_attachments":{},"_from":".","_id":"ava-playback","_nodeVersion":"7.10.0","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/ava-playback-0.0.12.tgz_1496035890351_0.626345765311271"},"_npmUser":{"name":"dempfi","email":"dempfi@yahoo.com"},"_npmVersion":"4.2.0","_rev":"12-8bfd6cf6f3bc7e2e904829810a32e89e","_shasum":"41af947ef393d907924dd109dd5c2ef93ef034a2","author":{"name":"Ike Ku","email":"dempfi@yahoo.com"},"bugs":{"url":"https://github.com/dempfi/ava-playback/issues"},"directories":{},"dist-tags":{"latest":"0.0.12"},"dist":{"shasum":"41af947ef393d907924dd109dd5c2ef93ef034a2","tarball":"https://registry.npmjs.org/ava-playback/-/ava-playback-0.0.12.tgz"},"maintainers":[{"name":"dempfi","email":"dempfi@yahoo.com"}],"readmeFilename":"README.md","time":{"modified":"2017-05-29T05:31:30.574Z","created":"2017-05-06T08:29:49.707Z","0.0.1":"2017-05-06T08:29:49.707Z","0.0.2":"2017-05-06T08:32:47.270Z","0.0.3":"2017-05-06T08:36:05.984Z","0.0.4":"2017-05-06T11:07:51.261Z","0.0.5":"2017-05-07T02:39:17.913Z","0.0.6":"2017-05-08T05:05:57.755Z","0.0.7":"2017-05-08T05:07:19.911Z","0.0.8":"2017-05-08T09:44:39.999Z","0.0.9":"2017-05-09T07:00:06.661Z","0.0.10":"2017-05-09T07:35:35.530Z","0.0.11":"2017-05-19T15:08:36.328Z","0.0.12":"2017-05-29T05:31:30.574Z"}}}