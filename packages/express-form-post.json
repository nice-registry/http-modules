{"name":"express-form-post","version":"1.1.4","description":"Simple, reliable and memory efficient http file parse and upload api","main":"index.js","scripts":{"test":"mocha"},"keywords":["fileupload","parser","files","file","upload","form","post","express","amazon","aws","s3","disk","dropbox","validate","signup","validation","request","body"],"license":"ISC","repository":"https://github.com/dannycho7/express-form-post","dependencies":{"busboy":"^0.2.14","hasha":"^3.0.0","mkdirp":"^0.5.1"},"devDependencies":{"aws-sdk":"^2.56.0","concat-stream":"^1.6.0","dotenv":"^4.0.0","dropbox":"^2.5.4","dropbox-stream":"^1.0.5","ejs":"^2.5.6","eslint":"^3.19.0","express":"^4.15.3","form-data":"^2.2.0","mocha":"^3.4.2","nodemon":"^1.11.0"},"gitHead":"a2b5cea7c9075e2876cf08a611dd390a26a7452f","homepage":"https://github.com/dannycho7/express-form-post#readme","versions":[{"number":"1.0.0","date":"2017-05-24T06:37:59.870Z"},{"number":"1.0.1","date":"2017-06-05T23:21:47.060Z"},{"number":"1.0.2","date":"2017-06-05T23:22:38.252Z"},{"number":"1.0.3","date":"2017-06-05T23:23:38.422Z"},{"number":"1.0.4","date":"2017-06-06T02:04:02.453Z"},{"number":"1.0.5","date":"2017-06-17T12:09:20.650Z"},{"number":"1.0.6","date":"2017-06-17T12:16:37.907Z"},{"number":"1.0.7","date":"2017-06-17T12:25:02.170Z"},{"number":"1.0.8","date":"2017-06-17T20:16:38.375Z"},{"number":"1.0.9","date":"2017-06-18T01:01:42.117Z"},{"number":"1.0.11","date":"2017-06-18T02:46:34.705Z"},{"number":"1.0.12","date":"2017-06-18T03:04:26.342Z"},{"number":"1.0.13","date":"2017-06-18T03:34:12.186Z"},{"number":"1.0.14","date":"2017-06-18T05:48:20.711Z"},{"number":"1.0.15","date":"2017-06-19T01:17:53.342Z"},{"number":"1.0.16","date":"2017-06-19T10:06:07.051Z"},{"number":"1.0.17","date":"2017-06-19T11:22:02.164Z"},{"number":"1.0.18","date":"2017-06-19T11:54:03.526Z"},{"number":"1.0.19","date":"2017-06-19T12:03:39.855Z"},{"number":"1.0.20","date":"2017-06-19T19:49:47.896Z"},{"number":"1.0.21","date":"2017-06-19T22:01:36.302Z"},{"number":"1.0.22","date":"2017-06-19T22:54:20.651Z"},{"number":"1.0.23","date":"2017-06-19T23:13:22.315Z"},{"number":"1.0.24","date":"2017-06-21T11:07:48.394Z"},{"number":"1.0.25","date":"2017-06-21T22:28:03.515Z"},{"number":"1.0.26","date":"2017-06-22T00:52:16.583Z"},{"number":"1.0.27","date":"2017-06-22T04:35:57.327Z"},{"number":"1.0.29","date":"2017-06-22T06:25:14.430Z"},{"number":"1.0.30","date":"2017-06-23T04:51:29.623Z"},{"number":"1.0.31","date":"2017-06-23T05:19:32.156Z"},{"number":"1.1.0","date":"2017-06-24T02:39:28.330Z"},{"number":"1.1.1","date":"2017-06-24T06:38:01.998Z"},{"number":"1.1.2","date":"2017-06-24T09:35:51.602Z"},{"number":"1.1.3","date":"2017-06-24T11:35:58.858Z"},{"number":"1.1.4","date":"2017-06-25T01:43:48.137Z"}],"readme":"# Express Form Post \r\n[![npm version](https://badge.fury.io/js/express-form-post.svg)](https://badge.fury.io/js/express-form-post) [![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg?style=flat)](https://github.com/feross/standard) [![npm](https://img.shields.io/npm/dt/express-form-post.svg)]()\r\n\r\n**A simple and efficient solution to handling file and form submissions**\r\n\r\n**Note: This module works in any node.js setting. Express is not required for usage.**\r\n\r\nMany bugs were addressed in v1.1.4, so if you have an older version please consider switching to the latest.\r\n\r\n\r\n## Why use this module?\r\n * Easy setup\r\n \t* abstracts set up for both dropbox and aws-s3 multipart uploads\r\n * Validation for the entire request body before finalizing uploads\r\n \t* Other modules only offer validation based on file size or metadata\r\n \t* Perfect for applications that require uploads on signup and those looking to save api requests\r\n \t* This makes efp faster as it can abort the file upload if you invalidate the request body\r\n * Pipes buffer streams to api endpoints making it a very fast and memory efficient file uploader\r\n\r\n\r\n## Installation\r\n```sh\r\n$ npm install express-form-post --save\r\n```\r\n\r\n## Usage\r\n\r\nThe information for the uploaded file will be available in the `files` object in the `request` object. Fields that were sent along the request will be available on the`body` object in the `request` object. express-form-post can be dropped in as middleware or used as a function to handle file upload. Check out the samples on the [github](https://github.com/dannycho7/express-form-post) repository for more specific usage!\r\n\r\n## Quick Start with express.js\r\n\r\n```javascript\r\nvar express = require(\"express\");\r\nvar app = express();\r\nvar efp = require(\"express-form-post\");\r\nvar formPost = efp();\r\n\r\napp.use(formPost.middleware());\r\n```\r\n\r\n## Usage as an asynchronous function (Highly Recommended)\r\nYou can also use express-form-post's method 'upload' instead of the middleware method. It is a more intuitive way of handling the upload. I would recommend using this if you want to handle errors in any sophisticated way (if you're doing something more than just logging the error).\r\n\r\n**This allows you to use express-form-post without express routing**\r\n\r\n```javascript\r\nvar express = require(\"express\");\r\nvar app = express();\r\nvar efp = require(\"express-form-post\");\r\nvar formPost = efp();\r\n\r\napp.post(\"/upload\", function(req, res, next) { \r\n\tformPost.upload(req, res, function(err) {\r\n\t\tif(err) {\r\n\t\t\tconsole.log(err);\r\n\t\t}\r\n\t\tconsole.log(\"My files are located here:\", req.files);\r\n\t\tres.redirect(\"/\");\r\n\t});\r\n}\r\n```\r\n\r\n## Usage with Disk Storage\r\n\r\n```javascript\r\nvar express = require(\"express\");\r\nvar app = express();\r\nvar efp = require(\"express-form-post\");\r\nconst formPost = efp({\r\n\tstore: \"disk\",\r\n\tdirectory: path.join(__dirname, \"tmp\"),\r\n\tmaxfileSize: 10000,\r\n\tfilename: function(originalname, fieldname, mimetype) {\r\n\t\treturn Date.now() + \"-\" + originalname;\r\n\t},\r\n\tvalidateFile: function(cb, fieldname, mimetype) {\r\n\t\tconsole.log(mimetype);\r\n\t\tif(mimetype != \"application/pdf\") {\r\n\t\t\treturn cb(false);\r\n\t\t}\r\n\t\treturn cb();\r\n\t},\r\n\tvalidateBody: function(cb, body) {\r\n\t\t// validates password length before uploading file\r\n\t\tif(body.password.length > 7) {\r\n\t\t\treturn cb(false);\r\n\t\t}\r\n\t\tcb();\r\n\t}\r\n});\r\n\r\napp.post(\"/upload\", formPost.middleware(), function(req, res, next) {\r\n\tconsole.log(\"I just received files\", req.files);\r\n\tres.send(\"Upload successful!\");\r\n});\r\n```\r\n\r\n## Usage with aws-s3\r\n\r\n```sh\r\n$ npm install aws-sdk --save\r\n```\r\n\r\n```javascript\r\nvar express = require(\"express\");\r\nvar app = express();\r\nvar efp = require(\"express-form-post\");\r\nconst formPost = efp({\r\n\tstore: \"aws-s3\",\r\n\tmaxfileSize: 100000,\r\n\tfilename: function(originalname, fieldname, mimetype) {\r\n\t\treturn originalname;\r\n\t},\r\n\tapi: {\r\n\t\taccessKeyId: process.env.AWS_ACCESS_KEY_ID,\r\n\t\tsecretAccessKey: process.env.secretAccessKey,\r\n\t\tbucketName: process.env.S3_BUCKET_NAME,\r\n\t\tACL: \"public-read\"\r\n\t}\r\n})\r\n\r\napp.post(\"/upload\", formPost.middleware(), function(req, res, next) {\r\n\tconsole.log(\"I just received files\", req.files);\r\n\tres.send(\"Upload successful!\");\r\n});\r\n```\r\n\r\n## Usage with dropbox\r\n\r\n```sh\r\n$ npm install dropbox-stream --save\r\n```\r\n\r\n```javascript\r\nvar express = require(\"express\");\r\nvar app = express();\r\nvar efp = require(\"express-form-post\");\r\nconst formPost = efp({\r\n\tstore: \"dropbox\",\r\n\tfilename: function(originalname, fieldname, mimetype) {\r\n\t\treturn originalname;\r\n\t},\r\n\tapi: {\r\n\t\taccessToken: process.env.dropboxAccessToken\r\n\t}\r\n});\r\n\r\napp.use(formPost.middleware(function(err) {\r\n\tif(err) console.log(err);\r\n\tconsole.log(\"Here are my files\", req.files);\r\n}));\r\n```\r\n\r\n## API\r\n\r\nWhen initializing an instance of efp (express-form-post)  you can provide it different options that will change the way efp handles your file uploads. \r\n\r\n#### express-form-post([opts])\r\n\r\nexpress-form-post accepts an \"optional\" options parameter list. Keep in mind all fields are OPTIONAL. If you don't provide any, the express-form-post api will take care of that using the default options.\r\n\r\nKey | Description | Note\r\n--- | --- | ---\r\n`store` | The type of store | check below for available store methods\r\n`directory` | The folder to which the file will be saved | defaults to current directory\r\n`filename` | function to determine file save name | defaults to the a unique 64 bit hash generated by `hasha`\r\n`maxfileSize` | Maximum Size of the uploaded file in bytes | defaults to infiniti\r\n`minfileSize` | Minimum Size of the uploaded file in bytes | defaults to 0\r\n`validateFile` | function to validate uploaded file | takes two optional parameters: fieldname and mimetype \r\n`validateBody` | function to validate the body of the request before storing the validated file | request body is the parameter\r\n`api` | api configuration information (api keys) | read further documentation for specifications \r\n\r\n## Validation\r\n\r\nOne of the advantages of using express-form-post to handle file uploads is the validation api. There are two (optional) validation methods available during setup: validateFile and validateBody. <br/>\r\n\r\nIf specifying a validation method property, you must call the callback argument or your file will go unhandled.\r\n\r\nBoth validate functions were designed to be an intuitive way to create conditional file handling. In order to invalidate a request/file upload, you just need to return the callback with the argument false. Examples are listed below.\r\n\r\n#### validateBody(callback, body)\r\nThe validateBody method validates the request's body before sending off your file to the specified store. This is especially helpful for handling signups that require uploading some type of file (e.g a resume). For example, if the user signs up without filling in the proper fields, you can cancel the file upload (saves api requests and creates faster responses for errors). Here is an example with validating that a field called 'username' was sent.\r\n\r\n```javascript\r\nconst formPost = efp({\r\n\tvalidateBody: function(cb, body) {\r\n\t\tif(body.username == undefined) {\r\n\t\t\treturn cb(false);\r\n\t\t}\r\n\t\tcb();\r\n\t}\r\n});\r\n```\r\n\r\n#### validateFile(fieldname, mimetype)\r\nThe validateFile method validates the file data itself. An example use case would be checking if the file is a pdf. This particular example is listed below.\r\n\r\n```javascript\r\nconst formPost = efp({\r\n\tvalidateFile: function(fieldname, mimetype) {\r\n\t\tif(mimetype != \"application/pdf\") {\r\n\t\t\treturn cb(false);\r\n\t\t} else {\r\n\t\t\tcb();\r\n\t\t}\r\n\t}\r\n});\r\n```\r\n\r\n## Available storage methods\r\n * disk\r\n * aws s3\r\n * dropbox\r\n\r\n### Storage handlers\r\n\r\nThere are three different ways to handle form data with express-form-post. The three ways are available as methods in the instance of a express-form-post object.\r\n\r\n#### upload(request, response[, callback])\r\nThis method is used inside routes as a function rather than middleware. This allows better readability and customizability. This function takes in three parameters : request, response, and an optional callback. The request and response object should be the ones provided by express.\r\n\r\n#### middleware([callback])\r\nThis method is used as middleware and provides a good layer of abstraction for file handling.\r\n\r\n#### fields\r\nThis method is used to only parse the fields and ignore the files. I would recommend against using this and to use `body-parser` instead, but fields is available for those who are not looking to download multiple modules that do the same.\r\n\r\n### Configuring cloud storage\r\n\r\nHere are the different information you can input for each api storage. These options would go inside the api property of the options listed above.\r\n\r\n#### aws-s3\r\nKey | Description | Note\r\n--- | --- | ---\r\n`accessKeyId` | AWS access key id | **Required** You can find it here : [aws console](https://aws.amazon.com/console/)\r\n`secretAccessKey` | secret key for aws | Optional based on your s3 settings\r\n`bucketName` | The name of your bucket. | **Required**\r\n`ACL` | Access control list  | Privacy control. Defaults to \"private\"\r\n\r\n\r\n#### dropbox\r\n\r\nKey | Description | Note\r\n--- | --- | ---\r\n`accessToken` | used by Dropbox to identify your app | **Required** Check out the [docs](https://www.dropbox.com/developers)\r\n`clientId` | Dropbox client Id | Optional\r\n`selectUser` | Specific user in a team box | Optional\r\n\r\n\r\n## Samples\r\n\r\nSamples are also available on the github page. Please take a look and reach out if you have any questions: [github](https://github.com/dannycho7/express-form-post)","created":"2017-05-24T06:37:59.870Z","modified":"2017-06-25T01:43:48.137Z","lastPublisher":{"name":"dannycho7","email":"dannycho7@gmail.com"},"owners":[{"name":"dannycho7","email":"dannycho7@gmail.com"}],"other":{"_attachments":{},"_id":"express-form-post","_nodeVersion":"6.11.0","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/express-form-post-1.1.4.tgz_1498355028007_0.8511926857754588"},"_npmUser":{"name":"dannycho7","email":"dannycho7@gmail.com"},"_npmVersion":"5.0.3","_rev":"38-369d40b9b74112afe2152399e7e318fe","author":{"name":"Danny Cho","url":"dannycho7"},"bugs":{"url":"https://github.com/dannycho7/express-form-post/issues"},"directories":{},"dist-tags":{"latest":"1.1.4"},"dist":{"integrity":"sha512-Z6j6b0QheK3X43TPaLsCRt6RN4G67Yybr01VRQtdEfgWMT8GRvsf3wdfQs/80K5oTVEElkAxuQaIcPXHQ1HGRA==","shasum":"dc12d264b3d6fa0a9d7bbdb6e26cbea06fc5d003","tarball":"https://registry.npmjs.org/express-form-post/-/express-form-post-1.1.4.tgz"},"maintainers":[{"name":"dannycho7","email":"dannycho7@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-06-25T01:43:48.137Z","created":"2017-05-24T06:37:59.870Z","1.0.0":"2017-05-24T06:37:59.870Z","1.0.1":"2017-06-05T23:21:47.060Z","1.0.2":"2017-06-05T23:22:38.252Z","1.0.3":"2017-06-05T23:23:38.422Z","1.0.4":"2017-06-06T02:04:02.453Z","1.0.5":"2017-06-17T12:09:20.650Z","1.0.6":"2017-06-17T12:16:37.907Z","1.0.7":"2017-06-17T12:25:02.170Z","1.0.8":"2017-06-17T20:16:38.375Z","1.0.9":"2017-06-18T01:01:42.117Z","1.0.11":"2017-06-18T02:46:34.705Z","1.0.12":"2017-06-18T03:04:26.342Z","1.0.13":"2017-06-18T03:34:12.186Z","1.0.14":"2017-06-18T05:48:20.711Z","1.0.15":"2017-06-19T01:17:53.342Z","1.0.16":"2017-06-19T10:06:07.051Z","1.0.17":"2017-06-19T11:22:02.164Z","1.0.18":"2017-06-19T11:54:03.526Z","1.0.19":"2017-06-19T12:03:39.855Z","1.0.20":"2017-06-19T19:49:47.896Z","1.0.21":"2017-06-19T22:01:36.302Z","1.0.22":"2017-06-19T22:54:20.651Z","1.0.23":"2017-06-19T23:13:22.315Z","1.0.24":"2017-06-21T11:07:48.394Z","1.0.25":"2017-06-21T22:28:03.515Z","1.0.26":"2017-06-22T00:52:16.583Z","1.0.27":"2017-06-22T04:35:57.327Z","1.0.29":"2017-06-22T06:25:14.430Z","1.0.30":"2017-06-23T04:51:29.623Z","1.0.31":"2017-06-23T05:19:32.156Z","1.1.0":"2017-06-24T02:39:28.330Z","1.1.1":"2017-06-24T06:38:01.998Z","1.1.2":"2017-06-24T09:35:51.602Z","1.1.3":"2017-06-24T11:35:58.858Z","1.1.4":"2017-06-25T01:43:48.137Z"}}}