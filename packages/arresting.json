{"name":"arresting","version":"1.0.0","description":"An HTTP client library for node.js with built-in rate-limiting","homepage":"https://github.com/bryandollery/arresting","repository":"https://github.com/bryandollery/arresting","main":"./lib/arresting","engines":{"node":">= 0.10.x"},"scripts":{"test":"node test/all.js"},"dependencies":{"iconv-lite":"0.2.11","lodash":"^3.10.1","qs":"1.2.0","simple-rate-limiter":"^0.2.3","xml2js":"0.4.0","yaml":"0.2.3"},"devDependencies":{"nodeunit":"0.8.2"},"license":"MIT","gitHead":"585735c46175e792416c657a7717e22ffcf60fc8","versions":[{"number":"1.0.0","date":"2016-04-26T13:38:27.473Z"}],"readme":"Arresting [![NPM Version](https://img.shields.io/npm/v/arresting.svg?style=flat)](https://www.npmjs.com/package/arresting) ![Node Version](https://img.shields.io/node/v/arresting.svg?style=flat) ![Downloads](https://img.shields.io/npm/dm/arresting.svg?style=flat) [![Build Status](https://travis-ci.org/bryandollery/arresting.svg?branch=master)](https://travis-ci.org/bryandollery/arresting)\n=======\n\nAn HTTP client library for node.js with built-in rate-limiting.  Originally forked from danwrong/restler. Added rate-limiting. Merged in some of the pull requests outstanding on Dan Webb's Restler project, which hasn't seen any love for ages.\n\nSee [Version History](https://github.com/bryandollery/arresting/wiki/Version-History) for changes\n\nCopyright\n----------\n(C) Bryan Dollery 2016, Licensed under the MIT-LICENSE\n\nLargely based on Dan Webb's 'Restler' module:\n\n(C) Dan Webb (dan@danwebb.net/@danwrong) 2011, Licensed under the MIT-LICENSE\n\nContains contributions from other developers/contributors with copyright for those owned by the original author.\n\nInstalling\n----------\n\n```\nnpm install arresting\n```\n\nRunning the tests\n-----------------\n\n```\nnpm test\n```\n\n\nFeatures\n--------\n\n* Easy interface for common operations via http.request\n* Automatic serialization of post data\n* Automatic serialization of query string data\n* Automatic deserialization of XML, JSON and YAML responses to JavaScript objects\n* Provide your own deserialization functions for other datatypes\n* Automatic following of redirects\n* Send files with multipart requests\n* Transparently handle SSL (just specify https in the URL)\n* Deals with basic auth for you, just provide username and password options\n* Simple service wrapper that allows you to easily put together REST API libraries\n* Transparently handle content-encoded responses (gzip, deflate)\n* Transparently handle different content charsets via [iconv-lite](https://github.com/ashtuchkin/iconv-lite)\n\n\nAPI\n---\n\n### request(url, options)\n\nBasic method to make a request of any type. The function returns a RestRequest object that emits events:\n\n#### events\n\n* `complete: function(result, response)` - emitted when the request has finished whether it was successful or not. Gets passed the response result and the response object as arguments. If some error has occurred, `result` is always instance of `Error`, otherwise it contains response data.\n* `success: function(data, response)` - emitted when the request was successful. Gets passed the response data and the response object as arguments.\n* `fail: function(data, response)` - emitted when the request was successful, but 4XX or 5XX status code returned. Gets passed the response data and the response object as arguments.\n* `error: function(err, response)` - emitted when some errors have occurred (eg. connection aborted, parse, encoding, decoding failed or some other unhandled errors). Gets passed the `Error` object and the response object (when available) as arguments.\n* `abort: function()` - emitted when `request.abort()` is called.\n* `timeout: function(ms)` - when a request takes more than the timeout option eg: {timeout:5000}, the request will be aborted. error and abort events will not be called, instead timeout will be emitted.\n* `2XX`, `3XX`, `4XX`, `5XX: function(data, response)` - emitted for all requests with response codes in the range (eg. `2XX` emitted for 200, 201, 203).\n* <code><i>actual response code</i>: function(data, response)</code> - emitted for every single response code (eg. 404, 201, etc).\n\n#### members\n\n* `abort([error])` Cancels request. `abort` event is emitted. `request.aborted` is set to `true`. If non-falsy `error` is passed, then `error` will be additionally emitted (with `error` passed as a param and `error.type` is set to `\"abort\"`). Otherwise only `complete` event will raise.\n* `retry([timeout])` Re-sends request after `timeout` ms. Pending request is aborted.\n* `aborted` Determines if request was aborted.\n\n\n### get(url, options)\n\nCreate a GET request.\n\n### post(url, options)\n\nCreate a POST request.\n\n### put(url, options)\n\nCreate a PUT request.\n\n### del(url, options)\n\nCreate a DELETE request.\n\n### head(url, options)\n\nCreate a HEAD request.\n\n### patch(url, options)\n\nCreate a PATCH request.\n\n### json(url, data, options)\n\nSend json `data` via GET method.\n\n### postJson(url, data, options)\n\nSend json `data` via POST method.\n\n### putJson(url, data, options)\n\nSend json `data` via PUT method.\n\n### patchJson(url, data, options)\n\nSend json `data` via PATCH method.\n\n### Parsers\n\nYou can give any of these to the parsers option to specify how the response data is deserialized.\nIn case of malformed content, parsers emit `error` event. Original data returned by server is stored in `response.raw`.\n\n#### parsers.auto\n\nChecks the content-type and then uses parsers.xml, parsers.json or parsers.yaml.\nIf the content type isn't recognised it just returns the data untouched.\n\n#### parsers.json, parsers.xml, parsers.yaml\n\nAll of these attempt to turn the response into a JavaScript object. In order to use the YAML and XML parsers you must have yaml and/or xml2js installed.\n\n### Options\n\n* `method` Request method, can be get, post, put, delete. Defaults to `\"get\"`.\n* `query` Query string variables as a javascript object, will override the querystring in the URL. Defaults to empty.\n* `data` The data to be added to the body of the request. Can be a string or any object.\nNote that if you want your request body to be JSON with the `Content-Type: application/json`, you need to\n`JSON.stringify` your object first. Otherwise, it will be sent as `application/x-www-form-urlencoded` and encoded accordingly.\nAlso you can use `json()` and `postJson()` methods.\n* `parser` A function that will be called on the returned data. Use any of predefined `arresting.parsers`. See parsers section below. Defaults to `arresting.parsers.auto`.\n* `xml2js` [Options](https://github.com/Leonidas-from-XIV/node-xml2js#options) for xml2js\n* `encoding` The encoding of the request body. Defaults to `\"utf8\"`.\n* `decoding` The encoding of the response body. For a list of supported values see [Buffers](http://nodejs.org/api/buffer.html#buffer_buffer). Additionally accepts `\"buffer\"` - returns response as `Buffer`. Defaults to `\"utf8\"`.\n* `headers` A hash of HTTP headers to be sent. Defaults to `{ 'Accept': '*/*', 'User-Agent': 'Arresting for node.js' }`.\n* `username` Basic auth username. Defaults to empty.\n* `password` Basic auth password. Defaults to empty.\n* `accessToken` OAuth Bearer Token. Defaults to empty.\n* `multipart` If set the data passed will be formatted as `multipart/form-encoded`. See multipart example below. Defaults to `false`.\n* `client` A http.Client instance if you want to reuse or implement some kind of connection pooling. Defaults to empty.\n* `followRedirects` If set will recursively follow redirects. Defaults to `true`.\n* `timeout` If set, will emit the timeout event when the response does not return within the said value (in ms)\n* `rejectUnauthorized` If true, the server certificate is verified against the list of supplied CAs. An 'error' event is emitted if verification fails. Verification happens at the connection level, before the HTTP request is sent. Default true.\n* `agent` [HTTP Agent][http-agent-doc] instance to use. If not defined [globalAgent][http-global-agent-doc] will be used. If false opts out of connection pooling with an Agent, defaults request to Connection: close.\n\nExample usage\n-------------\n\n```javascript\nvar rest = require('./arresting');\n\nrest.get('http://google.com').on('complete', function(result) {\n  if (result instanceof Error) {\n    console.log('Error:', result.message);\n    this.retry(5000); // try again after 5 sec\n  } else {\n    console.log(result);\n  }\n});\n\nrest.get('http://twaud.io/api/v1/users/danwrong.json').on('complete', function(data) {\n  console.log(data[0].message); // auto convert to object\n});\n\nrest.get('http://twaud.io/api/v1/users/danwrong.xml').on('complete', function(data) {\n  console.log(data[0].sounds[0].sound[0].message); // auto convert to object\n});\n\nrest.get('http://someslowdomain.com',{timeout: 10000}).on('timeout', function(ms){\n  console.log('did not return within '+ms+' ms');\n}).on('complete',function(data,response){\n  console.log('did not time out');\n});\n\nrest.post('http://user:pass@service.com/action', {\n  data: { id: 334 },\n}).on('complete', function(data, response) {\n  if (response.statusCode == 201) {\n    // you can get at the raw response like this...\n  }\n});\n\n// multipart request sending a 321567 byte long file using https\nrest.post('https://twaud.io/api/v1/upload.json', {\n  multipart: true,\n  username: 'danwrong',\n  password: 'wouldntyouliketoknow',\n  data: {\n    'sound[message]': 'hello from arresting!',\n    'sound[file]': rest.file('doug-e-fresh_the-show.mp3', null, 321567, null, 'audio/mpeg')\n  }\n}).on('complete', function(data) {\n  console.log(data.audio_url);\n});\n\n// create a service constructor for very easy API wrappers a la HTTParty...\nTwitter = rest.service(function(u, p) {\n  this.defaults.username = u;\n  this.defaults.password = p;\n}, {\n  baseURL: 'http://twitter.com'\n}, {\n  update: function(message) {\n    return this.post('/statuses/update.json', { data: { status: message } });\n  }\n});\n\nvar client = new Twitter('danwrong', 'password');\nclient.update('Tweeting using a Arresting service thingy').on('complete', function(data) {\n  console.log(data);\n});\n\n// create a service, as above, but limit it to making 5 http/s requests a second\nTwitter = rest.service(function(u, p) {\n  this.defaults.username = u;\n  this.defaults.password = p;\n}, {\n  baseURL: 'http://twitter.com',\n  rateLimit: {\n    to: 5,\n    per: 1000\n  }\n}, {\n  update: function(message) {\n    return this.post('/statuses/update.json', { data: { status: message } });\n  }\n});\n\nvar client = new Twitter('danwrong', 'password');\nclient.update('Tweeting using a Arresting service thingy').on('complete', function(data) {\n  console.log(data);\n});\n\n// Rate limit only chosen methods -- as above, but with an array containing those methods to limit\nTwitter = rest.service(function(u, p) {\n  this.defaults.username = u;\n  this.defaults.password = p;\n}, {\n  baseURL: 'http://twitter.com',\n  rateLimit: {\n    to: 5,\n    per: 1000,\n    methods: ['post', 'put', 'del', 'patch'] // only rate limit those methods that may change things on the server\n  }\n}, {\n  update: function(message) {\n    return this.post('/statuses/update.json', { data: { status: message } });\n  }\n});\n\nvar client = new Twitter('danwrong', 'password');\nclient.update('Tweeting using a Arresting service thingy').on('complete', function(data) {\n  console.log(data);\n});\n\n// post JSON\nvar jsonData = { id: 334 };\nrest.postJson('http://example.com/action', jsonData).on('complete', function(data, response) {\n  // handle response\n});\n\n// put JSON\nvar jsonData = { id: 334 };\nrest.putJson('http://example.com/action', jsonData).on('complete', function(data, response) {\n  // handle response\n});\n\n```\n=======\nTODO\n----\n* What do you need? Let me know or fork.\n\n[http-agent-doc]: https://nodejs.org/api/http.html#http_class_http_agent\n[http-global-agent-doc]: https://nodejs.org/api/http.html#http_http_globalagent \n","starsCount":1,"created":"2016-04-26T13:38:27.473Z","modified":"2016-04-26T13:38:27.473Z","lastPublisher":{"name":"bryandollery","email":"bryan.dollery@gmail.com"},"owners":[{"name":"bryandollery","email":"bryan.dollery@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"arresting","_nodeVersion":"5.11.0","_npmOperationalInternal":{"host":"packages-12-west.internal.npmjs.com","tmp":"tmp/arresting-1.0.0.tgz_1461677905023_0.507096559740603"},"_npmUser":{"name":"bryandollery","email":"bryan.dollery@gmail.com"},"_npmVersion":"3.8.6","_rev":"1-d4a000af4144058c7ef86ef97a7386e9","_shasum":"e5a21c2c9b180055c8858371a4ab7ffe58c3c323","bugs":{"url":"https://github.com/bryandollery/arresting/issues"},"contributors":[{"name":"Bryan Dollery","email":"bryan.dollery@gmail.com"}],"directories":{"lib":"./lib"},"dist-tags":{"latest":"1.0.0"},"dist":{"shasum":"e5a21c2c9b180055c8858371a4ab7ffe58c3c323","tarball":"http://registry.npmjs.org/arresting/-/arresting-1.0.0.tgz"},"maintainers":[{"name":"bryandollery","email":"bryan.dollery@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2016-04-26T13:38:27.473Z","created":"2016-04-26T13:38:27.473Z","1.0.0":"2016-04-26T13:38:27.473Z"},"users":{"bryandollery":true}}}