{"name":"throttle-agent","version":"0.1.0","description":"Node.js HTTP Agent with throttling","main":"index.js","scripts":{"test":"echo \"Error: no test specified\" && exit 1"},"repository":"https://github.com/druide/node-throttle-agent","keywords":["http","agent","throttling"],"license":"MIT","homepage":"https://github.com/druide/node-throttle-agent#readme","dependencies":{"@druide/flow-remove-types-register":"^1.0.0","@druide/rate-limiter":"^1.2.5"},"devDependencies":{"superagent":"^3.2.1"},"gitHead":"42505e96a8ebe6c447a8e128460bdc40280a9337","versions":[{"number":"0.1.0","date":"2016-12-15T14:45:07.195Z"}],"readme":"# throttle-agent\n\n[![Standard - JavaScript Style Guide](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com/)\n[![Flowtype](https://img.shields.io/badge/flowtype-yes-green.svg)](https://flowtype.org/)\n[![npm version](https://img.shields.io/npm/v/throttle-agent.svg)](https://www.npmjs.com/package/throttle-agent)\n[![license](https://img.shields.io/github/license/druide/node-throttle-agent.svg)](https://github.com/druide/node-throttle-agent)\n\nNode.js HTTP Agent with throttling. Agent is doing adjustment of request rate\ndepending of connection throughput and settings.\n\n## Install\n\n```\nnpm install throttle-agent --save\n```\n\n## Usage\n\nUse agent same way as http.Agent:\n\n```js\nconst Agent = require('throttle-agent')\nconst http = require('http')\nconst urlParser = require('url')\n\nconst URL = 'http://localhost:8000'\nconst TIMEOUT = 500\n\nlet keepAliveAgent = new Agent({\n  keepAlive: true,\n  maxSockets: 5,\n  rate: 15\n})\n\nfunction doRequest () {\n  let options = urlParser.parse(URL)\n  options.agent = keepAliveAgent\n  options.timeout = TIMEOUT\n\n  http.request(options, (res) => {\n    let str = ''\n    res.on('data', (chunk) => {\n      str += chunk\n    }).on('end', () => {\n      process.stdout.write(str)\n    })\n  }).end()\n}\n\nsetInterval(() => {\n  for (var i = 0; i < 10; i++) doRequest()\n}, 1)\n\nsetInterval(() => {\n  console.dir(keepAliveAgent.getStats())\n}, 5000)\n\n```\n\nor use `canAcceptRequest()` method to check before request object creation:\n\n```js\n...\n\nlet keepAliveAgent = new Agent({\n  keepAlive: true,\n  maxSockets: 5,\n  rate: 15,\n  checkBeforeRequest: true\n})\n\nfunction doRequest () {\n  if (!keepAliveAgent.canAcceptRequest(URL)) return\n\n  // otherwise create request\n  ...\n}\n\n...\n```\n\n## Options\n\n- `checkBeforeRequest`: Boolean - check before request with `canAcceptRequest()`\n  method (true) or check on request (false).\n- `rate`: Number - default rate limit. Override with `getRate()`.\n- `rateInterval`: Number - rate interval, milliseconds. Default 1000.\n- `rateLowerWeight`: Number - weight of lowering of rate compared to raising of\n  rate. Default 18.\n- `rateLowerKoef`: Number - decrease of rate koefficient, default 0.1.\n- `rateRaiseKoef`: Number - increase of rate koefficient, default 0.02.\n- `maxPending`: Number - max pending requests, default 3000.\n- `maxBuffer`: Number - max socket buffer size, default 50.\n- `getRate`: RateCallback - function to return max rate for endpoint. Example:\n  ```js\n    function getRate (name, flag) {\n      return flag === 'domain1' ? 12 : 100;\n    }\n  ```\n\n- `getFlag`: FlagCallback - function to get stat label from URL. Return '' to\n  use Agent's default `domain:port:`. Example:\n\n  ```js\n  function getFlag (url) {\n    return url === 'http://test.com' ? 'domain1' : 'general';\n  }\n  ```\n\n- `getRateDirection`: RateDirectionCallback - function to make decision of rate\n  modification. Returns -1 to decrease, 1 to increase and 0 to do nothing.\n  By default rate is increased on every 2xx, 3xx code or if there are free\n  opened sockets available, and decreased on timeouts, errors or when pending\n  sockets number is high.\n","created":"2016-12-15T14:45:07.195Z","modified":"2016-12-15T14:45:07.195Z","lastPublisher":{"name":"druide","email":"ingvuil@gmail.com"},"owners":[{"name":"druide","email":"ingvuil@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"throttle-agent","_nodeVersion":"6.3.0","_npmOperationalInternal":{"host":"packages-12-west.internal.npmjs.com","tmp":"tmp/throttle-agent-0.1.0.tgz_1481813105206_0.6577294708695263"},"_npmUser":{"name":"druide","email":"ingvuil@gmail.com"},"_npmVersion":"3.10.3","_rev":"1-8268d91155e90676fd49a8c54bb7cb52","_shasum":"77961a10b0a3beb812bfecd4de0fc14134732a8b","author":{"name":"druide","email":"ingvuil@gmail.com"},"bugs":{"url":"https://github.com/druide/node-throttle-agent/issues"},"directories":{"example":"examples"},"dist-tags":{"latest":"0.1.0"},"dist":{"shasum":"77961a10b0a3beb812bfecd4de0fc14134732a8b","tarball":"http://registry.npmjs.org/throttle-agent/-/throttle-agent-0.1.0.tgz"},"maintainers":[{"name":"druide","email":"ingvuil@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2016-12-15T14:45:07.195Z","created":"2016-12-15T14:45:07.195Z","0.1.0":"2016-12-15T14:45:07.195Z"}}}