{"name":"nodalytics","version":"1.1.0","description":"Google Analytics for Node.js HTTP APIs","tags":["google","analytics","node.js","http","server","web","api"],"main":"./lib/nodalytics.js","engines":{"node":">= 0.8"},"licenses":[{"type":"Apache","url":"http://www.apache.org/licenses/LICENSE-2.0"}],"dependencies":{},"homepage":"https://github.com/tjanczuk/nodalytics","repository":"https://github.com/tjanczuk/nodalytics","gitHead":"21f57f1295f9939e4e4db2cb9b04bc46681a995a","scripts":{},"versions":[{"number":"1.0.0","date":"2014-03-01T06:10:11.956Z"},{"number":"1.1.0","date":"2014-12-19T00:07:40.470Z"}],"readme":"Analytics for Node.js HTTP APIs\n==========\n[Tweet](https://twitter.com/home?status=Google%20Analytics%20for%20Node.js%20HTTP%20APIs%20http://github.com/tjanczuk/nodalytics%20via%20@tjanczuk%20%23nodejs%20%23webapi%20%23http) | [Google+](https://plus.google.com/share?url=http://github.com/tjanczuk/nodalytics) | [Facebook](https://www.facebook.com/sharer/sharer.php?u=http://github.com/tjanczuk/nodalytics) | [Follow @tjanczuk](https://twitter.com/intent/user?screen_name=tjanczuk)\n\n*Nodalytics* hooks up Google Analytics to your server side HTTP APIs in Node.js. With one line of code you can capture and analyze statistical information about HTTP calls being made to your HTTP service: \n\n* What endpoints are called?\n* What HTTP verbs are used?\n* What are the query string parameters?\n* What user agents are calling your APIs?\n* Where are the calls originating from?\n* How many new and repeated callers do you have?\n\nThe *nodalytics* module uses [Google Measurement Protocol](https://developers.google.com/analytics/devguides/collection/protocol/v1/) to communicate directly with Google Analytics from your server. Unlike with Google Analytics for web sites or mobile applications, this is useful when you can't or don't want to control the client side code.\n\n### Getting started\n\nFirst, [create a Google Analytics account](http://www.google.com/analytics/) and a property under this account that you will use to track calls to your HTTP APIs. When asked about the type of the property (*web* or *mobile*), choose *web*. Your property will be assigned a property ID, for example `UA-44126622-6`. \n\nInstall the *nodalytics* module from NPM:\n\n```\nnpm install nodalytics\n```\n\nThen use it as connect middleware in your minimalist express.js application, and specify the Google Analytics property id as a parameter:\n\n```javascript\nvar express = require('express')\n  , nodalytics = require('nodalytics')\n\nvar app = express();\n\napp.use(nodalytics('UA-44126622-6'));\n\napp.all('*', function (req, res) {\n\tres.send('Hello!');\n});\n\napp.listen(3000);\n```\n\nYou are done. Every time an HTTP call is received by your service, appropriate event will be logged to your Google Analytics property. To verify, open your Google Analytics dashboard, go to *Real Time* | *Events* report, then start your server and issue a few requests against it:\n\n```\nnode app.js &\ncurl http://localhost:3000/foo?a=1\ncurl http://localhost:3000/bar?b=1\ncurl http://localhost:3000/baz -d somedata\n```\n\nYou should see the Google Analytics events showing up in real time in the dashboard (two for HTTP GET and one for HTTP POST). \n\n### Analytics for URL path, query string, and HTTP verb \n\nFor analytics purposes, HTTP calls made to your service are mapped to the concepts of Google Analytics Events as follows:\n\n* HTTP request URL path is represented as *Event Category*\n* HTTP request URL verb is represented as *Event Action*\n* HTTP request URL query string is represented as *Event Label*\n\nUsing the Google Analytics Dashboard, you can slice and pivot the collected data in a number of ways. \n\n### Analytics for new and repeated callers\n\nIn addition to the basic HTTP path/verb/query information, *nodalytics* also supports tracking information about new and repeated callers (new and returning visitors in web site lingo). To use this feature, your service must be built with a first class notion of a unique caller. By default, Express.js session id is used to identify repeated callers. As such, to track new and repeated callers, you must enable session support in your express application:\n\n```javascript\napp.use(express.cookieParser('your secret here'));\napp.use(express.session());\napp.use(nodalytics('UA-44126622-6'));\n```\n\nNote that this mechanism relies on HTTP cookies and is therefore only as good as your client's intentions of preserving them. A better mechanism of tracking new and repeated customers would rely on client authentication - see the section on customization below. \n\n### Customization\n\nThe connect middleware that *nodalytics* provides can be customized as follows (each property except *propopert_id* is optional):\n\n```javascript\napp.use(nodalytics({\n\tproperty_id: 'UA-44125682-6',\n\tmap: function (req, event) {\n\t\t// This function is called to augment the default Google Analytics Event object\n\t\t// created by nodalitics for the specified request. \n\t\t// Parameters:\n\t\t// - req - the Http request that triggered logging attempt\n\t\t// - event - an object representing default values of the Google Analytics Event\n\t\t//           created by nodalitics for the specified request\n\t\t// Return: a Google Analytics Event object to log.\n\t\treturn event;\n    },\n\terror: function (error, event, headers, req, grec, gres) {\n\t    // This function is called when an error occurs communicating with Google Analytics.\n\t    // Parameters:\n\t    // - error - the error\n\t    // - event - the Google Analytics Event logging of which failed\n\t    // - headers - HTTP request headers sent to Google Analytics\n\t    // - req - the HTTP request that triggered logging attempt\n\t    // - greq - the HTTP request sent to Google Analytics that failed\n\t    // - gres - the HTTP response from Google Analytics\n\t},\n\tsuccess: function (event, headers, req, grec, gres) {\n\t    // This function is called after successful logging with Google Analytics.\n\t    // Parameters are the same as with the errors handler above.\n\t}\n}));\n```\n\nFor reference of Google Analytics Event parameters see [here](https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters).\n\nThe `map` handler above is a good place to customize your notion of caller identity for the purpose of tracking new and repeated callers. Set a string uniquely identifying your caller to the `event.cid` property. For example, this can be a username or a public key token representing the caller of your API. \n\n### Like it? Share it.\n\n[Tweet](https://twitter.com/home?status=Google%20Analytics%20for%20Node.js%20HTTP%20APIs%20http://github.com/tjanczuk/nodalytics%20via%20@tjanczuk%20%23nodejs%20%23webapi%20%23http) | [Google+](https://plus.google.com/share?url=http://github.com/tjanczuk/nodalytics) | [Facebook](https://www.facebook.com/sharer/sharer.php?u=http://github.com/tjanczuk/nodalytics) | [Follow @tjanczuk](https://twitter.com/intent/user?screen_name=tjanczuk)","created":"2014-03-01T06:10:10.887Z","modified":"2014-12-19T00:07:40.470Z","lastPublisher":{"name":"tjanczuk","email":"tomasz@janczuk.org"},"owners":[{"name":"tjanczuk","email":"tomasz@janczuk.org"}],"other":{"_attachments":{},"_from":".","_id":"nodalytics","_npmUser":{"name":"tjanczuk","email":"tomasz@janczuk.org"},"_npmVersion":"1.4.21","_rev":"1-22c906d10490e3f40f8285ce6b0c586f","_shasum":"75afcfe540f461cafc8db0aa3b6c2c0eda8864e4","author":{"name":"Tomasz Janczuk","email":"tomasz@janczuk.org","url":"http://tomasz.janczuk.org"},"bugs":{"url":"http://github.com/tjanczuk/nodalytics/issues"},"directories":{},"dist-tags":{"latest":"1.1.0"},"dist":{"shasum":"75afcfe540f461cafc8db0aa3b6c2c0eda8864e4","tarball":"http://registry.npmjs.org/nodalytics/-/nodalytics-1.1.0.tgz"},"maintainers":[{"name":"tjanczuk","email":"tomasz@janczuk.org"}],"readmeFilename":"README.md","time":{"modified":"2014-12-19T00:07:40.470Z","created":"2014-03-01T06:10:10.887Z","1.0.0":"2014-03-01T06:10:11.956Z","1.1.0":"2014-12-19T00:07:40.470Z"}}}