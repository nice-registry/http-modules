{"name":"poolee","version":"1.0.1","description":"HTTP pool and load balancer","homepage":"http://github.com/dannycoates/poolee","keywords":["pool","http","retry","health","load balancer"],"repository":"https://github.com/dannycoates/poolee","engines":{"node":">=0.8.0"},"dependencies":{"keep-alive-agent":"0.0.1"},"scripts":{"test":"mocha -R spec -t 6000 test/*_test.js"},"devDependencies":{"mocha":"2.5.3"},"gitHead":"f243f3d049bed887b23edfd19c1db7c2852e3c48","versions":[{"number":"0.1.0","date":"2012-05-11T19:14:56.382Z"},{"number":"0.1.1","date":"2012-05-14T19:54:18.727Z"},{"number":"0.2.0","date":"2012-06-01T17:47:52.092Z"},{"number":"0.3.0","date":"2012-06-14T02:03:58.281Z"},{"number":"0.4.0","date":"2012-11-28T00:31:07.869Z"},{"number":"0.4.1","date":"2012-11-28T03:00:39.496Z"},{"number":"0.4.2","date":"2012-11-28T18:36:23.130Z"},{"number":"0.4.3","date":"2012-11-29T22:19:58.168Z"},{"number":"0.4.4","date":"2012-12-05T19:59:57.406Z"},{"number":"0.4.5","date":"2012-12-11T19:37:50.171Z"},{"number":"0.4.6","date":"2012-12-13T20:15:13.766Z"},{"number":"0.4.7","date":"2013-01-07T22:47:39.965Z"},{"number":"0.4.8","date":"2013-01-11T19:31:01.257Z"},{"number":"0.4.9","date":"2013-08-16T20:14:42.228Z"},{"number":"0.4.11","date":"2013-12-11T20:17:19.426Z"},{"number":"0.4.12","date":"2014-06-03T22:30:54.303Z"},{"number":"0.4.13","date":"2014-06-03T22:33:56.270Z"},{"number":"0.4.14","date":"2014-06-04T00:43:19.014Z"},{"number":"0.4.15","date":"2014-06-04T18:38:19.011Z"},{"number":"0.4.16","date":"2015-03-27T04:56:10.598Z"},{"number":"1.0.0","date":"2015-03-27T05:57:45.532Z"},{"number":"1.0.1","date":"2016-08-29T20:23:34.545Z"}],"readme":"# poolee\n\nHTTP pool and load balancer for node.\n\n[![Build Status](https://travis-ci.org/dannycoates/poolee.png)](https://travis-ci.org/dannycoates/poolee)\n\n# Example\n\n```javascript\n\nvar Pool = require(\"poolee\")\nvar http = require(\"http\")\n\nvar servers =\n  [\"127.0.0.1:8886\"\n  ,\"127.0.0.1:8887\"\n  ,\"127.0.0.1:8888\"\n  ,\"127.0.0.1:8889\"]\n\nvar postData = '{\"name\":\"Danny Coates\"}'\n\nvar pool = new Pool(http, servers, options)\n\npool.request(\n  { method: \"PUT\"\n  , path: \"/users/me\"\n  }\n, postData\n, function (error, response, body) {\n    if (error) {\n      console.error(error.message)\n      return\n    }\n    if(response.statusCode === 201) {\n      console.log(\"put succeeded\")\n    }\n    else {\n      console.log(response.statusCode)\n      console.log(body)\n    }\n  }\n)\n```\n\n---\n\n# API\n\n## Pool\n\n### new\n\n```javascript\nvar Pool = require('poolee')\n//...\n\nvar pool = new Pool(\n  http                     // the http module to use (require('http') or require('https'))\n  ,\n  [ \"127.0.0.1:1337\"       // array of endpoints in \"host:port\" form\n  , \"127.0.0.1:1338\"\n  ]\n  ,                        // options\n  { maxPending: 1000       // maximum number of outstanding request to allow\n  , maxSockets: 20         // max sockets per endpoint Agent\n  , timeout: 60000         // request timeout in ms\n  , resolution: 1000       // timeout check interval (see below)\n  , keepAlive: false       // use an alternate Agent that does http keep-alive properly\n  , ping: undefined        // health check url\n  , pingTimeout: 2000      // ping timeout in ms\n  , retryFilter: undefined // see below\n  , retryDelay: 20         // see below\n  , maxRetries: 5          // see below\n  , name: undefined        // optional string\n  , agentOptions: undefined// an object for passing options directly to the Http Agent\n  }\n)\n```\n\n###### maxPending\n\nOnce this threshold is reached, requests will return an error to the callback as a\nsignal to slow down the rate of requests.\n\n###### resolution\n\nPending requests have their timeouts checked at this rate. If your timeout is 60000\nand resolution is 1000, the request will timeout no later than 60999\n\n###### keepAlive\n\nThe default http Agent does keep-alive in a stupid way. If you want it to work\nhow you'd expect it to set this to true.\n\n###### retryFilter\n\nAll valid http responses aren't necessarily a \"success\". This function lets you\ncheck the response before calling the request callback. Returning a \"truthy\" value\nwill retry the request.\n\nFor instance, we may want to always retry 500 responses by default:\n```javascript\noptions.retryFilter = function (\n    options  // the request.options\n  , response // the http response object\n  , body     // the response body\n  ) {\n  return response.statusCode === 500\n}\n```\n\nIf the returned value is `true` the next attempt will be delayed using exponential backoff;\nif its a `Number` it will delay the next attempt by that many ms (useful for `Retry-After` headers)\n\n###### retryDelay\n\nPool uses exponential backoff when retrying requests. This value is a scaling factor of the\ntime (ms) to wait. Here's how it works:\n```javascript\nMath.random() * Math.pow(2, attemptNumber) * retryDelay\n```\nIf `retryDelay` is 20, attemptNumber 1 (the first retry) will delay at most 40ms\n\n###### maxRetries\n\nThe maximum number of attempts to make after the first request fails. This only\ntakes effect if maxRetries < pool size.\n\n###### agentOptions\n\nThese options are passed directly to the underlying Agents used in the pool. This\nis nice for passing options like `cert` and `key` that are required for client certificates.\n\n###### ping\n\nWhen an endpoint is unresponsive the pool will not use it for requests. The ping\nurl gives a downed endpoint a way to rejoin the pool. If an endpoint is marked unhealthy\nand a ping url is given, the endpoint will make requests to its ping url until it gets\na 200 response, based on the `resolution` time.\n\nIf the ping url is undefined, the endpoint will never be marked unhealthy.\n\n\n### pool.request\n\nAn http request. The pool sends the request to one of it's endpoints. If it\nfails, the pool may retry the request on other endpoints until it succeeds or\nreaches `options.attempts` number of tries. *When `data` is a Stream, only 1\nattempt will be made*\n\n###### Usage\n\n\nThe first argument may be a url path.\nIf the callback has 3 arguments the full response body will be returned\n\n```javascript\npool.request('/users/me', function (error, response, body) {})\n```\n\nThe first argument may be an options object.\nHere's the default values:\n\n```javascript\npool.request(\n  { path: undefined        // the request path (required)\n  , method: 'GET'\n  , data: undefined        // request body, may be a string, buffer, or stream\n  , headers: {}            // extra http headers to send\n  , retryFilter: undefined // see below\n  , attempts: pool.length  // or at least 2, at most options.maxRetries + 1\n  , retryDelay: 20         // retries wait with exponential backoff times this number of ms\n  , timeout: 60000         // ms to wait before timing out the request\n  , encoding: 'utf8'       // response body encoding\n  , stream: false          // stream instead of buffer response body\n  }\n  ,\n  function (error, response, body) {}\n)\n```\n\nThe request body may be the second argument, instead of options.data (more\nuseful with `pool.post` and `pool.put`)\n\n```javascript\npool.request(\n  { path: '/foo' }\n  , 'hi there'\n  , function (error, response, body) {}\n)\n```\n\nA callback with 2 arguments will stream the response and not buffer the\nresponse body.\n\n```javascript\npool.request('/foo', function (error, response) {\n  response.pipe(somewhere)\n})\n```\n\n### pool.get\n\nJust a synonym for `request`\n\n### pool.put\n\nSame arguments as `request` that sets `options.method = 'PUT'`. Nice for\nputting :)\n\n```javascript\npool.put('/tweet/me', 'Hello World!', function (error, response) {})\n```\n\n### pool.post\n\nSame arguments as `request` that sets `options.method = 'POST'`\n\n### pool.del\n\nSame arguments as `request` that sets `options.method = 'DELETE'`\n\n### pool.addNode\n\nAdds a node to the pool given its hostname as a string. The node\nwill start in the healthy state.\n\n```javascript\npool.addNode(\"127.0.0.1:8890\");\n```\n\n### pool.removeNode\n\nRemoves a node to the pool given its hostname as a string. Note\nthat in the case of hosts with duplicate names, all instances of the\nspecified name will be removed from the pool.\n\n```javascript\npool.removeNode(\"127.0.0.1:8890\");\n```\n\n### Events\n\n##### timing\n\nEmits the request `duration` and `options` after each request\n\n##### retrying\n\nEmits the `error` of why a request is being retried\n\n##### timeout\n\nEmits the `request` when a request times out\n\n##### health\n\nEmits the `endpoint` when a node changes state between healthy/unhealthy\n","starsCount":3,"created":"2012-05-11T19:14:55.282Z","modified":"2017-02-04T20:27:45.894Z","lastPublisher":{"name":"dannycoates","email":"dannycoates@gmail.com"},"owners":[{"name":"dannycoates","email":"dannycoates@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"poolee","_nodeVersion":"6.4.0","_npmOperationalInternal":{"host":"packages-16-east.internal.npmjs.com","tmp":"tmp/poolee-1.0.1.tgz_1472502212238_0.2264983516652137"},"_npmUser":{"name":"dannycoates","email":"dannycoates@gmail.com"},"_npmVersion":"3.10.6","_rev":"3-4a0d66f20967f53c3ab49388ce81e4c2","_shasum":"5cab07e7287dab9e306cef08c6c3900fa2e3ad82","author":{"name":"Danny Coates","email":"dannycoates@gmail.com"},"bugs":{"url":"https://github.com/dannycoates/poolee/issues"},"directories":{},"dist-tags":{"latest":"1.0.1"},"dist":{"shasum":"5cab07e7287dab9e306cef08c6c3900fa2e3ad82","tarball":"http://registry.npmjs.org/poolee/-/poolee-1.0.1.tgz"},"maintainers":[{"name":"dannycoates","email":"dannycoates@gmail.com"}],"readmeFilename":"readme.md","time":{"modified":"2017-02-04T20:27:45.894Z","created":"2012-05-11T19:14:55.282Z","0.1.0":"2012-05-11T19:14:56.382Z","0.1.1":"2012-05-14T19:54:18.727Z","0.2.0":"2012-06-01T17:47:52.092Z","0.3.0":"2012-06-14T02:03:58.281Z","0.4.0":"2012-11-28T00:31:07.869Z","0.4.1":"2012-11-28T03:00:39.496Z","0.4.2":"2012-11-28T18:36:23.130Z","0.4.3":"2012-11-29T22:19:58.168Z","0.4.4":"2012-12-05T19:59:57.406Z","0.4.5":"2012-12-11T19:37:50.171Z","0.4.6":"2012-12-13T20:15:13.766Z","0.4.7":"2013-01-07T22:47:39.965Z","0.4.8":"2013-01-11T19:31:01.257Z","0.4.9":"2013-08-16T20:14:42.228Z","0.4.11":"2013-12-11T20:17:19.426Z","0.4.12":"2014-06-03T22:30:54.303Z","0.4.13":"2014-06-03T22:33:56.270Z","0.4.14":"2014-06-04T00:43:19.014Z","0.4.15":"2014-06-04T18:38:19.011Z","0.4.16":"2015-03-27T04:56:10.598Z","1.0.0":"2015-03-27T05:57:45.532Z","1.0.1":"2016-08-29T20:23:34.545Z"},"users":{"loki2302":true,"yazanrawashdeh":true,"chirag8642":true}}}