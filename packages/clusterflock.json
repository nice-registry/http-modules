{"name":"clusterflock","version":"0.3.2","description":"a clustering http server for node","main":"index.js","scripts":{"test":"./node_modules/jasmine-node/bin/jasmine-node spec/"},"repository":"https://github.com/jclem/clusterflock","keywords":["cluster","server","http"],"license":"MIT","homepage":"https://github.com/jclem/clusterflock","dependencies":{"logfmt":"~1.0.0"},"devDependencies":{"jasmine-node":"~1.13.1","proxyquire":"~0.5.2"},"versions":[{"number":"0.0.0","date":"2014-03-03T02:18:08.611Z"},{"number":"0.1.0","date":"2014-03-03T09:12:52.968Z"},{"number":"0.1.1","date":"2014-03-03T10:49:07.759Z"},{"number":"0.2.0","date":"2014-03-04T00:44:48.033Z"},{"number":"0.3.0","date":"2014-03-05T06:50:05.406Z"},{"number":"0.3.1","date":"2014-03-27T00:45:29.619Z"},{"number":"0.3.2","date":"2014-09-12T12:40:32.289Z"}],"readme":"# clusterflock  [![Build Status](https://travis-ci.org/jclem/clusterflock.png)](https://travis-ci.org/jclem/clusterflock)\n\n![flocking birds](http://cl.ly/image/0e3E400R1n0U/81938785_7755757d8a_m.jpg)\n\nclusterflock is a simple clustering HTTP server for Node. It accepts a single request handler and a hash of options. The goal of clusterflock is to eliminate my own repeated need for a simple clustering server that implements graceful worker shutdown and re-forking of dead workers.\n\n**This package is deprecated.** I wrote a much more well-tested version without the known bugs of clusterflock called [teamster](https://www.npmjs.org/package/teamster).\n\n\n## Installation\n\n```sh\n$ npm install clusterflock --save\n```\n\n## Usage\n\nBy default, clusterflock will fork the number of workers equal to `os.cpus().length`. When it receives a `SIGINT` or `SIGTERM` signal, it will begin attempting to shut down gracefully by ceasing to receive requests and closing all servers after existing requests have been completed.\n\nThe simplest use case of clusterflock is to pass it a single request handler function:\n\n```javascript\nvar clusterflock = require('clusterflock');\n\nclusterflock(function (req, res) {\n  res.end('ok');\n});\n```\n\nSince clusterflock essentially just calls `http.createServer` in the worker process, anything that can be normally passed to that function can be passed to the `clusterflock` main function, including [express](http://expressjs.com) apps:\n\n```javascript\nvar clusterflock = require('clusterflock'),\n    express      = require('express'),\n    app          = express();\n    \napp.use(express.bodyParser()); // &c.\nclusterflock(app);\n```\n\n### Worker Re-forking\n\nWhen a worker disconnects, the master checks the value of its [`suicide`](http://nodejs.org/api/cluster.html#cluster_worker_suicide) attribute. If that value is true, master does nothing. If that value is not true (i.e. the worker died/was killed unintentionally), the master forks a new worker.\n\n## Options\n\nThe `clusterflock` function accepts an options object:\n\n```javascript\nvar clusterflock = require('clusterflock'),\n    app          = require('./lib/app');\n    \nclusterflock(app, {\n  numWorkers: 1,\n  port      : 3000,\n  timeout   : 5000\n});\n```\n \nName         | Type(s)            | Default | Description\n------------ | ------------------ | --------------------------   | ------------------\n`numWorkers` | `Number`           | `os.cpus().length`           | number of worker processes to fork\n`port`       | `Number`, `String` | <code>process.env.PORT &#124;&#124; 5000</code>   | port the workers will listen on\n`timeout`    | `Number`           | `1000`                       | amount of time after receiving a graceful shutdown signal that the master will immediately kill workers\n\n## Signals\n\nclusterflock responds to signals. [heroku, for example](https://devcenter.heroku.com/articles/dynos#graceful-shutdown-with-sigterm), sends `SIGTERM` to stop and restart dynos, which will cause clusterflock to initiate a graceful shutdown. `SIGINT`, on the other hand, will force clusterflock to shut down immediately.\n\nSignal    | Behavior\n--------- | --------------------------------------------------------\n`SIGTTIN` | Fork an additonal worker\n`SIGTTOU` | Disconnect the least-recently forked worker\n`SIGINT`  | Kill master process (and therefore workers) immediately.\n`SIGTERM` | Forward myself `SIGQUIT`.\n`SIGQUIT` | Attempt a graceful shutdown (stop serving requests, serve remaining requests, and shut down).\n\n## Testing\n\nTo run the tests:\n\n```sh\n$ npm test\n```\n\n## Contributing\n\n1. Fork it.\n2. Create a branch (`git checkout -b my-clusterflock`)\n3. Commit your changes (`git commit -am \"add unicorns\"`)\n4. Push to the branch (`git push origin my-clusterflock`)\n5. Open a [Pull Request](http://github.com/jclem/clusterflock/pulls)\n\n## Meta\n\nThe photo in this readme is by Flickr user [Eugene Zemlyanskiy](http://www.flickr.com/photos/pictureperfectpose/81938785/). It has a [CC BY 2.0](http://creativecommons.org/licenses/by/2.0/) license.\n","created":"2014-03-03T02:18:08.611Z","modified":"2014-09-12T12:40:32.289Z","lastPublisher":{"name":"jclem","email":"jonathan@jclem.net"},"owners":[{"name":"jclem","email":"jonathan@jclem.net"}],"other":{"_attachments":{},"_from":".","_id":"clusterflock","_npmUser":{"name":"jclem","email":"jonathan@jclem.net"},"_npmVersion":"1.4.3","_rev":"1-e122918a880004df7d91a0767ff4d352","author":{"name":"Jonathan Clem"},"bugs":{"url":"https://github.com/jclem/clusterflock/issues"},"directories":{},"dist-tags":{"latest":"0.3.2"},"dist":{"shasum":"a049b960314276a70297d9f401dbabfa22e73243","tarball":"http://registry.npmjs.org/clusterflock/-/clusterflock-0.3.2.tgz"},"maintainers":[{"name":"jclem","email":"jonathan@jclem.net"}],"readmeFilename":"README.md","time":{"modified":"2014-09-12T12:40:32.289Z","created":"2014-03-03T02:18:08.611Z","0.0.0":"2014-03-03T02:18:08.611Z","0.1.0":"2014-03-03T09:12:52.968Z","0.1.1":"2014-03-03T10:49:07.759Z","0.2.0":"2014-03-04T00:44:48.033Z","0.3.0":"2014-03-05T06:50:05.406Z","0.3.1":"2014-03-27T00:45:29.619Z","0.3.2":"2014-09-12T12:40:32.289Z"}}}