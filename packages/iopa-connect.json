{"name":"iopa-connect","main":"index.js","description":"Middleware to connect to Express/Connect style-middleware, and/or to build IOPA apps on top of built-in node HTTP Server","license":"Apache-2.0","version":"1.4.4","repository":"https://github.com/iopa-io/iopa-connect","dependencies":{"iopa":"^1.4.0","iopa-rest":"^1.4.0"},"keywords":["iopa","limerun","owin","middleware","router","route","http","connect","express","promise","async","framework","node","tasks"],"engines":{"node":">= 4.0"},"scripts":{"test":"mocha --reporter spec test","quick":"git add . -A && git commit -m 'dev test' && npm version patch && npm publish","typings":"tsd reinstall --overwrite --clean --config tools/tsd.json && tsd link"},"devDependencies":{"mocha":"^2.3.2","mocha-junit-reporter":"^1.6.1","should":"^7.1.0"},"homepage":"http://iopa.io","gitHead":"d7144ba68f62719bdbbdacd850f6f61fe10d950c","versions":[{"number":"1.0.22","date":"2015-09-03T21:27:06.119Z"},{"number":"1.2.1","date":"2015-09-15T20:07:21.891Z"},{"number":"1.2.2","date":"2015-09-18T00:05:59.388Z"},{"number":"1.2.3","date":"2015-09-23T18:55:21.296Z"},{"number":"1.3.1","date":"2015-09-23T20:23:50.272Z"},{"number":"1.3.2","date":"2016-03-11T05:00:04.991Z"},{"number":"1.3.10","date":"2016-03-11T05:24:50.968Z"},{"number":"1.3.11","date":"2016-03-11T05:25:29.871Z"},{"number":"1.3.12","date":"2016-03-11T05:40:20.709Z"},{"number":"1.4.1","date":"2016-07-05T02:19:25.592Z"},{"number":"1.4.2","date":"2016-07-08T14:32:56.584Z"},{"number":"1.4.3","date":"2016-07-08T14:37:33.508Z"},{"number":"1.4.4","date":"2016-07-08T14:56:47.060Z"}],"readme":"# [![IOPA](http://iopa.io/iopa.png)](http://iopa.io)<br> iopa-connect\n\n[![Build Status](https://api.shippable.com/projects/56e2594e9d043da07bb7cc62/badge?branchName=master)](https://app.shippable.com/projects/56e2594e9d043da07bb7cc62)\n[![NPM](https://img.shields.io/badge/iopa-certified-99cc33.svg?style=flat-square)](http://iopa.io/)\n[![limerun](https://img.shields.io/badge/limerun-certified-3399cc.svg?style=flat-square)](https://nodei.co/npm/limerun/)\n\n[![NPM](https://nodei.co/npm/iopa.png?downloads=true)](https://nodei.co/npm/iopa/)\n\n## About\n\nThis repository contains a Node Package Manager (NPM) package with helper functions for:\n \n* Connect app bridge: An IOPA -> Connect/Express application bridge\n* HTTP server bridge:  A Node.js Http Server --> IOPA application bridge\n\nThis package is intended for use in Node.js applications that either run on a web server that conform to the IOPA specifications (such as the embedded webserver inside [nodekit.io](https://github.com/nodekit-io/nodekit)) or run using the included iopa-http bridge for node-coap and node Http servers respectively.\n\n## Middleware/Application Pipeline Builder: AppBuilder \n```js\napp.use(middleware)\n```\n\nAdds a middleware node to the IOPA function pipeline. The middleware are\ninvoked in the order they are added: the first middleware passed to `app.use` will\nbe the outermost function, and the last middleware passed to Use will be the\ninnermost.\n\n### middleware\nThe middleware parameter determines which behavior is being chained into the pipeline. \n\n* If the middleware given to use is a function that takes **one** argument, then it will be invoked with the `next` component in the chain as its parameter, and with the `this` context set to the IOPA context.  It MUST return a promise that conforms to the Promise/A specification.\n\n* If the middleware given to use is a function that takes **two** arguments, then it will be invoked with the `next` component in the chain as its parameter, with a Node-based callback (`function(err, result){}`)as its second parameter, and with the `this` context set to the IOPA context.  This type of middleware should return void.\n\n* Legacy middleware can also be invoked with  `app.use( function(req,res){ ... }  )`, `app.use( function(req, res, next){ ... }  )` or `app.use( function(err, req, res, next){ ... }  )`.  The AppBuilder is smart enough to detect the two argument function with parameters named req and res in this case (use of different naming conventions need to be wrapped in a `function(req,res){}`), and assumes three and four argument functions are legacy.\n\n## Bridges\n\nThree simple functions `iopa.connect()`, `iopa.COAP()` and `iopa.REST()` are provided to bridge between IOPA context applications/middleware and Node.js COAP and HTTP REST-style `function(req,res)` based  applications/middleware.   Often these are not used directly as the AppBuilder functionality automatically wraps legacy middleware and can even return a node.js-ready pipeline with `.buildREST()`\n\nNote: The bridges are low overhead functions, binding by reference not by value wherever possible, so middleware can be interwoven throughout the pipeline, and open up the IOPA world to the entire Connect/Express based ecosystem and vice versa.   \n\nWe have not ported to Koa, Mach, Kraken or other similar frameworks but it would be relatively straightforward to do so.\n\n* `iopa.connect()` consumes a Connect-based application function (one that would normally be passed to the http.CreateServer method) and returns an IOPA **AppFunc**.\n* `iopa.http()` consumes an IOPA **AppFunc** and returns a function (that takes http.requestMessage and http.requestMessage as arguments) and one that can be passed directly to the http.createServer method    \n* `app.buildHttp()` is syntactic sugar to build the pipleine and returns a node.js-ready function (that takes http.requestMessage and http.requestMessage as arguments) and one that can be passed directly to the http.createServer method   \n\n\n## Example Usage\n\n### Installation\n``` js\nnpm install iopa\n```\n\n#### To run HTTP demo:\n``` js\ngit clone https://github.com/limerun/iopa.git\ncd iopa\nnpm install\nnode demo.js\n```\n    \n### Hello World Example\n``` js\nconst iopa = require('iopa'),\n      http = require('iopa-connect').http;\nvar app = new iopa.App();\napp.use(http);\napp.use(function(context, next){\n       context.response[\"iopa.WriteHead\"](200, {'Content-Type': 'text/html'});\n    context.response[\"iopa.Body\"].end(\"<html><head></head><body>Hello World from HTTP Server</body>\");\n     return next();\n    });\napp.createServer(\"http:\").listen();\n```\n   \n### Automatic Connect Bridge to Legacy Connect/Express Middleware    \n``` js\nvar iopa = require('iopa')\n  , http = require('http');\n  \nrequire('iopa-connect');\n\nvar app = new iopa.App();  \napp.use(function(req, res) {\n    response.writeHead(200, {\"Content-Type\": \"text/html\"});\n    response.end(\"<html><head></head><body>Hello World</body>\");\n});\nhttp.createServer(app.buildHttp()).listen(); \n```    \n\n### IOPA - HTTP Bridge\n    \n``` js\nvar iopa = require('iopa')\n  , http = require('http'); \nvar http = require('http');\nvar app = new iopa.App();\napp.use(function(next){\n    this.response.writeHead(200, {'Content-Type': 'text/html'});\n    this.response.end(\"<html><head></head><body>Hello World</body>\");\nreturn next();\n});\nhttp.createServer(app.buildHttp()).listen();\n```  \n\n## Definitions\n\n * **appFunc** = `(Promise) function(context)` \n * **app.use** = `(app)function(middleware)`\n * **middleware** = `(Promise) function(context, next)` with `next`=**appFunc**\n * OR **middleware** = `fn(req, res, next)` for compatibility with Connect/ExpressJS middleware\n * OR **middleware** = `fn(err, req, res, next)` for compatibility with Connect/ExpressJS middleware\n * **app.build** = `(appFunc) function(context)`   // builds middleware \n * **app.buildHttp** = `(function(req, res)) function()`   // builds middleware for compatibility with Connect/ExpressJS hosts\n * **context** = IOPA context dictionary\n\n## API Reference Specification\n\n[![IOPA](http://iopa.io/iopa.png)](http://iopa.io)\n \n[`IOPA-docs/IOPA-spec`](https://github.com/iopa-io/iopa-spec/blob/master/Specification.md)\n","created":"2015-09-03T21:27:06.119Z","modified":"2016-07-08T14:56:47.060Z","lastPublisher":{"name":"iopa","email":"build@iopa.io"},"owners":[{"name":"iopa","email":"build@iopa.io"}],"other":{"_attachments":{},"_from":".","_id":"iopa-connect","_nodeVersion":"4.4.7","_npmOperationalInternal":{"host":"packages-12-west.internal.npmjs.com","tmp":"tmp/iopa-connect-1.4.4.tgz_1467989804559_0.8331866734661162"},"_npmUser":{"name":"iopa","email":"build@iopa.io"},"_npmVersion":"2.15.8","_rev":"1-d8ef69bcc3d1c22cac52aa5723be83ac","_shasum":"7778e530c5d0abcc47ff604011db66c69ff15320","author":{"name":"iopa","email":"build@iopa.io"},"bugs":{"url":"https://github.com/iopa-io/iopa-connect/issues"},"directories":{},"dist-tags":{"latest":"1.4.4"},"dist":{"shasum":"7778e530c5d0abcc47ff604011db66c69ff15320","tarball":"http://registry.npmjs.org/iopa-connect/-/iopa-connect-1.4.4.tgz"},"maintainers":[{"name":"iopa","email":"build@iopa.io"}],"readmeFilename":"README.md","time":{"modified":"2016-07-08T14:56:47.060Z","created":"2015-09-03T21:27:06.119Z","1.0.22":"2015-09-03T21:27:06.119Z","1.2.1":"2015-09-15T20:07:21.891Z","1.2.2":"2015-09-18T00:05:59.388Z","1.2.3":"2015-09-23T18:55:21.296Z","1.3.1":"2015-09-23T20:23:50.272Z","1.3.2":"2016-03-11T05:00:04.991Z","1.3.10":"2016-03-11T05:24:50.968Z","1.3.11":"2016-03-11T05:25:29.871Z","1.3.12":"2016-03-11T05:40:20.709Z","1.4.1":"2016-07-05T02:19:25.592Z","1.4.2":"2016-07-08T14:32:56.584Z","1.4.3":"2016-07-08T14:37:33.508Z","1.4.4":"2016-07-08T14:56:47.060Z"}}}