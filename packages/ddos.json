{"name":"ddos","version":"0.1.20","description":"Configurable Denial-Of-Service prevention for http services","main":"index.js","scripts":{"test":"tape test/test*.js"},"repository":"https://github.com/rook2pawn/node-ddos","keywords":["ddos","rate","limiting"],"license":"ISC","homepage":"https://github.com/rook2pawn/node-ddos","devDependencies":{"body-parser":"","express":"","hapi":"^16.4.3","koa":"","queuelib":"","request":"","supertest":"","tape":""},"dependencies":{"response":"","hoek":"^4.1.1"},"gitHead":"f480a6856c6bd1cce23058c10af6e7f143841ad3","versions":[{"number":"0.1.0","date":"2014-07-15T12:05:07.798Z"},{"number":"0.1.1","date":"2014-07-15T12:07:11.545Z"},{"number":"0.1.2","date":"2014-07-15T12:13:43.287Z"},{"number":"0.1.3","date":"2014-07-15T12:45:33.537Z"},{"number":"0.1.4","date":"2014-07-16T04:14:48.675Z"},{"number":"0.1.5","date":"2014-07-24T20:25:39.751Z"},{"number":"0.1.6","date":"2014-08-19T20:11:12.946Z"},{"number":"0.1.7","date":"2014-08-22T22:04:37.433Z"},{"number":"0.1.8","date":"2015-12-15T22:32:36.552Z"},{"number":"0.1.9","date":"2015-12-16T00:36:03.741Z"},{"number":"0.1.11","date":"2016-01-02T01:39:31.796Z"},{"number":"0.1.12","date":"2016-12-19T21:11:47.037Z"},{"number":"0.1.13","date":"2016-12-19T21:26:14.565Z"},{"number":"0.1.14","date":"2016-12-19T21:49:40.733Z"},{"number":"0.1.15","date":"2016-12-19T21:52:38.602Z"},{"number":"0.1.16","date":"2016-12-19T22:28:36.121Z"},{"number":"0.1.17","date":"2017-06-22T10:13:53.787Z"},{"number":"0.1.18","date":"2017-06-22T10:19:09.533Z"},{"number":"0.1.19","date":"2017-06-22T21:07:58.599Z"},{"number":"0.1.20","date":"2017-06-22T22:21:13.276Z"}],"readme":"Configurable Denial-Of-Service prevention for http services\n\n[![Build Status](https://travis-ci.org/rook2pawn/node-ddos.svg?branch=master)](https://travis-ci.org/rook2pawn/node-ddos)\n\n# A Quick Overview\n\n    var Ddos = require('ddos')\n    var express = require('express')    \n    var ddos = new Ddos({burst:10, limit:15})\n    var app = express();\n    app.use(ddos.express);\n\n* **Rule 1** Every request per user increments an internal **count**. When the count exceeds the **limit**, the requests are denied with a HTTP 429 Too Many Requests.\n\n* **Rule 2** The *only* way for count to go away, is for an internal expiration time to expire, called the *expiry*, and is measured in seconds.\n\nThe first request comes in and the expiry is set to 1 second. If 1 second passes and no additional requests are made, then the entry is removed\nfrom the internal table. In fact, there can be up to **burst** amount of requests made and the **expiry time will not change**.\nThe only way the expiry goes up is when a request comes, the count goes up, and then if the count *exceeds* the burst amount (greater than, not greater than or equal to), then the expiry goes up to twice its previous value. \n\nEvery time the table is checked (defaults to 1 second, configurable by the **checkinterval** setting), the expiry goes down by that amount of time.\nNow we loop back to **Rule 2** when that when expiry is less than or equal to 0, then that entry is removed along with the count.\n\n\n## Features\n\n[![Join the chat at https://gitter.im/rook2pawn/node-ddos](https://badges.gitter.im/rook2pawn/node-ddos.svg)](https://gitter.im/rook2pawn/node-ddos?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)\n\n    * support the X-Forwarded-For header in a reverse proxy request \n\n## Supports\n\n    * HapiJS\n    * Express 4+\n    * Koa, or \n    * Any middleware stack that supports *next* \n      e.g. fn (req,res,next)\n\n### With [Express](https://github.com/expressjs/expressjs.com \"Express\")\n\n    var Ddos = require('ddos')\n    var express = require('express')    \n    var ddos = new Ddos;\n    var app = express();\n    app.use(ddos.express)\n\n\n### With [HapiJS](https://hapijs.com/ \"HapiJS\")\n  \n    var Ddos = require('ddos')\n    var Hapi = require('hapi');\n\n    var ddos = new Ddos;\n    const server = new Hapi.Server();\n    server.ext('onRequest', ddos.hapi.bind(ddos));\n\n### With [Koa](http://koajs.com \"KoaJS\") \n\n    var Ddos = require('ddos')\n    var koa = require('koa')    \n    var ddos = new Ddos;\n\n    var app = new koa;\n    app.use(ddos.koa.bind(ddos)) // be sure to bind ddos as koa rebinds the context\n\n\n### With [Router-Middleware](https://github.com/rook2pawn/router-middleware \"Router Middleware\")\n\n    var Router = require('router-middleware');\n    var Ddos = require('ddos')\n\n    var ddos = new Ddos;\n    var app = Router();\n    app.use(ddos);    \n\n\n## How does this ddos prevention module work?\n\nEvery request marks the internal table and increments the *count*.\nThis is how an entry in the table managed by this module looks\n\n    { host : <ip address>, count: 1, expiry: 1 }\n\nWhen a second request is made\n\n    { host : <ip address>, count: 2, expiry: 1 }\n\nand the third \n\n    { host : <ip address>, count: 3, expiry: 1 }\n\nand so on. If the count exceeds the configurable **burst** amount, then the expiry goes up by twice the previous expiry, 1, 2, 4, 8, 16, etc.\n\nWhen count exceeds the **limit**, then the request is denied, otherwise, the request is permitted.\n\nEvery time the internal table is checked, the expiration goes down by the time elapsed.\n\nThe only way for a user who has denied requests to continue is for them to let the expiration time pass, and when expiration hits 0, the entry is deleted from the table, and new requests are allowed like normal.\n\n## Processing and Memory Usage by this module\n\nThere is only ONE table, and within it only one small entry per IP, and that entry is transient and will be deleted within normal parameters. The table itself is combed over at the configurable **checkinterval** in seconds.\n\n## Yes, this will not deal with distributed denial-of-service attacks\n\nBut it will deal with simple DOS ones, but the concept is associated with DDOS whereas DOS is about the classic operating system from the 90's.\n\n\n## Let's review Configuration\n\nTo override any configuration option, simply specify it at construction time.\n\n    var Ddos = require('ddos');\n    var ddos = new Ddos({burst:3,limit:4,testmode:true,whitelist:['74.125.224.72']});\n\nLet's go over the configuration options to help illustrate how this module works.\nAll of the configurations default to the following:\n\n    params.maxcount = 30;\n    params.burst = 5;\n    params.limit = _params.burst * 4;  \n    params.maxexpiry = 120;\n    params.checkinterval = 1;\n    params.trustProxy = true;\n    params.includeUserAgent = true;\n    params.whitelist = [];\n    params.errormessage = 'Error';\n    params.testmode = false;\n    params.silent = false;\n    params.silentStart = false;\n    params.responseStatus = 429;\n\n### maxcount\n\nWhen the *count* exceeds the *limit* and then the *maxcount*, the count is reduced to the *maxcount*. The maxcount is simply is the maximum amount of \"punishment\" that could be applied to a denial time-out.  \n\n### limit \n\nlimit is the number of maximum counts allowed. If the count exceeds the limit, then the request is denied.\nRecommended limit is to use a multiple of the number of bursts.\n\n\n### burst\n\nBurst is the number or amount of allowable burst requests before the client starts being penalized.\nWhen the client is penalized, the expiration is increased by twice the previous expiration.\n\n\n### maxexpiry\n\nmaxexpiry is the seconds of maximum amount of expiration time. \nIn order for the user to use whatever service you are providing again, they have to wait through the expiration time.\n\n\n### checkinterval\n\ncheckinterval is the seconds between updating the internal table. \n\n### trustProxy\n\nDefaults to true. If true then we use the x-forwarded-for header, otherwise we use the remote address.\n\n    var host = _params.trustProxy ? (req.headers['x-forwarded-for'] || req.connection.remoteAddress) : req.connection.remoteAddress\n\n### includeUserAgent\n\nDefaults to true. If true we include the user agent as part of identifying a unique user. If false, then we only use IP. If set to false\nthis can lead to an entire block being banned unintentionally. Included to leave it up to the developer how they want to use it.\n\n\n### whitelist\n\nDefaults to empty list. Specify the IP's or addresses you would like to whitelist\n\n    var Ddos = require('ddos');\n    var ddos = new Ddos({whitelist:['74.125.224.72', '216.239.63.255']});\n\nWhitelisted IP's bypass all table checks. If the address in question is in IPV6 form, simply enable testmode\n\n    var ddos = new Ddos({whitelist:['74.125.224.72', '216.239.63.255'], testmode:true});\n\nand see the exact form of the address you want to whitelist. See this [link on stackoverflow about IPv6 addresses](http://stackoverflow.com/questions/29411551/express-js-req-ip-is-returning-ffff127-0-0-1)\n\n\n### errormessage\n\nWhen a request is denied, the user receives a 429 and the error message.\n\n### responseStatus\n\nBy default HTTP status code 429 (Too Many Requests) are sent in response.\n\n\n\nContribute\n==========\n\nContributions welcome!\n","starsCount":10,"created":"2014-07-15T12:05:07.798Z","modified":"2017-06-22T22:21:13.276Z","lastPublisher":{"name":"rook2pawn","email":"rook2pawn@gmail.com"},"owners":[{"name":"rook2pawn","email":"rook2pawn@gmail.com"}],"other":{"_attachments":{},"_id":"ddos","_nodeVersion":"8.1.2","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/ddos-0.1.20.tgz_1498170073197_0.04117363225668669"},"_npmUser":{"name":"rook2pawn","email":"rook2pawn@gmail.com"},"_npmVersion":"5.0.3","_rev":"12-7dd65d9ecd55eb2cd23838c730e832ef","author":{"name":"David Wee","email":"rook2pawn@gmail.com","url":"http://rook2pawn.com"},"bugs":{"url":"https://github.com/rook2pawn/node-ddos/issues"},"directories":{},"dist-tags":{"latest":"0.1.20"},"dist":{"integrity":"sha512-p89+JWltYct2Bq4jOkNXlJKkPgQkkukTMOnRUVZoPBjr9sW3e9lI+FslSzksFIombYJb10M/CSbpXL+x5Kcmpg==","shasum":"e74f965c23f7294787ab707110330d4dbbf65273","tarball":"https://registry.npmjs.org/ddos/-/ddos-0.1.20.tgz"},"maintainers":[{"name":"rook2pawn","email":"rook2pawn@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-06-22T22:21:13.276Z","created":"2014-07-15T12:05:07.798Z","0.1.0":"2014-07-15T12:05:07.798Z","0.1.1":"2014-07-15T12:07:11.545Z","0.1.2":"2014-07-15T12:13:43.287Z","0.1.3":"2014-07-15T12:45:33.537Z","0.1.4":"2014-07-16T04:14:48.675Z","0.1.5":"2014-07-24T20:25:39.751Z","0.1.6":"2014-08-19T20:11:12.946Z","0.1.7":"2014-08-22T22:04:37.433Z","0.1.8":"2015-12-15T22:32:36.552Z","0.1.9":"2015-12-16T00:36:03.741Z","0.1.11":"2016-01-02T01:39:31.796Z","0.1.12":"2016-12-19T21:11:47.037Z","0.1.13":"2016-12-19T21:26:14.565Z","0.1.14":"2016-12-19T21:49:40.733Z","0.1.15":"2016-12-19T21:52:38.602Z","0.1.16":"2016-12-19T22:28:36.121Z","0.1.17":"2017-06-22T10:13:53.787Z","0.1.18":"2017-06-22T10:19:09.533Z","0.1.19":"2017-06-22T21:07:58.599Z","0.1.20":"2017-06-22T22:21:13.276Z"},"users":{"shieldax":true,"j3kz":true,"awzm":true,"tarkeshwar":true,"ibakaidov":true,"ghkddbguse":true,"igalst":true,"steve3d3d":true,"rocket0191":true,"vchouhan":true}}}